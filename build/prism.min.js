!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.prism=t()}}(function(){return function t(e,i,r){function n(a,s){if(!i[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){var i=e[a][1][t];return n(i?i:t)},h,h.exports,t,e,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(t,e,i){!function(){"use strict";function i(t,e){if(t=t||{},t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,t.wrapS=u[t.wrapS]?t.wrapS:p,t.wrapT=u[t.wrapT]?t.wrapT:p,t.minFilter=s[t.minFilter]?t.minFilter:d,t.magFilter=a[t.magFilter]?t.magFilter:d,t.mipMap=void 0!==t.mipMap?t.mipMap:g,t.invertY=void 0!==t.invertY?t.invertY:v,t.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:m,t.format=h[t.format]?t.format:c,"string"==typeof t.src){var i=this;n.load({url:t.src,success:function(n){t.type="UNSIGNED_BYTE",t.src=o.resizeCanvas(t,n),r.call(i,t),e&&e(null,i)},error:function(t){e&&e(t,null)}})}else o.isCanvasType(t.src)?(t.type="UNSIGNED_BYTE",t.src=o.resizeCanvas(t,t.src),r.call(this,t)):(void 0===t.src&&(t.mipMap=!1),t.type=f[t.type]?t.type:l,r.call(this,t))}var r=t("./Texture2D"),n=t("../util/ImageLoader"),o=t("../util/Util"),a={NEAREST:!0,LINEAR:!0},s={NEAREST:!0,LINEAR:!0,NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},u={REPEAT:!0,MIRRORED_REPEAT:!0,CLAMP_TO_EDGE:!0},f={UNSIGNED_BYTE:!0,FLOAT:!0},h={RGB:!0,RGBA:!0},l="UNSIGNED_BYTE",c="RGBA",p="REPEAT",d="LINEAR",m=!0,g=!0,v=!0;i.prototype=Object.create(r.prototype),e.exports=i}()},{"../util/ImageLoader":17,"../util/Util":20,"./Texture2D":8}],2:[function(t,e,i){!function(){"use strict";function i(t){t=t||{},t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,t.wrapS=a[t.wrapS]?t.wrapS:l,t.wrapT=a[t.wrapT]?t.wrapT:l,t.minFilter=o[t.minFilter]?t.minFilter:c,t.magFilter=n[t.magFilter]?t.magFilter:c,t.mipMap=!1,t.invertY=!1,t.preMultiplyAlpha=!1,t.format=u[t.format]?t.format:h,"DEPTH_STENCIL"===t.format?t.type="UNSIGNED_INT_24_8_WEBGL":t.type=s[t.type]?t.type:f,r.call(this,t)}var r=t("./Texture2D"),n={NEAREST:!0,LINEAR:!0},o={NEAREST:!0,LINEAR:!0},a={REPEAT:!0,CLAMP_TO_EDGE:!0,MIRRORED_REPEAT:!0},s={UNSIGNED_BYTE:!0,UNSIGNED_SHORT:!0,UNSIGNED_INT:!0},u={DEPTH_COMPONENT:!0,DEPTH_STENCIL:!0},f="UNSIGNED_INT",h="DEPTH_COMPONENT",l="CLAMP_TO_EDGE",c="LINEAR";i.prototype=Object.create(r.prototype),e.exports=i}()},{"./Texture2D":8}],3:[function(t,e,i){!function(){"use strict";function i(t,e){e=e||{};var i=this.gl=r.get();if(this.state=n.get(i),this.buffer=i.createBuffer(),this.type=o[e.type]?e.type:u,"UNSIGNED_INT"===this.type&&!r.checkExtension("OES_element_index_uint"))throw"Cannot create IndexBuffer of type `UNSIGNED_INT` as extension `OES_element_index_uint` is not supported";if(this.mode=a[e.mode]?e.mode:f,this.count=void 0!==e.count?e.count:l,this.byteOffset=void 0!==e.byteOffset?e.byteOffset:h,this.byteLength=0,t)if(t instanceof WebGLBuffer){if(void 0===e.byteLength)throw"Argument of type `WebGLBuffer` must be complimented with a corresponding `options.byteLength`";this.byteLength=e.byteLength,this.buffer=t}else if("number"==typeof t){if(void 0===e.type)throw"Argument of type `number` must be complimented with a corresponding `options.type`";this.bufferData(t)}else if(t instanceof ArrayBuffer){if(void 0===e.type)throw"Argument of type `ArrayBuffer` must be complimented with a corresponding `options.type`";this.bufferData(t)}else this.bufferData(t);else if(void 0===e.type)throw"Empty buffer must be complimented with a corresponding `options.type`";if(this.count*s[this.type]+this.byteOffset>this.byteLength)throw"IndexBuffer `count` of "+this.count+" and `byteOffset` of "+this.byteOffset+" overflows the length of the buffer ("+this.byteLength+")"}var r=t("./WebGLContext"),n=t("./WebGLContextState"),o={UNSIGNED_SHORT:!0,UNSIGNED_INT:!0},a={POINTS:!0,LINES:!0,LINE_STRIP:!0,LINE_LOOP:!0,TRIANGLES:!0,TRIANGLE_STRIP:!0,TRIANGLE_FAN:!0},s={UNSIGNED_SHORT:2,UNSIGNED_INT:4},u="UNSIGNED_SHORT",f="TRIANGLES",h=0,l=0;i.prototype.bufferData=function(t){var e=this.gl;if(t instanceof Array&&(t="UNSIGNED_INT"===this.type?new Uint32Array(t):new Uint16Array(t)),t instanceof Uint16Array)this.type="UNSIGNED_SHORT";else if(t instanceof Uint32Array)this.type="UNSIGNED_INT";else if(!(t instanceof ArrayBuffer)&&"number"!=typeof t)throw"Argument must be of type `Array`, `ArrayBuffer`, `ArrayBufferView`, or `number`";if(this.count===l&&("number"==typeof t?this.count=t/s[this.type]:this.count=t.length),"number"==typeof t){if(t%s[this.type])throw"Byte length must be multiple of "+s[this.type];this.byteLength=t}else this.byteLength=t.length*s[this.type];return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this},i.prototype.bufferSubData=function(t,e){var i=this.gl;if(0===this.byteLength)throw"Buffer has not been allocated";if(t instanceof Array)t="UNSIGNED_INT"===this.type?new Uint32Array(t):new Uint16Array(t);else if(!(t instanceof Uint16Array||t instanceof Uint32Array||t instanceof ArrayBuffer))throw"Argument must be of type `Array`, `ArrayBuffer`, or `ArrayBufferView`";e=void 0!==e?e:h;var r=t.length*s[this.type];if(e+r>this.byteLength)throw"Argument of length "+r+" bytes and byte offset of "+e+" bytes overflows the buffer length of "+this.byteLength+" bytes";return i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.buffer),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,e,t),this},i.prototype.draw=function(t){t=t||{};var e=this.gl,i=e[t.mode||this.mode],r=e[this.type],n=void 0!==t.byteOffset?t.byteOffset:this.byteOffset,o=void 0!==t.count?t.count:this.count;if(0===o)throw"Attempting to draw with a count of 0";if(n+o*s[this.type]>this.byteLength)throw"Attempting to draw with `count` of "+o+" and `byteOffset` of "+n+" which overflows the total byte length of the buffer ("+this.byteLength+")";return this.state.boundIndexBuffer!==this.buffer&&(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),this.state.boundIndexBuffer=this.buffer),e.drawElements(i,o,r,n),this},e.exports=i}()},{"./WebGLContext":13,"./WebGLContextState":14}],4:[function(t,e,i){!function(){"use strict";function i(){var t=this.gl=r.get();this.state=n.get(t),this.framebuffer=t.createFramebuffer(),this.textures={}}var r=t("./WebGLContext"),n=t("./WebGLContextState"),o=t("../util/Util"),a={TEXTURE_2D:!0,TEXTURE_CUBE_MAP:!0},s={DEPTH_COMPONENT:!0,DEPTH_STENCIL:!0};i.prototype.push=function(){if(this.state.renderTargets.top()!==this){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer)}return this.state.renderTargets.push(this),this},i.prototype.pop=function(){var t=this.state;if(t.renderTargets.top()!==this)throw"The current render target is not the top most element on the stack";t.renderTargets.pop();var e,i=t.renderTargets.top();return i?(e=i.gl,e.bindFramebuffer(e.FRAMEBUFFER,i.framebuffer)):(e=this.gl,e.bindFramebuffer(e.FRAMEBUFFER,null)),this},i.prototype.setColorTarget=function(t,e,i){var r=this.gl;if(!t)throw"Texture argument is missing";if(a[e]&&void 0===i&&(i=e,e=0),void 0===e)e=0;else if(!o.isInteger(e)||0>e)throw"Texture color attachment index is invalid";if(i&&!a[i])throw"Texture target is invalid";return this.textures["color"+e]=t,this.push(),r.framebufferTexture2D(r.FRAMEBUFFER,r["COLOR_ATTACHMENT"+e],r[i||"TEXTURE_2D"],t.texture,0),this.pop(),this},i.prototype.setDepthTarget=function(t){if(!t)throw"Texture argument is missing";if(!s[t.format])throw"Provided texture is not of format `DEPTH_COMPONENT` or `DEPTH_STENCIL`";var e=this.gl;return this.textures.depth=t,this.push(),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t.texture,0),this.pop(),this},i.prototype.resize=function(t,e){if("number"!=typeof t||0>=t)throw"Provided `width` of "+t+" is invalid";if("number"!=typeof e||0>=e)throw"Provided `height` of "+e+" is invalid";var i=this.textures;return Object.keys(i).forEach(function(r){i[r].resize(t,e)}),this},e.exports=i}()},{"../util/Util":20,"./WebGLContext":13,"./WebGLContextState":14}],5:[function(t,e,i){!function(){"use strict";function i(t){var e={};t.forEach(function(t){Object.keys(t.pointers).forEach(function(t){e[t]=e[t]||0,e[t]++})}),Object.keys(e).forEach(function(t){if(e[t]>1)throw"More than one attribute pointer exists for index "+t})}function r(t){if(t=t||{},t.vertexBuffer||t.vertexBuffers)this.vertexBuffers=t.vertexBuffers||[t.vertexBuffer];else if(t.vertices){var e=new n(t.vertices);this.vertexBuffers=[new o(e)]}else this.vertexBuffers=[];t.indexBuffer?this.indexBuffer=t.indexBuffer:t.indices?this.indexBuffer=new a(t.indices):this.indexBuffer=null,i(this.vertexBuffers),this.options={mode:t.mode,byteOffset:t.byteOffset,count:t.count}}var n=t("../core/VertexPackage"),o=t("../core/VertexBuffer"),a=t("../core/IndexBuffer");r.prototype.draw=function(t){var e=t||{};return e.mode=e.mode||this.options.mode,e.byteOffset=void 0!==e.byteOffset?e.byteOffset:this.options.byteOffset,e.count=void 0!==e.count?e.count:this.options.count,this.indexBuffer?(this.vertexBuffers.forEach(function(t){t.bind()}),this.indexBuffer.draw(e),this.vertexBuffers.forEach(function(t){t.unbind()})):this.vertexBuffers.forEach(function(t){t.bind(),t.draw(e),t.unbind()}),this},e.exports=r}()},{"../core/IndexBuffer":3,"../core/VertexBuffer":10,"../core/VertexPackage":11}],6:[function(t,e,i){!function(){"use strict";function i(t,e){return t[e.name]?t[e.name].index:Object.keys(t).length}function r(t,e,r){var n=p.parseDeclarations([e,r],["uniform","attribute"]);n.forEach(function(e){if("attribute"===e.qualifier){var r=i(t.attributes,e);t.attributes[e.name]={type:e.type,index:r}}else"uniform"===e.qualifier&&(t.uniforms[e.name]={type:e.type,func:v[e.type+(e.count>1?"[]":"")]})})}function n(t,e,i){var r=t.createShader(t[i]);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw"An error occurred compiling the shaders:\n"+t.getShaderInfoLog(r);return r}function o(t){var e=t.gl,i=t.attributes;Object.keys(i).forEach(function(r){e.bindAttribLocation(t.program,i[r].index,r)})}function a(t){var e=t.gl,i=t.uniforms;Object.keys(i).forEach(function(r){i[r].location=e.getUniformLocation(t.program,r)})}function s(t){return function(e){g.load({url:t,responseType:"text",success:function(t){e(null,t)},error:function(t){e(t,null)}})}}function u(t){return function(e){e(null,t)}}function f(t){return function(e){var i=[];t=t||[],t=t instanceof Array?t:[t],t.forEach(function(t){p.isGLSL(t)?i.push(u(t)):i.push(s(t))}),m.parallel(i,e)}}function h(t,e){var i=t.gl,s=e.common.join(""),u=e.vert.join(""),f=e.frag.join(""),h=n(i,s+u,"VERTEX_SHADER"),l=n(i,s+f,"FRAGMENT_SHADER");if(r(t,u,f),t.program=i.createProgram(),i.attachShader(t.program,h),i.attachShader(t.program,l),o(t),i.linkProgram(t.program),!i.getProgramParameter(t.program,i.LINK_STATUS))throw"An error occured linking the shader:\n"+i.getProgramInfoLog(t.program);a(t)}function l(t,e){var i=this;if(t=t||{},!t.vert)throw"Vertex shader argument has not been provided";if(!t.frag)throw"Fragment shader argument has not been provided";this.program=0,this.gl=c.get(),this.state=d.get(this.gl),this.version=t.version||"1.00",this.attributes={},this.uniforms={},t.attributes&&t.attributes.forEach(function(t,e){i.attributes[t]={index:e}}),m.parallel({common:f(t.common),vert:f(t.vert),frag:f(t.frag)},function(t,r){return t?void(e&&e(t,null)):(h(i,r),void(e&&e(null,i)))})}var c=t("./WebGLContext"),p=t("./ShaderParser"),d=t("./WebGLContextState"),m=t("../util/Async"),g=t("../util/XHRLoader"),v={bool:"uniform1i","bool[]":"uniform1iv","float":"uniform1f","float[]":"uniform1fv","int":"uniform1i","int[]":"uniform1iv",uint:"uniform1i","uint[]":"uniform1iv",vec2:"uniform2fv","vec2[]":"uniform2fv",ivec2:"uniform2iv","ivec2[]":"uniform2iv",vec3:"uniform3fv","vec3[]":"uniform3fv",ivec3:"uniform3iv","ivec3[]":"uniform3iv",vec4:"uniform4fv","vec4[]":"uniform4fv",ivec4:"uniform4iv","ivec4[]":"uniform4iv",mat2:"uniformMatrix2fv","mat2[]":"uniformMatrix2fv",mat3:"uniformMatrix3fv","mat3[]":"uniformMatrix3fv",mat4:"uniformMatrix4fv","mat4[]":"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"};l.prototype.push=function(){return this.state.shaders.top()!==this&&this.gl.useProgram(this.program),this.state.shaders.push(this),this},l.prototype.pop=function(){var t=this.state;if(t.shaders.top()!==this)throw"Shader is not the top most element on the stack";t.shaders.pop();var e=t.shaders.top();return e&&e!==this?e.gl.useProgram(e.program):this.gl.useProgram(null),this},l.prototype.setUniform=function(t,e){if(this!==this.state.shaders.top())throw"Attempting to set uniform `"+t+"` for an unbound shader";var i=this.uniforms[t];if(!i)throw"No uniform found under name `"+t+"`";if(void 0===e||null===e)throw"Argument passed for uniform `"+t+"` is undefined";return e instanceof Array?e=new Float32Array(e):"boolean"==typeof e&&(e=e?1:0),"mat2"===i.type||"mat3"===i.type||"mat4"===i.type?this.gl[i.func](i.location,!1,e):this.gl[i.func](i.location,e),this},l.prototype.setUniforms=function(t){if(this!==this.state.shaders.top())throw"Attempting to set uniform `"+name+"` for an unbound shader";var e=this.gl,i=this.uniforms;return Object.keys(t).forEach(function(r){var n=t[r],o=i[r];if(!o)throw"No uniform found under name `"+r+"`";if(void 0===n||null===n)throw"Argument passed for uniform `"+r+"` is undefined";n instanceof Array?n=new Float32Array(n):"boolean"==typeof n&&(n=n?1:0),"mat2"===o.type||"mat3"===o.type||"mat4"===o.type?e[o.func](o.location,!1,n):e[o.func](o.location,n)}),this},e.exports=l}()},{"../util/Async":16,"../util/XHRLoader":21,"./ShaderParser":7,"./WebGLContext":13,"./WebGLContextState":14}],7:[function(t,e,i){!function(){"use strict";function t(t){return t.replace(f,"")}function i(t){return t.replace(h," ").replace(l," ").replace(c,"$2$4$6")}function r(t,e,i,r){var n=r.match(p),o=n[1],a=void 0===n[2]?1:parseInt(n[2],10);return{qualifier:t,precision:e,type:i,name:o,count:a}}function n(t,e){var i,n=t.split(",").map(function(t){return t.trim()}),o=n.shift().split(" "),a=o.shift(),f=o.shift();s[f]?i=o.shift():(i=f,f=e[u[i]]);var h=o.concat(n),l=[];return h.forEach(function(t){l.push(r(a,f,i,t))}),l}function o(e,r){var o=t(e),a=i(o),s=a.split(";"),u=r.join("|"),f=new RegExp(".*\\b("+u+")\\b.*"),h={},l=[];return s.forEach(function(t){var e=t.match(d);if(e)return void(h[e[3]]=e[2]);var i=t.match(f);i&&(l=l.concat(n(i[0],h)))}),l}function a(t){var e={};return t.filter(function(t){return e[t.name]?!1:(e[t.name]=!0,!0)})}var s={highp:!0,mediump:!0,lowp:!0},u={"float":"float",vec2:"float",vec3:"float",vec4:"float",ivec2:"int",ivec3:"int",ivec4:"int","int":"int",uint:"int",sampler2D:"sampler2D",samplerCube:"samplerCube"},f=/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,h=/(\r\n|\n|\r)/gm,l=/\s{2,}/g,c=/(\s*)(\[)(\s*)(\d+)(\s*)(\])(\s*)/g,p=/([a-zA-Z_][a-zA-Z0-9_]*)(?:\[(\d+)\])?/,d=/\b(precision)\s+(\w+)\s+(\w+)/,m=/void\s+main\s*\(\s*(void)*\s*\)\s*/im;e.exports={parseDeclarations:function(t,e){if(!e||0===e.length||!t||0===t.length)return[];t=t instanceof Array?t:[t],e=e instanceof Array?e:[e];var i=[];return t.forEach(function(t){i=i.concat(o(t,e))}),a(i)},isGLSL:function(t){return m.test(t)}}}()},{}],8:[function(t,e,i){!function(){"use strict";function i(t){if(t=t||{},t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,this.wrapS=t.wrapS||d,this.wrapT=t.wrapT||d,this.minFilter=t.minFilter||m,this.magFilter=t.magFilter||m,this.mipMap=void 0!==t.mipMap?t.mipMap:v,this.invertY=void 0!==t.invertY?t.invertY:y,this.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:g,this.format=t.format||p,l[this.format]&&!r.checkExtension("WEBGL_depth_texture"))throw"Cannot create Texture2D of format `"+this.format+"` as `WEBGL_depth_texture` extension is unsupported";if(this.type=t.type||c,"FLOAT"===this.type&&!r.checkExtension("OES_texture_float"))throw"Cannot create Texture2D of type `FLOAT` as `OES_texture_float` extension is unsupported";if(!o.isCanvasType(t.src)){if("number"!=typeof t.width||t.width<=0)throw"`width` argument is missing or invalid";if("number"!=typeof t.height||t.height<=0)throw"`height` argument is missing or invalid";if(o.mustBePowerOfTwo(this)){if(!o.isPowerOfTwo(t.width))throw"Parameters require a power-of-two texture, yet provided width of "+t.width+" is not a power of two";if(!o.isPowerOfTwo(t.height))throw"Parameters require a power-of-two texture, yet provided height of "+t.height+" is not a power of two"}}var e=this.gl=r.get();this.state=n.get(e),this.texture=e.createTexture(),this.bufferData(t.src||null,t.width,t.height),this.setParameters(this)}var r=t("./WebGLContext"),n=t("./WebGLContextState"),o=t("../util/Util"),a={NEAREST:!0,LINEAR:!0},s={NEAREST:!0,LINEAR:!0,NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},u={NEAREST:!0,LINEAR:!0},f={NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},h={REPEAT:!0,MIRRORED_REPEAT:!0,CLAMP_TO_EDGE:!0},l={DEPTH_COMPONENT:!0,DEPTH_STENCIL:!0},c="UNSIGNED_BYTE",p="RGBA",d="REPEAT",m="LINEAR",g=!0,v=!0,y=!0,_="_MIPMAP_LINEAR";i.prototype.push=function(t){if(void 0===t)t=0;else if(!o.isInteger(t)||0>t)throw"Texture unit location is invalid";if(this.state.texture2Ds.top(t)!==this){var e=this.gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_2D,this.texture)}return this.state.texture2Ds.push(t,this),this},i.prototype.pop=function(t){if(void 0===t)t=0;else if(!o.isInteger(t)||0>t)throw"Texture unit location is invalid";var e=this.state;if(e.texture2Ds.top(t)!==this)throw"Texture2D is not the top most element on the stack";e.texture2Ds.pop(t);var i,r=e.texture2Ds.top(t);r?r!==this&&(i=r.gl,i.activeTexture(i["TEXTURE"+t]),i.bindTexture(i.TEXTURE_2D,r.texture)):(i=this.gl,i.bindTexture(i.TEXTURE_2D,null))},i.prototype.bufferData=function(t,e,i){var r=this.gl;if(this.push(),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.invertY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.preMultiplyAlpha),t instanceof Array&&(t="UNSIGNED_SHORT"===this.type?new Uint16Array(t):"UNSIGNED_INT"===this.type?new Uint32Array(t):"FLOAT"===this.type?new Float32Array(t):new Uint8Array(t)),t instanceof Uint8Array)this.type="UNSIGNED_BYTE";else if(t instanceof Uint16Array)this.type="UNSIGNED_SHORT";else if(t instanceof Uint32Array)this.type="UNSIGNED_INT";else if(t instanceof Float32Array)this.type="FLOAT";else if(t&&!(t instanceof ArrayBuffer)&&!o.isCanvasType(t))throw"Argument must be of type `Array`, `ArrayBuffer`, `ArrayBufferView`, `ImageData`, `HTMLImageElement`, `HTMLCanvasElement`, `HTMLVideoElement`, or null";return o.isCanvasType(t)?(this.width=t.width,this.height=t.height,r.texImage2D(r.TEXTURE_2D,0,r[this.format],r[this.format],r[this.type],t)):(this.width=e||this.width,this.height=i||this.height,r.texImage2D(r.TEXTURE_2D,0,r[this.format],this.width,this.height,0,r[this.format],r[this.type],t)),this.mipMap&&r.generateMipmap(r.TEXTURE_2D),this.pop(),this},i.prototype.setParameters=function(t){var e=this.gl;this.push();var i=t.wrapS||t.wrap;if(i){if(!h[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_WRAP_S`";this.wrapS=i,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrapS])}if(i=t.wrapT||t.wrap){if(!h[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_WRAP_T`";this.wrapT=i,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrapT])}if(i=t.magFilter||t.filter){if(!a[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_MAG_FILTER`";this.magFilter=i,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.magFilter])}if(i=t.minFilter||t.filter)if(this.mipMap){if(u[i]&&(i+=_),!f[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_MIN_FILTER`";this.minFilter=i,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[this.minFilter])}else{if(!s[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_MIN_FILTER`";this.minFilter=i,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[this.minFilter])}return this.pop(),this},i.prototype.resize=function(t,e){if("number"!=typeof t||0>=t)throw"Provided `width` of "+t+" is invalid";if("number"!=typeof e||0>=e)throw"Provided `height` of "+e+" is invalid";return this.bufferData(null,t,e),this},e.exports=i}()},{"../util/Util":20,"./WebGLContext":13,"./WebGLContextState":14}],9:[function(t,e,i){!function(){"use strict";function i(t){if("number"!=typeof t.width||t.width<=0)throw"`width` argument is missing or invalid";if("number"!=typeof t.height||t.height<=0)throw"`height` argument is missing or invalid";if(t.width!==t.height)throw"Provided `width` must be equal to `height`";if(h.mustBePowerOfTwo(t)&&!h.isPowerOfTwo(t.width))throw"Parameters require a power-of-two texture, yet provided size of "+t.width+" is not a power of two"}function r(t,e,i){return function(r){l.load({url:i,success:function(i){i=h.resizeCanvas(t,i),t.bufferData(e,i),r(null)},error:function(t){r(t,null)}})}}function n(t,e,i){return function(r){i=h.resizeCanvas(t,i),t.bufferData(e,i),r(null)}}function o(t,e,r){return i(t),function(i){t.bufferData(e,r),i(null)}}function a(t,e){var a=this,l=this.gl=s.get();if(this.state=u.get(l),this.texture=l.createTexture(),t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,this.wrapS=_[t.wrapS]?t.wrapS:w,this.wrapT=_[t.wrapT]?t.wrapT:w,this.minFilter=g[t.minFilter]?t.minFilter:b,this.magFilter=m[t.magFilter]?t.magFilter:b,this.mipMap=void 0!==t.mipMap?t.mipMap:L,this.invertY=void 0!==t.invertY?t.invertY:R,this.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:A,this.format=x[t.format]?t.format:E,this.type=t.type||T,"FLOAT"===this.type&&!s.checkExtension("OES_texture_float"))throw"Cannot create Texture2D of type `FLOAT` as `OES_texture_float` extension is unsupported";if(this.width=t.width,this.height=t.height,this.bufferedFaces=[],t.faces){var d=[];c.forEach(function(e){var i=t.faces[e],s=p[e];"string"==typeof i?d.push(r(a,s,i)):h.isCanvasType(i)?d.push(n(a,s,i)):d.push(o(a,s,i))}),f.parallel(d,function(t){return t?void(e&&e(t,null)):(a.setParameters(a),void(e&&e(null,a)))})}else i(this),c.forEach(function(t){a.bufferData(p[t],null)}),this.setParameters(this)}var s=t("./WebGLContext"),u=t("./WebGLContextState"),f=t("../util/Async"),h=t("../util/Util"),l=t("../util/ImageLoader"),c=["-x","+x","-y","+y","-z","+z"],p={"+z":"TEXTURE_CUBE_MAP_POSITIVE_Z","-z":"TEXTURE_CUBE_MAP_NEGATIVE_Z","+x":"TEXTURE_CUBE_MAP_POSITIVE_X","-x":"TEXTURE_CUBE_MAP_NEGATIVE_X","+y":"TEXTURE_CUBE_MAP_POSITIVE_Y","-y":"TEXTURE_CUBE_MAP_NEGATIVE_Y"},d={TEXTURE_CUBE_MAP_POSITIVE_Z:!0,TEXTURE_CUBE_MAP_NEGATIVE_Z:!0,TEXTURE_CUBE_MAP_POSITIVE_X:!0,TEXTURE_CUBE_MAP_NEGATIVE_X:!0,TEXTURE_CUBE_MAP_POSITIVE_Y:!0,TEXTURE_CUBE_MAP_NEGATIVE_Y:!0},m={NEAREST:!0,LINEAR:!0},g={NEAREST:!0,LINEAR:!0,NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},v={NEAREST:!0,LINEAR:!0},y={NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},_={REPEAT:!0,MIRRORED_REPEAT:!0,CLAMP_TO_EDGE:!0},x={RGB:!0,RGBA:!0},T="UNSIGNED_BYTE",E="RGBA",w="CLAMP_TO_EDGE",b="LINEAR",A=!0,L=!0,R=!0,M="_MIPMAP_LINEAR";a.prototype.push=function(t){if(void 0===t)t=0;else if(!h.isInteger(t)||0>t)throw"Texture unit location is invalid";if(this.state.textureCubeMaps.top(t)!==this){var e=this.gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture)}return this.state.textureCubeMaps.push(t,this),this},a.prototype.pop=function(t){if(void 0===t)t=0;else if(!h.isInteger(t)||0>t)throw"Texture unit location is invalid";var e=this.state;if(e.textureCubeMaps.top(t)!==this)throw"The current texture is not the top most element on the stack";e.textureCubeMaps.pop(t);var i,r=e.textureCubeMaps.top(t);return r?r!==this&&(i=r.gl,i.activeTexture(i["TEXTURE"+t]),i.bindTexture(i.TEXTURE_CUBE_MAP,r.texture)):(i=this.gl,i.bindTexture(i.TEXTURE_CUBE_MAP,null)),this},a.prototype.bufferData=function(t,e){if(!d[t])throw"Provided `target` of "+t+" is invalid";var i=this.gl;if(this.push(),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.invertY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.preMultiplyAlpha),e instanceof Array&&(e="UNSIGNED_SHORT"===this.type?new Uint16Array(e):"UNSIGNED_INT"===this.type?new Uint32Array(e):"FLOAT"===this.type?new Float32Array(e):new Uint8Array(e)),e instanceof Uint8Array)this.type="UNSIGNED_BYTE";else if(e instanceof Uint16Array)this.type="UNSIGNED_SHORT";else if(e instanceof Uint32Array)this.type="UNSIGNED_INT";else if(e instanceof Float32Array)this.type="FLOAT";else if(e&&!(e instanceof ArrayBuffer)&&!h.isCanvasType(e))throw"Argument must be of type `Array`, `ArrayBuffer`, `ArrayBufferView`, `ImageData`, `HTMLImageElement`, `HTMLCanvasElement`, `HTMLVideoElement`, or null";return h.isCanvasType(e)?(this.width=e.width,this.height=e.height,i.texImage2D(i[t],0,i[this.format],i[this.format],i[this.type],e)):i.texImage2D(i[t],0,i[this.format],this.width,this.height,0,i[this.format],i[this.type],e),this.bufferedFaces.indexOf(t)<0&&this.bufferedFaces.push(t),this.mipMap&&6===this.bufferedFaces.length&&i.generateMipmap(i.TEXTURE_CUBE_MAP),this.pop(),this},a.prototype.setParameters=function(t){var e=this.gl;this.push();var i=t.wrapS||t.wrap;if(i){if(!_[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_WRAP_S`";this.wrapS=i,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e[this.wrapS])}if(i=t.wrapT||t.wrap){if(!_[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_WRAP_T`";this.wrapT=i,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e[this.wrapT])}if(i=t.magFilter||t.filter){if(!m[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_MAG_FILTER`";this.magFilter=i,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e[this.magFilter])}if(i=t.minFilter||t.filter)if(this.mipMap){if(v[i]&&(i+=M),!y[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_MIN_FILTER`";this.minFilter=i,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[this.minFilter])}else{if(!g[i])throw"Texture parameter `"+i+"` is not a valid value for `TEXTURE_MIN_FILTER`";this.minFilter=i,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[this.minFilter])}return this.pop(),this},e.exports=a}()},{"../util/Async":16,"../util/ImageLoader":17,"../util/Util":20,"./WebGLContext":13,"./WebGLContextState":14}],10:[function(t,e,i){!function(){"use strict";function i(t){var e=Object.keys(t);if(1===e.length)return 0;var i=0,r=0,n=0;return e.forEach(function(e){var o=t[e],a=o.byteOffset,s=o.size,u=o.type;r+=s*l[u],a>i&&(i=a,n=a+s*l[u])}),i>=r?0:n}function r(t){if(!t||0===Object.keys(t).length)throw"VertexBuffer requires attribute pointers to be specified upon instantiation";var e={};return Object.keys(t).forEach(function(i){var r=parseInt(i,10);if(isNaN(r))throw"Attribute index `"+i+"` does not represent an integer";var n=t[i],o=n.size,a=n.type,s=n.byteOffset;if(!p[o])throw"Attribute pointer `size` parameter is invalid, must be one of "+JSON.stringify(Object.keys(p));if(!h[a])throw"Attribute pointer `type` parameter is invalid, must be one of "+JSON.stringify(Object.keys(h));e[r]={size:o,type:a,byteOffset:void 0!==s?s:m}}),e}function n(t){var e=0;return Object.keys(t).forEach(function(i){e+=t[i].size}),e}function o(t,e,o){o=o||{};var h=this.gl=a.get();if(this.state=s.get(h),this.buffer=h.createBuffer(),this.mode=f[o.mode]?o.mode:d,this.count=void 0!==o.count?o.count:g,this.byteOffset=void 0!==o.byteOffset?o.byteOffset:m,this.byteLength=0,t instanceof u?(this.pointers=t.pointers,o=e||{}):this.pointers=r(e),this.byteStride=i(this.pointers),t)if(t instanceof u)this.bufferData(t.buffer);else if(t instanceof WebGLBuffer){if(void 0===o.byteLength)throw"Argument of type `WebGLBuffer` must be complimented with a corresponding `options.byteLength`";this.byteLength=o.byteLength,this.buffer=t}else this.bufferData(t);var l=c*n(this.pointers);if(this.count*l+this.byteOffset>this.byteLength)throw"VertexBuffer `count` of "+this.count+" and `byteOffset` of "+this.byteOffset+" overflows the total byte length of the buffer ("+this.byteLength+")"}var a=t("./WebGLContext"),s=t("./WebGLContextState"),u=t("./VertexPackage"),f={POINTS:!0,LINES:!0,LINE_STRIP:!0,LINE_LOOP:!0,TRIANGLES:!0,TRIANGLE_STRIP:!0,TRIANGLE_FAN:!0},h={FLOAT:!0},l={FLOAT:4},c=l.FLOAT,p={1:!0,2:!0,3:!0,4:!0},d="TRIANGLES",m=0,g=0;o.prototype.bufferData=function(t){var e=this.gl;if(t instanceof Array)t=new Float32Array(t);else if(!(t instanceof ArrayBuffer||t instanceof Float32Array||"number"==typeof t))throw"Argument must be of type `Array`, `ArrayBuffer`, `ArrayBufferView`, or `number`";if(this.count===g){var i=n(this.pointers);"number"==typeof t?this.count=t/c/i:this.count=t.length/i}if("number"==typeof t){if(t%c)throw"Byte length must be multiple of "+c;this.byteLength=t}else this.byteLength=t.length*c;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)},o.prototype.bufferSubData=function(t,e){var i=this.gl;if(0===this.byteLength)throw"Buffer has not yet been allocated";if(t instanceof Array)t=new Float32Array(t);else if(!(t instanceof ArrayBuffer||ArrayBuffer.isView(t)))throw"Argument must be of type `Array`, `ArrayBuffer`, or `ArrayBufferView`";e=void 0!==e?e:m;var r=t.length*c;if(e+r>this.byteLength)throw"Argument of length "+r+" bytes and offset of "+e+" bytes overflows the buffer length of "+this.byteLength+" bytes";return i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferSubData(i.ARRAY_BUFFER,e,t),this},o.prototype.bind=function(){var t=this.gl,e=this.state;e.boundVertexBuffer!==this.buffer&&(t.bindBuffer(t.ARRAY_BUFFER,this.buffer),e.boundVertexBuffer=this.buffer);var i=this.pointers,r=this.byteStride;return Object.keys(i).forEach(function(n){var o=i[n];t.vertexAttribPointer(n,o.size,t[o.type],!1,r,o.byteOffset),e.enabledVertexAttributes[n]||(t.enableVertexAttribArray(n),e.enabledVertexAttributes[n]=!0)}),this},o.prototype.unbind=function(){var t=this.gl,e=this.state;return e.boundVertexBuffer!==this.buffer&&(t.bindBuffer(t.ARRAY_BUFFER,this.buffer),e.boundVertexBuffer=this.buffer),Object.keys(this.pointers).forEach(function(i){e.enabledVertexAttributes[i]&&(t.disableVertexAttribArray(i),e.enabledVertexAttributes[i]=!1)}),this},o.prototype.draw=function(t){if(t=t||{},this.state.boundVertexBuffer!==this.buffer)throw"Attempting to draw an unbound VertexBuffer";var e=this.gl,i=e[t.mode||this.mode],r=void 0!==t.byteOffset?t.byteOffset:this.byteOffset,o=void 0!==t.count?t.count:this.count;if(0===o)throw"Attempting to draw with a count of 0";var a=c*n(this.pointers);if(o*a+r>this.byteLength)throw"Attempting to draw with `count` of "+o+" and `offset` of "+r+" overflows the total byte length of the buffer ("+this.byteLength+")";return e.drawArrays(i,r,o),this},e.exports=o}()},{"./VertexPackage":11,"./WebGLContext":13,"./WebGLContextState":14}],11:[function(t,e,i){!function(){"use strict";function i(t){var e=[];return Object.keys(t).forEach(function(i){var r=parseFloat(i);if(!h.isInteger(r)||0>r)throw"Attribute index `"+i+"` does not represent a valid integer";var n=t[i];if(!(n&&n instanceof Array&&n.length>0))throw"Error parsing attribute of index `"+i+"`";e.push({index:r,data:n})}),e.sort(function(t,e){return t.index-e.index}),e}function r(t){return void 0!==t.x?void 0!==t.y?void 0!==t.z?void 0!==t.w?4:3:2:1:t instanceof Array?t.length:1;
}function n(t,e){var i=Number.MAX_VALUE,n=0;t.pointers={},e.forEach(function(e){var o=r(e.data[0]);i=Math.min(i,e.data.length),t.pointers[e.index]={type:l,size:o,byteOffset:n*c},n+=o}),t.byteStride=n*c,t.length=i}function o(t,e,i,r,n){var o,a,s;for(a=0;i>a;a++)o=e[a],s=r+n*a,void 0!==o.x?t[s]=o.x:void 0!==o[0]?t[s]=o[0]:t[s]=o}function a(t,e,i,r,n){var o,a,s;for(a=0;i>a;a++)o=e[a],s=r+n*a,t[s]=void 0!==o.x?o.x:o[0],t[s+1]=void 0!==o.y?o.y:o[1]}function s(t,e,i,r,n){var o,a,s;for(a=0;i>a;a++)o=e[a],s=r+n*a,t[s]=void 0!==o.x?o.x:o[0],t[s+1]=void 0!==o.y?o.y:o[1],t[s+2]=void 0!==o.z?o.z:o[2]}function u(t,e,i,r,n){var o,a,s;for(a=0;i>a;a++)o=e[a],s=r+n*a,t[s]=void 0!==o.x?o.x:o[0],t[s+1]=void 0!==o.y?o.y:o[1],t[s+2]=void 0!==o.z?o.z:o[2],t[s+3]=void 0!==o.w?o.w:o[3]}function f(t){void 0!==t?this.set(t):(this.buffer=new Float32Array(0),this.pointers={})}var h=t("../util/Util"),l="FLOAT",c=4;f.prototype.set=function(t){t=i(t),n(this,t);var e=this.length,r=this.byteStride/c,f=this.pointers,h=this.buffer=new Float32Array(e*r);return t.forEach(function(t){var i=f[t.index],n=i.byteOffset/c;switch(i.size){case 2:a(h,t.data,e,n,r);break;case 3:s(h,t.data,e,n,r);break;case 4:u(h,t.data,e,n,r);break;default:o(h,t.data,e,n,r)}}),this},e.exports=f}()},{"../util/Util":20}],12:[function(t,e,i){!function(){"use strict";function i(t,e,i,r,n){var o=t.gl;e=void 0!==e?e:0,i=void 0!==i?i:0,r=void 0!==r?r:t.width,n=void 0!==n?n:t.height,o.viewport(e,i,r,n)}function r(t){t=t||{},this.gl=n.get(),this.state=o.get(this.gl),this.resize(t.width||this.gl.canvas.width,t.height||this.gl.canvas.height)}var n=t("./WebGLContext"),o=t("./WebGLContextState");r.prototype.resize=function(t,e){if("number"!=typeof t||0>=t)throw"Provided `width` of "+t+" is invalid";if("number"!=typeof e||0>=e)throw"Provided `height` of "+e+" is invalid";return this.width=t,this.height=e,this.gl.canvas.width=t,this.gl.canvas.height=e,this},r.prototype.push=function(t,e,r,n){if(void 0!==t&&"number"!=typeof t)throw"Provided `x` of "+t+" is invalid";if(void 0!==e&&"number"!=typeof e)throw"Provided `y` of "+e+" is invalid";if(void 0!==r&&("number"!=typeof r||0>=r))throw"Provided `width` of "+r+" is invalid";if(void 0!==n&&("number"!=typeof n||0>=n))throw"Provided `height` of "+n+" is invalid";return this.state.viewports.push({viewport:this,x:t,y:e,width:r,height:n}),i(this,t,e,r,n),this},r.prototype.pop=function(){var t=this.state,e=t.viewports.top();if(!e||this!==e.viewport)throw"Viewport is not the top most element on the stack";return t.viewports.pop(),e=t.viewports.top(),e?i(e.viewport,e.x,e.y,e.width,e.height):i(this),this},e.exports=r}()},{"./WebGLContext":13,"./WebGLContextState":14}],13:[function(t,e,i){!function(){"use strict";function t(){var t=function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)};return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t)}function i(e){return e.id||(e.id=t()),e.id}function r(t){return t instanceof HTMLCanvasElement?t:"string"==typeof t?document.getElementById(t)||document.querySelector(t):null}function n(t){if(void 0===t){if(u)return u}else{var e=r(t);if(e)return f[i(e)]}return null}function o(t){var e=t.gl;s.forEach(function(i){t.extensions[i]=e.getExtension(i)})}function a(t,e){var r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),n={id:i(t),gl:r,extensions:{}};return o(n),f[i(t)]=n,u=n,n}var s=["OES_texture_float","OES_texture_half_float","WEBGL_lose_context","OES_standard_derivatives","OES_vertex_array_object","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1"],u=null,f={};e.exports={bind:function(t){var e=n(t);if(e)return u=e,this;throw"No context exists for provided argument `"+t+"`"},get:function(t,e){var i=n(t);if(i)return i.gl;var o=r(t);if(!o)throw"Context could not be associated with argument of type `"+typeof t+"`";return a(o,e).gl},remove:function(t){var e=n(t);if(!e)throw"Context could not be found or deleted for argument of type `"+typeof t+"`";delete f[e.id],e===u&&(u=null)},supportedExtensions:function(t){var e=n(t);if(e){var i=e.extensions,r=[];return Object.keys(i).forEach(function(t){i[t]&&r.push(t)}),r}throw"No context is currently bound or could be associated with the provided argument"},unsupportedExtensions:function(t){var e=n(t);if(e){var i=e.extensions,r=[];return Object.keys(i).forEach(function(t){i[t]||r.push(t)}),r}throw"No context is currently bound or could be associated with the provided argument"},checkExtension:function(t,e){e||(e=t,t=void 0);var i=n(t);if(i){var r=i.extensions;return!!r[e]}throw"No context is currently bound or could be associated with the provided argument"}}}()},{}],14:[function(t,e,i){!function(){"use strict";function i(){this.boundVertexBuffer=null,this.enabledVertexAttributes={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1},this.boundIndexBuffer=null,this.shaders=new r,this.viewports=new r,this.renderTargets=new r,this.texture2Ds=new n,this.textureCubeMaps=new n}var r=t("../util/Stack"),n=t("../util/StackMap"),o={};e.exports={get:function(t){var e=t.canvas.id;return o[e]||(o[e]=new i),o[e]}}}()},{"../util/Stack":18,"../util/StackMap":19}],15:[function(t,e,i){!function(){"use strict";e.exports={IndexBuffer:t("./core/IndexBuffer"),Renderable:t("./core/Renderable"),RenderTarget:t("./core/RenderTarget"),Shader:t("./core/Shader"),Texture2D:t("./core/Texture2D"),ColorTexture2D:t("./core/ColorTexture2D"),DepthTexture2D:t("./core/DepthTexture2D"),TextureCubeMap:t("./core/TextureCubeMap"),VertexBuffer:t("./core/VertexBuffer"),VertexPackage:t("./core/VertexPackage"),Viewport:t("./core/Viewport"),WebGLContext:t("./core/WebGLContext")}}()},{"./core/ColorTexture2D":1,"./core/DepthTexture2D":2,"./core/IndexBuffer":3,"./core/RenderTarget":4,"./core/Renderable":5,"./core/Shader":6,"./core/Texture2D":8,"./core/TextureCubeMap":9,"./core/VertexBuffer":10,"./core/VertexPackage":11,"./core/Viewport":12,"./core/WebGLContext":13}],16:[function(t,e,i){!function(){"use strict";function t(t){var e,i=-1;if(Array.isArray(t))return e=t.length,function(){return i++,e>i?i:null};var r=Object.keys(t);return e=r.length,function(){return i++,e>i?r[i]:null}}function i(t){return function(){null!==t&&(t.apply(this,arguments),t=null)}}function r(e,r,n){function o(t){s--,t?n(t):null===a&&0>=s&&n(null)}n=i(n);for(var a,s=0,u=t(e);null!==(a=u());)s+=1,r(e[a],a,o);0===s&&n(null)}e.exports={parallel:function(t,e){var i=Array.isArray(t)?[]:{};r(t,function(t,e,r){t(function(t,n){i[e]=n,r(t)})},function(t){e(t,i)})}}}()},{}],17:[function(t,e,i){!function(){"use strict";e.exports={load:function(t){var e=new Image;e.onload=function(){t.success&&t.success(e)},e.onerror=function(e){if(t.error){var i="Unable to load image from URL: `"+e.path[0].currentSrc+"`";t.error(i)}},e.src=t.url}}}()},{}],18:[function(t,e,i){!function(){"use strict";function t(){this.data=[]}t.prototype.push=function(t){return this.data.push(t),this},t.prototype.pop=function(){return this.data.pop()},t.prototype.top=function(){var t=this.data.length-1;if(!(0>t))return this.data[t]},e.exports=t}()},{}],19:[function(t,e,i){!function(){"use strict";function i(){this.stacks={}}var r=t("./Stack");i.prototype.push=function(t,e){return this.stacks[t]||(this.stacks[t]=new r),this.stacks[t].push(e),this},i.prototype.pop=function(t){return this.stacks[t]?this.stacks[t].pop():void 0},i.prototype.top=function(t){return this.stacks[t]?this.stacks[t].top():void 0},e.exports=i}()},{"./Stack":18}],20:[function(t,e,i){!function(){"use strict";var t={};t.isArrayType=function(t){return t instanceof Array||t instanceof ArrayBuffer||ArrayBuffer.isView(t)},t.isCanvasType=function(t){return t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement},t.mustBePowerOfTwo=function(t){return t.mipMap||"REPEAT"===t.wrapS||"MIRRORED_REPEAT"===t.wrapS||"REPEAT"===t.wrapT||"MIRRORED_REPEAT"===t.wrapT},t.isInteger=function(t){return"number"==typeof t&&t%1===0},t.isPowerOfTwo=function(t){return 0!==t?0===(t&t-1):!1},t.nextHighestPowerOfTwo=function(t){var e;for(0!==t&&(t-=1),e=1;32>e;e<<=1)t|=t>>e;return t+1},t.resizeCanvas=function(e,i){if(!t.mustBePowerOfTwo(e)||t.isPowerOfTwo(i.width)&&t.isPowerOfTwo(i.height))return i;var r=document.createElement("canvas");r.width=t.nextHighestPowerOfTwo(i.width),r.height=t.nextHighestPowerOfTwo(i.height);var n=r.getContext("2d");return n.drawImage(i,0,0,i.width,i.height,0,0,r.width,r.height),r},e.exports=t}()},{}],21:[function(t,e,i){!function(){"use strict";e.exports={load:function(t){var e=new XMLHttpRequest;e.open("GET",t.url,!0),e.responseType=t.responseType,e.onreadystatechange=function(){4===e.readyState&&(200===e.status?t.success&&t.success(e.response):t.error&&t.error("GET "+e.responseURL+" "+e.status+" ("+e.statusText+")"))},e.send()}}}()},{}],22:[function(t,e,i){var r="undefined"!=typeof JSON?JSON:t("jsonify");e.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var i=e.space||"";"number"==typeof i&&(i=Array(i+1).join(" "));var a="boolean"==typeof e.cycles?e.cycles:!1,s=e.replacer||function(t,e){return e},u=e.cmp&&function(t){return function(e){return function(i,r){var n={key:i,value:e[i]},o={key:r,value:e[r]};return t(n,o)}}}(e.cmp),f=[];return function h(t,e,l,c){var p=i?"\n"+new Array(c+1).join(i):"",d=i?": ":":";if(l&&l.toJSON&&"function"==typeof l.toJSON&&(l=l.toJSON()),l=s.call(t,e,l),void 0!==l){if("object"!=typeof l||null===l)return r.stringify(l);if(n(l)){for(var m=[],g=0;g<l.length;g++){var v=h(l,g,l[g],c+1)||r.stringify(null);m.push(p+i+v)}return"["+m.join(",")+p+"]"}if(-1!==f.indexOf(l)){if(a)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}f.push(l);for(var y=o(l).sort(u&&u(l)),m=[],g=0;g<y.length;g++){var e=y[g],_=h(l,e,l[e],c+1);if(_){var x=r.stringify(e)+d+_;m.push(p+i+x)}}return f.splice(f.indexOf(l),1),"{"+m.join(",")+p+"}"}}({"":t},"",t,0)};var n=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},o=Object.keys||function(t){var e=Object.prototype.hasOwnProperty||function(){return!0},i=[];for(var r in t)e.call(t,r)&&i.push(r);return i}},{jsonify:23}],23:[function(t,e,i){i.parse=t("./lib/parse"),i.stringify=t("./lib/stringify")},{"./lib/parse":24,"./lib/stringify":25}],24:[function(t,e,i){var r,n,o,a,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},u=function(t){throw{name:"SyntaxError",message:t,at:r,text:o}},f=function(t){return t&&t!==n&&u("Expected '"+t+"' instead of '"+n+"'"),n=o.charAt(r),r+=1,n},h=function(){var t,e="";for("-"===n&&(e="-",f("-"));n>="0"&&"9">=n;)e+=n,f();if("."===n)for(e+=".";f()&&n>="0"&&"9">=n;)e+=n;if("e"===n||"E"===n)for(e+=n,f(),"-"!==n&&"+"!==n||(e+=n,f());n>="0"&&"9">=n;)e+=n,f();return t=+e,isFinite(t)?t:void u("Bad number")},l=function(){var t,e,i,r="";if('"'===n)for(;f();){if('"'===n)return f(),r;if("\\"===n)if(f(),"u"===n){for(i=0,e=0;4>e&&(t=parseInt(f(),16),isFinite(t));e+=1)i=16*i+t;r+=String.fromCharCode(i)}else{if("string"!=typeof s[n])break;r+=s[n]}else r+=n}u("Bad string")},c=function(){for(;n&&" ">=n;)f()},p=function(){switch(n){case"t":return f("t"),f("r"),f("u"),f("e"),!0;case"f":return f("f"),f("a"),f("l"),f("s"),f("e"),!1;case"n":return f("n"),f("u"),f("l"),f("l"),null}u("Unexpected '"+n+"'")},d=function(){var t=[];if("["===n){if(f("["),c(),"]"===n)return f("]"),t;for(;n;){if(t.push(a()),c(),"]"===n)return f("]"),t;f(","),c()}}u("Bad array")},m=function(){var t,e={};if("{"===n){if(f("{"),c(),"}"===n)return f("}"),e;for(;n;){if(t=l(),c(),f(":"),Object.hasOwnProperty.call(e,t)&&u('Duplicate key "'+t+'"'),e[t]=a(),c(),"}"===n)return f("}"),e;f(","),c()}}u("Bad object")};a=function(){switch(c(),n){case"{":return m();case"[":return d();case'"':return l();case"-":return h();default:return n>="0"&&"9">=n?h():p()}},e.exports=function(t,e){var i;return o=t,r=0,n=" ",i=a(),c(),n&&u("Syntax error"),"function"==typeof e?function s(t,i){var r,n,o=t[i];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n=s(o,r),void 0!==n?o[r]=n:delete o[r]);return e.call(t,i,o)}({"":i},""):i}},{}],25:[function(t,e,i){function r(t){return u.lastIndex=0,u.test(t)?'"'+t.replace(u,function(t){var e=f[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function n(t,e){var i,u,f,h,l,c=o,p=e[t];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(t)),"function"==typeof s&&(p=s.call(e,t,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=a,l=[],"[object Array]"===Object.prototype.toString.apply(p)){for(h=p.length,i=0;h>i;i+=1)l[i]=n(i,p)||"null";return f=0===l.length?"[]":o?"[\n"+o+l.join(",\n"+o)+"\n"+c+"]":"["+l.join(",")+"]",o=c,f}if(s&&"object"==typeof s)for(h=s.length,i=0;h>i;i+=1)u=s[i],"string"==typeof u&&(f=n(u,p),f&&l.push(r(u)+(o?": ":":")+f));else for(u in p)Object.prototype.hasOwnProperty.call(p,u)&&(f=n(u,p),f&&l.push(r(u)+(o?": ":":")+f));return f=0===l.length?"{}":o?"{\n"+o+l.join(",\n"+o)+"\n"+c+"}":"{"+l.join(",")+"}",o=c,f}}var o,a,s,u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};e.exports=function(t,e,i){var r;if(o="",a="","number"==typeof i)for(r=0;i>r;r+=1)a+=" ";else"string"==typeof i&&(a=i);if(s=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return n("",{"":t})}},{}],26:[function(t,e,i){!function(){"use strict";e.exports={TileLayer:t("./layer/exports"),Renderer:t("./renderer/exports"),TileRequestor:t("./request/TileRequestor"),MetaRequestor:t("./request/MetaRequestor")}}()},{"./layer/exports":39,"./renderer/exports":61,"./request/MetaRequestor":75,"./request/TileRequestor":77}],27:[function(t,e,i){!function(){"use strict";var t=function(t,e,i,r){if(!t)throw"DateHistogram `field` is missing from argument";if(void 0===e)throw"DateHistogram `from` are missing from argument";if(void 0===i)throw"DateHistogram `to` are missing from argument";return this._params.date_histogram={field:t,from:e,to:i,interval:r},this.clearExtrema(),this},i=function(){return this._params.date_histogram};e.exports={setDateHistogram:t,getDateHistogram:i}}()},{}],28:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"Histogram `field` "+e+" is not recognized in meta data";if(!t.extrema)throw"Histogram `field` "+e+" is not ordinal in meta data"},i=function(e,i){if(!e)throw"Histogram `field` is missing from argument";if(!i)throw"Histogram `interval` are missing from argument";return t(this._meta[e],e),this._params.histogram={field:e,interval:i},this.clearExtrema(),this},r=function(){return this._params.histogram};e.exports={setHistogram:i,getHistogram:r}}()},{}],29:[function(t,e,i){!function(){"use strict";var t={min:!0,max:!0,sum:!0,avg:!0},i=function(t,e){if(!t)throw"Metric `field` "+e+" is not recognized in meta data";if(!t.extrema)throw"Metrix `field` "+e+" is not ordinal in meta data"},r=function(e,r){if(!e)throw"Metric `field` is missing from argument";if(!r)throw"Metric `type` is missing from argument";if(i(this._meta[e],e),!t[r])throw"Metric type `"+r+"` is not supported";return this._params.metric={field:e,type:r},this.clearExtrema(),this},n=function(){return this._params.metric};e.exports={setMetric:r,getMetric:n}}()},{}],30:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"Terms `field` "+e+" is not recognized in meta data";if("string"!==t.type)throw"Terms `field` "+e+" is not of type `string` in meta data"},i=function(e,i){if(!e)throw"Terms `field` is missing from argument";return t(this._meta[e],e),this._params.terms={field:e,size:i},this.clearExtrema(),this},r=function(){return this._params.terms};e.exports={setTerms:i,getTerms:r}}()},{}],31:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"Terms `field` "+e+" is not recognized in meta data";if("string"!==t.type)throw"Terms `field` "+e+" is not of type `string` in meta data"},i=function(e,i){if(!e)throw"Terms `field` is missing from argument";if(void 0===i)throw"Terms `terms` are missing from argument";return t(this._meta[e],e),this._params.terms_filter={field:e,terms:i},this.clearExtrema(),this},r=function(){return this._params.terms_filter};e.exports={setTermsFilter:i,getTermsFilter:r}}()},{}],32:[function(t,e,i){!function(){"use strict";var t=function(t,e,i,r){return this._params.top_hits={size:t,include:e,sort:i,order:r},this.clearExtrema(),this},i=function(){return this._params.top_hits},r=function(t){return this._params.top_hits.sort=t,this},n=function(){return this._params.top_hits.sort};e.exports={setTopHits:t,getTopHits:i,setSortField:r,getSortField:n}}()},{}],33:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"TopTerms `field` "+e+" is not recognized in meta data";if("string"!==t.type)throw"TopTerms `field` "+e+" is not of type `string` in meta data"},i=function(e,i){if(!e)throw"TopTerms `field` is missing from argument";return t(this._meta[e],e),this._params.top_terms={field:e,size:i},this.clearExtrema(),this},r=function(){return this._params.top_terms};e.exports={setTopTerms:i,getTopTerms:r}}()},{}],34:[function(t,e,i){!function(){"use strict";var t=L.GridLayer.extend({getOpacity:function(){return this.options.opacity},show:function(){this._hidden=!1,this._prevMap.addLayer(this)},hide:function(){this._hidden=!0,this._prevMap=this._map,this._map.removeLayer(this)},isHidden:function(){return this._hidden},setBrightness:function(t){this._brightness=t,$(this._container).css("-webkit-filter","brightness("+100*this._brightness+"%)"),$(this._container).css("filter","brightness("+100*this._brightness+"%)")},getBrightness:function(){return void 0!==this._brightness?this._brightness:1}});e.exports=t}()},{}],35:[function(t,e,i){!function(){"use strict";var i=t("./Base"),r=i.extend({options:{unloadInvisibleTiles:!0,zIndex:5e3},initialize:function(t){if(!t.rendererClass)throw"No `rendererClass` option found.";$.extend(!0,this,t.rendererClass),L.setOptions(this,t)},createTile:function(t){var e=L.DomUtil.create("div","leaflet-tile");return this.renderTile(e,t),e},renderTile:function(){}});e.exports=r}()},{"./Base":34}],36:[function(t,e,i){!function(){"use strict";var i=t("./Base"),r=L.TileLayer.extend(i);e.exports=r}()},{"./Base":34}],37:[function(t,e,i){!function(){"use strict";function i(t,e){return(t%e+e)%e}function r(t){var e=Math.pow(2,t.z);return{x:i(t.x,e),y:i(t.y,e),z:t.z}}var n=t("../query/Bool"),o=Number.MAX_VALUE,a=0,s=L.Class.extend({initialize:function(t,e){if(!e.rendererClass)throw"No `rendererClass` option found.";e.rendererClass.prototype?($.extend(!0,this,e.rendererClass.prototype),e.rendererClass.prototype.initialize.apply(this,arguments)):($.extend(!0,this,e.rendererClass),e.rendererClass.initialize.apply(this,arguments)),L.setOptions(this,e),this._meta=t,this._params={binning:{}},this.clearExtrema()},clearExtrema:function(){this._extrema={min:o,max:a},this._cache={}},getExtrema:function(){return this._extrema},updateExtrema:function(t){var e=this.extractExtrema(t),i=!1;return e.min<this._extrema.min&&(i=!0,this._extrema.min=e.min),e.max>this._extrema.max&&(i=!0,this._extrema.max=e.max),i},extractExtrema:function(t){return{min:_.min(t),max:_.max(t)}},setQuery:function(t){if(!t.must&&!t.must_not&&!t.should)throw"Root query must have at least one `must`, `must_not`, or `should` argument.";n(this._meta,t),this._params.must=t.must,this._params.must_not=t.must_not,this._params.should=t.should,this.clearExtrema()},getMeta:function(){return this._meta},getParams:function(){return this._params},cacheKeyFromCoord:function(t,e){return e&&(t=r(t)),t.z+":"+t.x+":"+t.y},coordFromCacheKey:function(t){var e=t.split(":");return{x:parseInt(e[1],10),y:parseInt(e[2],10),z:parseInt(e[0],10)}},onTileUnload:function(t){var e=this.cacheKeyFromCoord(t.coords),i=this.cacheKeyFromCoord(t.coords,!0),r=this._cache[i];r&&(delete r.tiles[e],0===_.keys(r.tiles).length&&delete this._cache[e])},onCacheHit:function(){},onCacheLoad:function(){},onCacheLoadExtremaUpdate:function(){},onTileLoad:function(t){var e=this,i=t.coords,n=r(t.coords),o=t.tile,a=this.cacheKeyFromCoord(t.coords),s=this.cacheKeyFromCoord(t.coords,!0),u=this._cache[s];u?(u.tiles[a]=o,u.isPending||e.onCacheHit(o,u,i)):(this._cache[s]={isPending:!0,tiles:{},data:null},this._cache[s].tiles[a]=o,this.requestTile(n,function(t){var r=e._cache[s];r&&(r.isPending=!1,r.data=t,t&&e.updateExtrema(t)?e.onCacheLoadExtremaUpdate(o,r,i):e.onCacheLoad(o,r,i))}))}});e.exports=s}()},{"../query/Bool":44}],38:[function(t,e,i){!function(){"use strict";var i=t("./Base"),r=i.extend({options:{unloadInvisibleTiles:!0,zIndex:5e3},initialize:function(t){if(this._pendingTiles={},!t.rendererClass)throw"No `rendererClass` option found.";$.extend(!0,this,t.rendererClass),L.setOptions(this,t)},increment:function(t){var e=this._getTileHash(t);if(void 0===this._pendingTiles[e]){this._pendingTiles[e]=1;var i=this._getTilesWithHash(e);i.forEach(function(e){this._updateTile(t,e)},this)}else this._pendingTiles[e]++},decrement:function(t){var e=this._getTileHash(t);if(this._pendingTiles[e]--,0===this._pendingTiles[e]){delete this._pendingTiles[e];var i=this._getTilesWithHash(e);i.forEach(function(e){this._updateTile(t,e)},this)}},_getTileClass:function(t){return"leaflet-pending-"+t},_getTileHash:function(t){return t.z+"-"+t.x+"-"+t.y},_getTilesWithHash:function(t){var e=this._getTileClass(t),i=[];return $(this._container).find("."+e).each(function(){i.push(this)}),i},_updateTile:function(t,e){var i=this._getTileHash(t);$(e).addClass(this._getTileClass(i)),this._pendingTiles[i]>0?this.renderTile(e,t):e.innerHTML=""},createTile:function(t){var e=L.DomUtil.create("div","leaflet-tile");return this._updateTile(t,e),e},renderTile:function(){}});e.exports=r}()},{"./Base":34}],39:[function(t,e,i){!function(){"use strict";var i=t("./core/Debug"),r=t("./core/Pending"),n=t("./core/Image"),o=t("./type/Heatmap"),a=t("./type/TopTrails"),s=t("./type/TopCount"),u=t("./type/TopFrequency"),f=t("./type/TopicCount"),h=t("./type/TopicFrequency"),l=t("./type/Preview");e.exports={Debug:i,Pending:r,Image:n,Heatmap:o,TopCount:s,TopTrails:a,TopFrequency:u,TopicCount:f,TopicFrequency:h,Preview:l}}()},{"./core/Debug":35,"./core/Image":36,"./core/Pending":38,"./type/Heatmap":49,"./type/Preview":50,"./type/TopCount":51,"./type/TopFrequency":52,"./type/TopTrails":53,"./type/TopicCount":54,"./type/TopicFrequency":55}],40:[function(t,e,i){!function(){"use strict";function t(t){var e=t[0]>.04045?Math.pow((t[0]+.055)/1.055,2.4):t[0]/12.92,i=t[1]>.04045?Math.pow((t[1]+.055)/1.055,2.4):t[1]/12.92,r=t[2]>.04045?Math.pow((t[2]+.055)/1.055,2.4):t[2]/12.92,n=.4124564*e+.3575761*i+.1804375*r,o=.2126729*e+.7151522*i+.072175*r,a=.0193339*e+.119192*i+.9503041*r;return n/=.95047,o/=1,a/=1.08883,n=n>.008856?Math.pow(n,1/3):7.787037*n+16/116,o=o>.008856?Math.pow(o,1/3):7.787037*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787037*a+16/116,[116*o-16,500*(n-o),200*(o-a),t[3]]}function i(t){var e=(t[0]+16)/116,i=e+t[1]/500,r=e-t[2]/200;i=i>.206893034?i*i*i:(i-4/29)/7.787037,e=e>.206893034?e*e*e:(e-4/29)/7.787037,r=r>.206893034?r*r*r:(r-4/29)/7.787037,i=.95047*i,e=1*e,r=1.08883*r;var n=3.2404542*i+-1.5371385*e+r*-.4985314,o=i*-.969266+1.8760108*e+.041556*r,a=.0556434*i+e*-.2040259+1.0572252*r;return n=n>.00304?1.055*Math.pow(n,1/2.4)-.055:12.92*n,o=o>.00304?1.055*Math.pow(o,1/2.4)-.055:12.92*o,a=a>.00304?1.055*Math.pow(a,1/2.4)-.055:12.92*a,[Math.max(Math.min(n,1),0),Math.max(Math.min(o,1),0),Math.max(Math.min(a,1),0),t[3]]}function r(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])+(t[3]-e[3])*(t[3]-e[3]))}var n=200,o=function(e){var o=[],a=_.map(e,function(e){return t([e[0]/255,e[1]/255,e[2]/255,e[3]/255])}),s=_.map(a,function(t,e,i){return e>0?r(t,i[e-1]):0}),u=_.reduce(s,function(t,e){return t+e},0);s=_.map(s,function(t){return t/u});for(var f,h,l,c=0,p=0,d=0;n>d;d++)f=d/(n-1),f>c+s[p+1]&&p+1<a.length-1&&(p+=1,c+=s[p]),h=(f-c)/s[p+1],l=i([a[p][0]+(a[p+1][0]-a[p][0])*h,a[p][1]+(a[p+1][1]-a[p][1])*h,a[p][2]+(a[p+1][2]-a[p][2])*h,a[p][3]+(a[p+1][3]-a[p][3])*h]),o.push([Math.round(255*l[0]),Math.round(255*l[1]),Math.round(255*l[2]),Math.round(255*l[3])]);return o},a=o([[4,32,64,80],[8,64,129,127],[8,104,172,255],[43,140,190,255],[78,179,211,255],[123,204,196,255],[168,221,181,255],[204,235,197,255],[224,243,219,255],[247,252,240,255]]),s=o([[64,0,19,80],[128,0,38,127],[189,0,38,255],[227,26,28,255],[252,78,42,255],[253,141,60,255],[254,178,76,255],[254,217,118,255],[255,237,160,255]]),u=o([[0,64,38,80],[0,90,50,127],[35,132,67,255],[65,171,93,255],[120,198,121,255],[173,221,142,255],[217,240,163,255],[247,252,185,255],[255,255,229,255]]),f=o([[38,26,64,80],[68,47,114,127],[225,43,2,255],[2,220,1,255],[255,210,2,255],[255,255,255,255]]),h=o([[0,22,64,80],[0,57,102,127],[49,61,102,255],[225,43,2,255],[255,210,2,255],[255,255,255,255]]),l=o([[0,0,0,127],[64,64,64,255],[255,255,255,255]]),c=o([[255,68,0,255],[189,189,189,176]]),p=o([[189,189,189,176],[50,165,249,255]]),d=function(t){return function(e,i){var r=t[Math.floor(e*(t.length-1))];return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i}},m={cool:d(a),hot:d(s),verdant:d(u),spectral:d(f),temperature:d(h),grey:d(l),polar:d(c.concat(p))},g=function(t){var e=m[t.toLowerCase()];return e&&(this._colorRamp=e),this},v=function(){return this._colorRamp},y=function(){this._colorRamp=m.verdant};e.exports={initialize:y,setColorRamp:g,getColorRamp:v}}()},{}],41:[function(t,e,i){!function(){"use strict";function t(t,e,i){var r=Math.log10(e||1),n=Math.log10(i||1),o=Math.log10(t||1);return(o-r)/(n-r||1)}function i(t,e,i){var r=Math.log10(e||1),n=Math.log10(i||1);return Math.pow(10,t*n-t*r+r)}function r(t,e,i){var r=Math.abs(e),n=Math.abs(i),o=Math.max(r,n),a=t/(s*o);return 1/(1+Math.exp(-a))}function n(t,e,i){var r=Math.abs(e),n=Math.abs(i),o=Math.max(r,n);return 0===t?-o:1===t?o:Math.log(1/t-1)*-(s*o)}function o(t,e,i){var r=i-e;return(t-e)/r}function a(t,e,i){var r=i-e;return e+t*r}var s=.15,u={linear:o,log10:t,sigmoid:r},f={linear:a,log10:i,sigmoid:n},h=function(){this._range={min:0,max:1},this._transformFunc=t,this._inverseFunc=i},l=function(t){var e=t.toLowerCase();this._transformFunc=u[e],this._inverseFunc=f[e]},c=function(t){this._range.min=t.min,this._range.max=t.max},p=function(){return this._range},d=function(t){var e=this._range.min,i=this._range.max,r=(t-e)/(i-e);return Math.max(0,Math.min(1,r))},m=function(t){var e=this._extrema.min,i=this._extrema.max,r=Math.max(Math.min(t,i),e);return this._transformFunc(r,e,i)},g=function(t){var e=this._extrema.min,i=this._extrema.max,r=Math.max(Math.min(t,1),0);return this._inverseFunc(r,e,i)};e.exports={initialize:h,setTransformFunc:l,setValueRange:c,getValueRange:p,transformValue:m,untransformValue:g,interpolateToRange:d}}()},{}],42:[function(t,e,i){!function(){"use strict";var i=t("./Tiling"),r=function(t){return t!==this._params.binning.resolution&&(this._params.binning.resolution=t,this.clearExtrema()),this},n=function(){return this._params.binning.resolution};e.exports={setXField:i.setXField,getXField:i.getXField,setYField:i.setYField,getYField:i.getYField,setResolution:r,getResolution:n}}()},{"./Tiling":43}],43:[function(t,e,i){!function(){"use strict";var t="pixel.x",i="pixel.y",r=function(t,e){if(t){if(t.extrema)return!0;throw"Field `"+e+"` is not ordinal in meta data."}throw"Field `"+e+"` is not recognized in meta data."},n=function(e){if(e!==this._params.binning.x)if(e===t)this._params.binning.x=void 0,this._params.binning.left=void 0,this._params.binning.right=void 0,this.clearExtrema();else{var i=this._meta[e];r(i,e)&&(this._params.binning.x=e,this._params.binning.left=i.extrema.min,this._params.binning.right=i.extrema.max,this.clearExtrema())}return this},o=function(){return this._params.binning.x},a=function(t){if(t!==this._params.binning.y)if(t===i)this._params.binning.y=void 0,this._params.binning.bottom=void 0,this._params.binning.top=void 0,this.clearExtrema();else{var e=this._meta[t];r(e,t)&&(this._params.binning.y=t,this._params.binning.bottom=e.extrema.min,this._params.binning.top=e.extrema.max,this.clearExtrema())}return this},s=function(){return this._params.binning.y};e.exports={setXField:n,getXField:o,setYField:a,getYField:s,DEFAULT_X_FIELD:t,DEFAULT_Y_FIELD:i}}()},{}],44:[function(t,e,i){!function(){"use strict";function i(t,e){var i=_.keys(e);if(1!==i.length)throw"Bool sub-query must only have a single key, query has multiple keys: `"+JSON.stringify(i)+"`.";var r=i[0],n=o[r];if(!n)throw"Query type `"+r+"` is not recognized.";o[r](t,e[r])}function r(t,e){return _.isArray(e)?(e.forEach(function(e){i(t,e)}),e):(i(t,e),[e])}function n(t,e){if(!e.must&&!e.must_not&&!e.should)throw"Bool must have at least one `must`, `must_not`, or `should` query argument.";e.must&&r(t,e.must),e.must_not&&r(t,e.must_not),e.should&&r(t,e.should)}var o;o={bool:n,prefix:t("./Prefix"),query_string:t("./QueryString"),range:t("./Range"),terms:t("./Terms")},e.exports=n}()},{"./Prefix":45,"./QueryString":46,"./Range":47,"./Terms":48}],45:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"Prefix `field` "+e+" is not recognized in meta data.";if("string"!==t.type)throw"Prefix `field` "+e+" is not of type `string` in meta data."};e.exports=function(e,i){if(!i.field)throw"Prefix `field` is missing from argument";if(void 0===i.prefixes)throw"Prefix `prefixes` are missing from argument";t(e[i.field],i.field)}}()},{}],46:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"QueryString `field` "+e+" is not recognized in meta data.";if("string"!==t.type)throw"QueryString `field` "+e+" is not `string` in meta data."};e.exports=function(e,i){if(!i.field)throw"QueryString `field` is missing from argument.";if(!i.string)throw"QueryString `string` is missing from argument.";t(e[i.field],i.field)}}()},{}],47:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"Range `field` "+e+" is not recognized in meta data.";if(!t.extrema)throw"Range `field` "+e+" is not ordinal in meta data."};e.exports=function(e,i){if(!i.field)throw"Range `field` is missing from argument.";if(void 0===i.from)throw"Range `from` is missing from argument.";if(void 0===i.to)throw"Range `to` is missing from argument.";t(e[i.field],i.field)}}()},{}],48:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(!t)throw"Terms `field` "+e+" is not recognized in meta data.";if("string"!==t.type)throw"Terms `field` "+e+" is not of type `string` in meta data."};e.exports=function(e,i){if(!i.field)throw"Terms `field` is missing from argument.";if(void 0===i.terms)throw"Terms `terms` are missing from argument.";t(e[i.field],i.field)}}()},{}],49:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Binning"),n=t("../agg/Metric"),o=t("../mixin/ColorRamp"),a=t("../mixin/ValueTransform"),s=i.extend({includes:[r,n,o,a],type:"heatmap",initialize:function(){o.initialize.apply(this,arguments),a.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)},extractExtrema:function(t){var e=new Float64Array(t);return{min:_.min(e),max:_.max(e)}}});e.exports=s}()},{"../agg/Metric":29,"../core/Live":37,"../mixin/ColorRamp":40,"../mixin/ValueTransform":41,"../param/Binning":42}],50:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Binning"),n=t("../agg/TopHits"),o=i.extend({
includes:[r,n],type:"preview",initialize:function(){i.prototype.initialize.apply(this,arguments)},extractExtrema:function(){return{min:0,max:0}}});e.exports=o}()},{"../agg/TopHits":32,"../core/Live":37,"../param/Binning":42}],51:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Tiling"),n=t("../agg/TopTerms"),o=t("../agg/Histogram"),a=t("../mixin/ValueTransform"),s=i.extend({includes:[r,n,o,a],type:"top_count",initialize:function(){a.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=s}()},{"../agg/Histogram":28,"../agg/TopTerms":33,"../core/Live":37,"../mixin/ValueTransform":41,"../param/Tiling":43}],52:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Tiling"),n=t("../agg/TopTerms"),o=t("../agg/DateHistogram"),a=t("../agg/Histogram"),s=t("../mixin/ValueTransform"),u=i.extend({includes:[r,n,o,a,s],type:"top_frequency",initialize:function(){s.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=u}()},{"../agg/DateHistogram":27,"../agg/Histogram":28,"../agg/TopTerms":33,"../core/Live":37,"../mixin/ValueTransform":41,"../param/Tiling":43}],53:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Binning"),n=t("../agg/Terms"),o=t("../mixin/ColorRamp"),a=t("../mixin/ValueTransform"),s=i.extend({includes:[r,n,o,a],type:"top_trails",initialize:function(){o.initialize.apply(this,arguments),a.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)},extractExtrema:function(){return[0,0]}});e.exports=s}()},{"../agg/Terms":30,"../core/Live":37,"../mixin/ColorRamp":40,"../mixin/ValueTransform":41,"../param/Binning":42}],54:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Tiling"),n=t("../agg/TermsFilter"),o=t("../agg/Histogram"),a=t("../mixin/ValueTransform"),s=i.extend({includes:[r,n,o,a],type:"topic_count",initialize:function(){a.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=s}()},{"../agg/Histogram":28,"../agg/TermsFilter":31,"../core/Live":37,"../mixin/ValueTransform":41,"../param/Tiling":43}],55:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../param/Tiling"),n=t("../agg/TermsFilter"),o=t("../agg/DateHistogram"),a=t("../agg/Histogram"),s=t("../mixin/ValueTransform"),u=i.extend({includes:[r,n,o,a,s],type:"topic_frequency",initialize:function(){s.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=u}()},{"../agg/DateHistogram":27,"../agg/Histogram":28,"../agg/TermsFilter":31,"../core/Live":37,"../mixin/ValueTransform":41,"../param/Tiling":43}],56:[function(t,e,i){!function(){"use strict";var i=t("./DOM"),r=i.extend({options:{handlers:{}},onAdd:function(t){var e=this;i.prototype.onAdd.call(this,t),t.on("click",this.onClick,this),$(this._container).on("mousemove",function(t){e.onMouseMove(t)}),$(this._container).on("mouseover",function(t){e.onMouseOver(t)}),$(this._container).on("mouseout",function(t){e.onMouseOut(t)})},onRemove:function(t){t.off("click",this.onClick,this),$(this._container).off("mousemove"),$(this._container).off("mouseover"),$(this._container).off("mouseout"),i.prototype.onRemove.call(this,t)},createTile:function(){var t=L.DomUtil.create("canvas","leaflet-tile");return t.style["pointer-events"]="all",t.width=this.options.tileSize,t.height=this.options.tileSize,t},clearTiles:function(){var t=this.options.tileSize;_.forIn(this._tiles,function(e){var i=e.el.getContext("2d");i.clearRect(0,0,t,t)})},onMouseMove:function(){},onMouseOver:function(){},onMouseOut:function(){},onClick:function(){}});e.exports=r}()},{"./DOM":57}],57:[function(t,e,i){!function(){"use strict";function i(t,e){return(t%e+e)%e}var r=t("../../layer/core/Base"),n=r.extend({onAdd:function(t){L.GridLayer.prototype.onAdd.call(this,t),t.on("zoomstart",this.clearExtrema,this),this.on("tileload",this.onTileLoad,this),this.on("tileunload",this.onTileUnload,this)},onRemove:function(t){t.off("zoomstart",this.clearExtrema,this),this.off("tileload",this.onTileLoad,this),this.off("tileunload",this.onTileUnload,this),L.GridLayer.prototype.onRemove.call(this,t)},_getLayerPointFromEvent:function(t){var e=this._map.mouseEventToLatLng(t),r=this._map.project(e),n=this._map.getZoom(),o=Math.pow(2,n),a=this.options.tileSize;return{x:i(r.x,o*a),y:i(r.y,o*a)}},_getTileCoordFromLayerPoint:function(t){var e=this.options.tileSize;return{x:Math.floor(t.x/e),y:Math.floor(t.y/e),z:this._map.getZoom()}},_getBinCoordFromLayerPoint:function(t){var e=this.options.tileSize,r=this.getResolution()||e,n=i(t.x,e),o=i(t.y,e),a=e/r,s=Math.floor(n/a),u=Math.floor(o/a);return{x:s,y:u,index:s+u*r,size:a}},onCacheHit:function(t,e,i){e.data&&this.renderTile(t,e.data,i)},onCacheLoad:function(t,e,i){var r=this;e.data&&_.forIn(e.tiles,function(t){r.renderTile(t,e.data,i)})},onCacheLoadExtremaUpdate:function(){var t=this;_.forIn(this._cache,function(e){_.forIn(e.tiles,function(i,r){e.data&&t.renderTile(i,e.data,t.coordFromCacheKey(r))})})},createTile:function(){},requestTile:function(){},renderTile:function(){}});e.exports=n}()},{"../../layer/core/Base":34}],58:[function(t,e,i){!function(){"use strict";var i=t("./DOM"),r=i.extend({options:{handlers:{}},onAdd:function(t){var e=this;i.prototype.onAdd.call(this,t),t.on("click",this.onClick,this),$(this._container).on("mousemove",function(t){e.onMouseMove(t)}),$(this._container).on("mouseover",function(t){e.onMouseOver(t)}),$(this._container).on("mouseout",function(t){e.onMouseOut(t)})},onRemove:function(t){t.off("click",this.onClick,this),$(this._container).off("mousemove"),$(this._container).off("mouseover"),$(this._container).off("mouseout"),i.prototype.onRemove.call(this,t)},createTile:function(){var t=L.DomUtil.create("div","leaflet-tile leaflet-html-tile");return t},onMouseMove:function(){},onMouseOver:function(){},onMouseOut:function(){},onClick:function(){}});e.exports=r}()},{"./DOM":57}],59:[function(t,e,i){!function(){"use strict";var i=t("../../layer/core/Base"),r=function(){},n=i.extend({options:{zIndex:1},onAdd:function(t){t.on("zoomend",this.onZoomEnd,this),this.on("tileload",this.onTileLoad,this),this.on("tileunload",this.onTileUnload,this),this._tiles={},this._initContainer(),this._resetView(),this._update()},onRemove:function(t){t.off("zoomend",this.onZoomEnd,this),this.off("tileload",this.onTileLoad,this),this.off("tileunload",this.onTileUnload,this),this._removeAllTiles(),L.DomUtil.remove(this._container),t._removeZoomLimit(this),this._tileZoom=null},createTile:r,_updateOpacity:r,_initTile:r,_tileReady:r,_updateLevels:r,_removeTilesAtZoom:r,_setZoomTransforms:r,_initContainer:function(){this._container||(this._container=document.createElement("canvas"),this._container.className+="leaflet-layer leaflet-zoom-animated"),this._updateZIndex(),this.getPane().appendChild(this._container)},_pruneTiles:function(){if(this._map){var t=this._map.getZoom();if(t>this.options.maxZoom||t<this.options.minZoom)return void this._removeAllTiles();var e=this;_.forIn(this._tiles,function(t){t.retain=t.current}),_.forIn(this._tiles,function(t){if(t.current&&!t.active){var i=t.coords;e._retainParent(i.x,i.y,i.z,i.z-5)||e._retainChildren(i.x,i.y,i.z,i.z+2)}}),_.forIn(this._tiles,function(t,i){t.retain||e._removeTile(i)})}},_removeAllTiles:function(){var t=this;_.forIn(this._tiles,function(e,i){t._removeTile(i)})},_invalidateAll:function(){this._removeAllTiles(),this._tileZoom=null},_setView:function(t,e,i,r){var n=Math.round(e);(void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom)&&(n=void 0);var o=this.options.updateWhenZooming&&n!==this._tileZoom;r&&!o||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._resetGrid(),void 0!==n&&this._update(t),i||this._pruneTiles()),this._setZoomTransform(t,e)},_setZoomTransform:function(t,e){var i=this._map.getCenter(),r=this._map.getZoom(),n=this._map.getZoomScale(e,r),o=L.DomUtil.getPosition(this._container),a=this._map.getSize().multiplyBy(.5),s=this._map.project(i,e),u=this._map.project(t,e),f=u.subtract(s),h=a.multiplyBy(-n).add(o).add(a).subtract(f);L.Browser.any3d?L.DomUtil.setTransform(this._container,h,n):L.DomUtil.setPosition(this._container,h)},_update:function(t){var e=this._map;if(e){var i=e.getZoom();if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(r),o=n.getCenter(),a=[];if(_.forIn(this._tiles,function(t){t.current=!1}),Math.abs(i-this._tileZoom)>1)return void this._setView(t,i);var s,u;for(u=n.min.y;u<=n.max.y;u++)for(s=n.min.x;s<=n.max.x;s++){var f=new L.Point(s,u);if(f.z=this._tileZoom,this._isValidTile(f)){var h=this._tiles[this._tileCoordsToKey(f)];h?h.current=!0:a.push(f)}}if(a.sort(function(t,e){return t.distanceTo(o)-e.distanceTo(o)}),0!==a.length)for(this._loading||(this._loading=!0,this.fire("loading")),s=0;s<a.length;s++)this._addTile(a[s])}}},_removeTile:function(t){var e=this._tiles[t];e&&(delete this._tiles[t],this.fire("tileunload",{coords:this._keyToTileCoords(t)}))},_addTile:function(t){var e=this._tileCoordsToKey(t),i=this._tiles[e]={coords:t,current:!0};this.fire("tileloadstart",{coords:t}),i.loaded=+new Date,i.active=!0,this._pruneTiles(),this.fire("tileload",{coords:t}),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),L.Browser.ielt9||!this._map._fadeAnimated?L.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(L.bind(this._pruneTiles,this),250))}});e.exports=n}()},{"../../layer/core/Base":34}],60:[function(t,e,i){!function(){"use strict";var i=t("esper"),r=t("./Overlay"),n=r.extend({onAdd:function(t){r.prototype.onAdd.call(this,t),t.on("zoomstart",this.onZoomStart,this),t.on("zoomend",this.onZoomEnd,this)},onRemove:function(t){r.prototype.onRemove.call(this,t),t.off("zoomstart",this.onZoomStart,this),t.off("zoomend",this.onZoomEnd,this)},onZoomStart:function(){this._isZooming=!0},onZoomEnd:function(){this._isZooming=!1,this._renderFrame()},onCacheHit:function(){},onCacheLoad:function(t,e,i){e.data&&this._bufferTileTexture(e,i)},onCacheLoadExtremaUpdate:function(){var t=this;_.forIn(this._cache,function(e){e.data&&t._bufferTileTexture(e)})},_initContainer:function(){r.prototype._initContainer.call(this),this._gl||this._initGL()},_initGL:function(){var t=this,e=this._gl=i.WebGLContext.get(this._container);if(!e)throw"Unable to acquire a WebGL context";e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),e.disable(e.DEPTH_TEST),t._renderable=new i.Renderable({vertices:{0:[[0,-256],[256,-256],[256,0],[0,0]],1:[[0,0],[1,0],[1,1],[0,1]]},indices:[0,1,2,0,2,3]}),new i.Shader({vert:this.options.shaders.vert,frag:this.options.shaders.frag},function(e,r){if(e)return void console.error(e);var n=t._container.width,o=t._container.height;t._viewport=new i.Viewport({width:n,height:o}),t._initialized=!0,t._shader=r,t._draw()})},_getTranslationMatrix:function(t,e,i){var r=new Float32Array(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t,r[13]=e,r[14]=i,r[15]=1,r},_getOrthoMatrix:function(t,e,i,r,n,o){var a=new Float32Array(16);return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(r-i),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(o-n),a[11]=0,a[12]=-((e+t)/(e-t)),a[13]=-((r+i)/(r-i)),a[14]=-((o+n)/(o-n)),a[15]=1,a},_getProjection:function(){var t=this._map.getPixelBounds(),e=256*Math.pow(2,this._map.getZoom());return this._getOrthoMatrix(t.min.x,t.max.x,e-t.max.y,e-t.min.y,-1,1)},_draw:function(){this._initialized&&(this.isHidden()||this._isZooming||this._renderFrame(),requestAnimationFrame(this._draw.bind(this)))},_renderFrame:function(){var t=this._map.getSize();this._container.width=t.x,this._container.height=t.y,this._viewport.resize(t.x,t.y);var e=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._container,e);var i=this._gl;this._viewport.push(),this._shader.push(),this._shader.setUniform("uProjectionMatrix",this._getProjection()),this._shader.setUniform("uOpacity",this.getOpacity()),this._shader.setUniform("uTextureSampler",0),i.clear(i.COLOR_BUFFER_BIT),this._renderTiles(),this._shader.pop(),this._viewport.pop()},_renderTiles:function(){var t=this,e=256*Math.pow(2,this._map.getZoom());_.forIn(this._cache,function(i){i.texture&&(i.texture.push(0),_.forIn(i.tiles,function(i,r){var n=t.coordFromCacheKey(r),o=t._getTranslationMatrix(256*n.x,e-256*n.y,0);t._shader.setUniform("uModelMatrix",o),t._renderable.draw()}))})},_bufferTileTexture:function(t){var e,r,n,o,a=new Float64Array(t.data),s=Math.sqrt(a.length),u=new ArrayBuffer(4*a.length),f=new Uint8Array(u),h=[0,0,0,0],l=this.getColorRamp(),c=this;for(o=0;o<a.length;o++)n=a[o],0===n?(h[0]=0,h[1]=0,h[2]=0,h[3]=0):(e=c.transformValue(n),r=c.interpolateToRange(e),l(r,h)),f[4*o]=h[0],f[4*o+1]=h[1],f[4*o+2]=h[2],f[4*o+3]=h[3];t.texture=new i.Texture2D({height:s,width:s,src:f,format:"RGBA",type:"UNSIGNED_BYTE",wrap:"CLAMP_TO_EDGE",filter:"NEAREST",invertY:!0})}});e.exports=n}()},{"./Overlay":59,esper:15}],61:[function(t,e,i){!function(){"use strict";var i={Heatmap:t("./type/canvas/Heatmap"),TopTrails:t("./type/canvas/TopTrails"),Preview:t("./type/canvas/Preview")},r={Heatmap:t("./type/html/Heatmap"),Ring:t("./type/html/Ring"),WordCloud:t("./type/html/WordCloud"),WordHistogram:t("./type/html/WordHistogram")},n={Heatmap:t("./type/webgl/Heatmap")},o={Blink:t("./type/pending/Blink"),Spin:t("./type/pending/Spin"),BlinkSpin:t("./type/pending/BlinkSpin")},a={Coord:t("./type/debug/Coord")};e.exports={HTML:r,Canvas:i,WebGL:n,Debug:a,Pending:o}}()},{"./type/canvas/Heatmap":63,"./type/canvas/Preview":64,"./type/canvas/TopTrails":65,"./type/debug/Coord":66,"./type/html/Heatmap":67,"./type/html/Ring":68,"./type/html/WordCloud":69,"./type/html/WordHistogram":70,"./type/pending/Blink":71,"./type/pending/BlinkSpin":72,"./type/pending/Spin":73,"./type/webgl/Heatmap":74}],62:[function(t,e,i){!function(){"use strict";function t(t,e){t=void 0!==t?t:-1,e=void 0!==e?e:1;var i=[.25*e,.5*e,.75*e],r=[-.25*t,-.5*t,-.75*t];return function(t){var e,n;0>t?(e="neg-",n=r):(e="pos-",n=i);var o=Math.abs(t);return o>n[2]?e+"4":o>n[1]?e+"3":o>n[0]?e+"2":e+"1"}}function i(t){if(!t)return 0;var e=t[n]?t[n]:0,i=t[o]?t[o]:0,r=t[a]?t[a]:0;return e+i+r}function r(t){if(!t)return 0;var e=t[n]?t[n]:0,i=t[o]?t[o]:0,r=t[a]?t[a]:0,s=e+i+r;return 0!==s?(e-r)/s:0}var n="1",o="0",a="-1";e.exports={getClassFunc:t,getTotal:i,getAvg:r}}()},{}],63:[function(t,e,i){!function(){"use strict";var i=t("../../core/Canvas"),r=i.extend({renderCanvas:function(t,e,i){var r=document.createElement("canvas");r.height=e,r.width=e;var n,o,a,s,u=r.getContext("2d"),f=u.getImageData(0,0,e,e),h=f.data,l=this,c=[0,0,0,0];for(s=0;s<t.length;s++)a=t[s],0===a?(c[0]=0,c[1]=0,c[2]=0,c[3]=0):(n=l.transformValue(a),o=l.interpolateToRange(n),i(o,c)),h[4*s]=c[0],h[4*s+1]=c[1],h[4*s+2]=c[2],h[4*s+3]=c[3];return u.putImageData(f,0,0),r},renderTile:function(t,e){if(e){var i=new Float64Array(e),r=Math.sqrt(i.length),n=this.getColorRamp(),o=this.renderCanvas(i,r,n),a=t.getContext("2d");a.imageSmoothingEnabled=!1,a.drawImage(o,0,0,r,r,0,0,t.width,t.height)}}});e.exports=r}()},{"../../core/Canvas":56}],64:[function(t,e,i){!function(){"use strict";var i=t("../../core/Canvas"),r=i.extend({options:{lineWidth:2,lineColor:"lightblue",fillColor:"darkblue"},highlighted:!1,_drawHighlight:function(t,e,i,r){var n=r/2,o=t.getContext("2d");o.beginPath(),o.fillStyle=this.options.fillColor,o.arc(e*r+n,i*r+n,n,0,2*Math.PI,!1),o.fill(),o.lineWidth=this.options.lineWidth,o.strokeStyle=this.options.lineColor,o.stroke()},onMouseMove:function(t){var e=$(t.originalEvent.target);this.highlighted&&(this.clearTiles(),this.highlighted=!1);var i=this._getLayerPointFromEvent(t),r=this._getTileCoordFromLayerPoint(i),n=this.cacheKeyFromCoord(r,!0),o=this._cache[n];if(o&&o.data){var a=this._getBinCoordFromLayerPoint(i),s=o.data[a.index];if(s){var u=this;return _.forIn(o.tiles,function(t){u._drawHighlight(t,a.x,a.y,a.size)}),this.highlighted=!0,void(this.options.handlers.mousemove&&this.options.handlers.mousemove(e,{value:s,x:r.x,y:r.z,z:r.z,bx:a.x,by:a.y,type:"preview",layer:this}))}}this.options.handlers.mousemove&&this.options.handlers.mousemove(e,null)}});e.exports=r}()},{"../../core/Canvas":56}],65:[function(t,e,i){!function(){"use strict";var i=t("../../core/Canvas"),r=i.extend({options:{color:[255,0,255,255],downSampleFactor:8},highlighted:!1,onMouseMove:function(t){var e=$(t.originalEvent.target);this.highlighted&&(this.clearTiles(),this.highlighted=!1);var i=this._getLayerPointFromEvent(t),r=this._getTileCoordFromLayerPoint(i),n=this.cacheKeyFromCoord(r,!0),o=this._cache[n];if(o&&o.pixels){var a=this._getBinCoordFromLayerPoint(i),s=Math.floor(a.x/this.options.downSampleFactor),u=Math.floor(a.y/this.options.downSampleFactor);if(o.pixels[s]&&o.pixels[s][u]){var f=Object.keys(o.pixels[s][u]),h=f[0],l=this;return _.forIn(this._cache,function(t){t.data&&_.forIn(t.tiles,function(e){var i=t.trails[h];i&&l._highlightTrail(e,i)})}),this.options.handlers.mousemove&&this.options.handlers.mousemove(e,{value:h,x:r.x,y:r.z,z:r.z,bx:a.x,by:a.y,type:"top-trails",layer:this}),void(this.highlighted=!0)}}this.options.handlers.mousemove&&this.options.handlers.mousemove(e,null)},_highlightTrail:function(t,e){var i=this.getResolution()||this.options.tileSize,r=document.createElement("canvas");r.height=i,r.width=i;var n,o,a,s,u,f=r.getContext("2d"),h=f.getImageData(0,0,i,i),l=h.data;for(s=0;s<e.length;s++)n=e[s],o=n[0],a=n[1],u=o+i*a,l[4*u]=this.options.color[0],l[4*u+1]=this.options.color[1],l[4*u+2]=this.options.color[2],l[4*u+3]=this.options.color[3];f.putImageData(h,0,0);var c=t.getContext("2d");c.imageSmoothingEnabled=!1,c.drawImage(r,0,0,i,i,0,0,t.width,t.height)},renderTile:function(t,e,i){if(e){var r=this.cacheKeyFromCoord(i,!0),n=this._cache[r];if(!n.trails){var o,a,s,u,f,h,l,c,p,d=n.trails={},m=n.pixels={},g=Object.keys(e);for(u=0;u<g.length;u++)for(s=g[u],o=e[s],f=0;f<o.length;f++)a=o[f],h=Math.floor(a[0]/this.options.downSampleFactor),l=Math.floor(a[1]/this.options.downSampleFactor),m[h]=m[h]||{},m[h][l]=m[h][l]||{},m[h][l][s]=!0,c=a[0],p=a[1],d[s]=d[s]||[],d[s].push([c,p])}}}});e.exports=r}()},{"../../core/Canvas":56}],66:[function(t,e,i){!function(){"use strict";e.exports={renderTile:function(t,e){$(t).empty(),$(t).append('<div style="top:0; left:0;">'+e.z+", "+e.x+", "+e.y+"</div>")}}}()},{}],67:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=i.extend({isTargetLayer:function(t){return this._container&&$.contains(this._container,t)},onMouseOver:function(t){var e=$(t.originalEvent.target),i=e.attr("data-value");if(i&&this.options.handlers.mouseover){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseover(e,{value:parseInt(i,10),x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),bx:parseInt(e.attr("data-bx"),10),by:parseInt(e.attr("data-by"),10),type:"heatmap",layer:this})}},onMouseOut:function(t){var e=$(t.originalEvent.target),i=e.attr("data-value");if(i&&this.options.handlers.mouseout){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseout(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),bx:parseInt(e.attr("data-bx"),10),by:parseInt(e.attr("data-by"),10),type:"heatmap",layer:this})}},onClick:function(t){$(".heatmap-pixel").removeClass("highlight");var e=$(t.originalEvent.target);if(this.isTargetLayer(t.originalEvent.target)){e.hasClass("heatmap-pixel")&&e.addClass("highlight");var i=e.attr("data-value");if(i&&this.options.handlers.click){var r=e.parents(".leaflet-html-tile");this.options.handlers.click(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),bx:parseInt(e.attr("data-bx"),10),by:parseInt(e.attr("data-by"),10),type:"heatmap",layer:this})}}},renderTile:function(t,e){if(e){var i,r,n,o,a,s,u=new Float64Array(e),f=Math.sqrt(u.length),h=this.getColorRamp(),l=this.options.tileSize/f,c=this,p=[0,0,0,0],d="";for(s=0;s<u.length;s++)if(n=u[s],0!==n){o=s%f,a=Math.floor(s/f),i=c.transformValue(n),r=c.interpolateToRange(i),h(r,p);var m="rgba("+p[0]+","+p[1]+","+p[2]+","+p[3]/255+")";d+='<div class="heatmap-pixel" data-value="'+n+'" data-bx="'+o+'" data-by="'+a+'" style="height:'+l+"px;width:"+l+"px;left:"+o*l+"px;top:"+a*l+"px;background-color:"+m+';"></div>'}t.innerHTML=d}}});e.exports=r}()},{"../../core/HTML":58}],68:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=i.extend({onClick:function(t){var e=$(t.originalEvent.target);$(".heatmap-ring").removeClass("highlight"),e.hasClass("heatmap-ring")&&e.addClass("highlight")},renderTile:function(t,e){if(e){var i=this,r=new Float64Array(e),n=Math.sqrt(r.length),o=this.options.tileSize/n,a="";r.forEach(function(t,e){if(t){var r=i.transformValue(t),s=r*o,u=(o-s)/2,f=e%n*o,h=Math.floor(e/n)*o;a+='<div class="heatmap-ring" style="left:'+(f+u)+"px;top:"+(h+u)+"px;width:"+s+"px;height:"+s+'px;"></div>'}}),t.innerHTML=a}}});e.exports=r}()},{"../../core/HTML":58}],69:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=t("../../sentiment/Sentiment"),n=r.getClassFunc(-1,1),o=24,a=10,s=1,u=function(t){var e=2*Math.PI,i=e*t.radius,r=t.arcLength>i/10?i/10:t.arcLength,n=r/t.radius,o=t.t+n;return o>e&&(o%=e,t.radius=t.radius+t.radiusInc),t.t=o,t.x=t.radius*Math.cos(o),t.y=t.radius*Math.sin(o),t},f=function(t,e){return 2*Math.abs(t.x-e.x)<t.width+e.width&&2*Math.abs(t.y-e.y)<t.height+e.height},h=function(t,e){return t.x+t.width/2>e.x+e.width/2||t.x-t.width/2<e.x-e.width/2||t.y+t.height/2>e.y+e.height/2||t.y-t.height/2<e.y-e.height/2},l=function(t,e,i,r){var n,o={x:t.x,y:t.y,height:e.height,width:e.width};for(n=0;n<i.length;n++)if(f(o,i[n]))return!0;return h(o,r)?(t.collisions++,t.arcLength=t.radius,!0):!1},c=i.extend({options:{maxNumWords:15,minFontSize:10,maxFontSize:20},isTargetLayer:function(t){return this._container&&$.contains(this._container,t)},clearSelection:function(){$(this._container).removeClass("highlight"),this.highlight=null},onMouseOver:function(t){var e=$(t.originalEvent.target);$(".word-cloud-label").removeClass("hover");var i=e.attr("data-word");if(i&&($(".word-cloud-label[data-word="+i+"]").addClass("hover"),this.options.handlers.mouseover)){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseover(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-cloud",layer:this})}},onMouseOut:function(t){var e=$(t.originalEvent.target);$(".word-cloud-label").removeClass("hover");var i=e.attr("data-word");if(i&&this.options.handlers.mouseout){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseout(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-cloud",layer:this})}},onClick:function(t){$(".word-cloud-label").removeClass("highlight"),$(this._container).removeClass("highlight");var e=$(t.originalEvent.target);if(this.isTargetLayer(t.originalEvent.target)){var i=e.attr("data-word");if(i){if($(this._container).addClass("highlight"),$(".word-cloud-label[data-word="+i+"]").addClass("highlight"),this.highlight=i,this.options.handlers.click){var r=e.parents(".leaflet-html-tile");this.options.handlers.click(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-cloud",layer:this})}}else this.clearSelection()}},_measureWords:function(t){t=t.sort(function(t,e){return e.count-t.count}).slice(0,this.options.maxNumWords);var e='<div style="height:256px; width:256px;">',i=this.options.minFontSize,r=this.options.maxFontSize,n=this;t.forEach(function(t){t.percent=n.transformValue(t.count),t.fontSize=i+t.percent*(r-i),e+='<div class="word-cloud-label" style="visibility:hidden;font-size:'+t.fontSize+'px;">'+t.text+"</div>"}),e+="</div>";var o=$(e);return $("body").append(o),o.children().each(function(e){t[e].width=this.offsetWidth,t[e].height=this.offsetHeight}),o.remove(),t},_createWordCloud:function(t){var e=this.options.tileSize,i={width:e-2*a,height:e-2*o,x:0,y:0},r=[];return t=this._measureWords(t),t.forEach(function(t){for(var e={radius:1,radiusInc:5,arcLength:10,x:0,y:0,t:0,collisions:0};e.collisions<s;)if(e=u(e),!l(e,t,r,i)){r.push({text:t.text,fontSize:t.fontSize,percent:10*Math.round(100*t.percent/10),x:e.x,y:e.y,width:t.width,height:t.height,sentiment:t.sentiment,avg:t.avg});break}}),r},extractExtrema:function(t){var e=_.map(t,function(t){return _.isNumber(t)?t:r.getTotal(t)});return{min:_.min(e),max:_.max(e)}},renderTile:function(t,e){if(e&&!_.isEmpty(e)){var i=this.highlight,o=_.map(e,function(t,e){if(_.isNumber(t))return{count:t,text:e};var i=r.getTotal(t),o=r.getAvg(t);return{count:i,text:e,avg:o,sentiment:n(o)}});if(0!==o.length){var a=this._createWordCloud(o),s=this.options.tileSize/2,u="";a.forEach(function(t){var e=["word-cloud-label","word-cloud-label-"+t.percent,t.text===i?"highlight":"",t.sentiment?t.sentiment:""].join(" "),r=["font-size:"+t.fontSize+"px","left:"+(s+t.x-t.width/2)+"px","top:"+(s+t.y-t.height/2)+"px","width:"+t.width+"px","height:"+t.height+"px"].join(";");u+='<div class="'+e+'"style="'+r+'"data-sentiment="'+t.avg+'"data-word="'+t.text+'">'+t.text+"</div>"}),t.innerHTML=u}}}});e.exports=c}()},{"../../core/HTML":58,"../../sentiment/Sentiment":62}],70:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=t("../../sentiment/Sentiment"),n=r.getClassFunc(-1,1),o=function(t){return null!==t&&_.isNumber(t)},a=function(t){return o(t)?t:r.getTotal(t)},s=function(t){return void 0!==t?n(t):""},u=function(t){return o(t)?{count:t}:{count:r.getTotal(t),avg:r.getAvg(t)}},f=function(t){if(void 0!==t[0].avg){var e=_.sumBy(t,function(t){return t.avg});return e/t.length}},h=function(t,e){var i=_.map(t,u),r=f(i),n=_.maxBy(i,function(t){return t.count}).count,o=_.sumBy(i,function(t){return t.count});return{topic:e,frequencies:i,max:n,total:o,avg:r}},l=i.extend({options:{maxNumWords:8,minFontSize:16,maxFontSize:22},isTargetLayer:function(t){return this._container&&$.contains(this._container,t)},clearSelection:function(){$(this._container).removeClass("highlight"),this.highlight=null},onMouseOver:function(t){var e=$(t.originalEvent.target);$(".word-histogram-entry").removeClass("hover");var i=e.attr("data-word");if(i&&($(".word-histogram-entry[data-word="+i+"]").addClass("hover"),this.options.handlers.mouseover)){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseover(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-histogram",layer:this})}},onMouseOut:function(t){var e=$(t.originalEvent.target);$(".word-histogram-entry").removeClass("hover");var i=e.attr("data-word");if(i&&this.options.handlers.mouseout){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseout(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-histogram",layer:this})}},onClick:function(t){$(".word-histogram-entry").removeClass("highlight"),$(this._container).removeClass("highlight");var e=$(t.originalEvent.target);if(this.isTargetLayer(t.originalEvent.target)){var i=e.attr("data-word");if(i){if($(this._container).addClass("highlight"),$(".word-histogram-entry[data-word="+i+"]").addClass("highlight"),this.highlight=i,this.options.handlers.click){var r=e.parents(".leaflet-html-tile");this.options.handlers.click(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-histogram",layer:this})}}else this.clearSelection()}},extractExtrema:function(t){var e=_.map(t,function(t){return _.sumBy(t,a)});return{min:_.min(e),max:_.max(e)}},renderTile:function(t,e){if(e&&!_.isEmpty(e)){var i=this.highlight,r=_.map(e,h).sort(function(t,e){return e.total-t.total}),n=Math.min(r.length,this.options.maxNumWords),o=$('<div class="word-histograms" style="display:inline-block;"></div>'),a=0,u=this.options.minFontSize,f=this.options.maxFontSize,l=this;r.slice(0,n).forEach(function(t){var e=t.topic,r=t.frequencies,n=t.max,h=t.total,c=t.avg,p=s(c),d=e===i?"highlight":"",m=l.transformValue(h),g=10*Math.round(100*m/10),v=u+m*(f-u);a+=v;var y=$('<div class="word-histogram-entry '+d+'" data-sentiment="'+c+'"data-word="'+e+'"style="height:'+v+'px;"></div>'),_=$('<div class="word-histogram-left"data-sentiment="'+c+'"data-word="'+e+'"></div>'),x="calc("+100/r.length+"%)";r.forEach(function(t){var i,r,o=t.count,a=t.avg,u=s(a),f=0!==n?o/n*100:0,h=0===f?"hidden":"",l=10*Math.round(f/10),c=["word-histogram-bar","word-histogram-bar-"+l,u+"-fill"].join(" ");3>f/100*v?(i="3px",r="calc(100% - 3px)"):(i=f+"%",r=100-f+"%"),_.append('<div class="'+c+'"data-word="'+e+'"style="visibility:'+h+";width:"+x+";height:"+i+";top:"+r+';"></div>')}),y.append(_);var T=["word-histogram-label","word-histogram-label-"+g,p].join(" "),E=$('<div class="word-histogram-right"><div class="'+T+'"data-sentiment="'+c+'"data-word="'+e+'"style="font-size:'+v+"px;line-height:"+v+"px;height:"+v+'px">'+e+"</div></div>");y.append(E),o.append(y)}),o.css("top",this.options.tileSize/2-a/2),t.innerHTML=o[0].outerHTML}}});e.exports=l}()},{"../../core/HTML":58,"../../sentiment/Sentiment":62}],71:[function(t,e,i){!function(){"use strict";var t=1200;e.exports={renderTile:function(e){var i=-(Math.random()*t)+"ms";e.innerHTML='<div class="blinking blinking-tile" style="animation-delay:'+i+'"></div>'}}}()},{}],72:[function(t,e,i){!function(){"use strict";var t=1200;e.exports={renderTile:function(e){var i=-(Math.random()*t)+"ms";e.innerHTML='<div class="vertical-centered-box blinking" style="animation-delay:'+i+'"><div class="content"><div class="loader-circle"></div><div class="loader-line-mask" style="animation-delay:'+i+'"><div class="loader-line"></div></div></div></div>'}}}()},{}],73:[function(t,e,i){!function(){"use strict";var t=1200;e.exports={renderTile:function(e){var i=-(Math.random()*t)+"ms";e.innerHTML='<div class="vertical-centered-box" style="animation-delay:'+i+'"><div class="content"><div class="loader-circle"></div><div class="loader-line-mask" style="animation-delay:'+i+'"><div class="loader-line"></div></div></div></div>'}}}()},{}],74:[function(t,e,i){!function(){"use strict";var i=t("../../core/WebGL"),r=["precision highp float;","attribute vec2 aPosition;","attribute vec2 aTextureCoord;","uniform mat4 uProjectionMatrix;","uniform mat4 uModelMatrix;","varying vec2 vTextureCoord;","void main() {","vTextureCoord = aTextureCoord;","gl_Position = uProjectionMatrix * uModelMatrix * vec4( aPosition, 0.0, 1.0 );","}"].join(""),n=["precision highp float;","uniform sampler2D uTextureSampler;","uniform float uOpacity;","varying vec2 vTextureCoord;","void main() {","vec4 color = texture2D(uTextureSampler, vTextureCoord);","gl_FragColor = vec4(color.rgb, color.a * uOpacity);","}"].join(""),o=i.extend({options:{shaders:{vert:r,frag:n}}});e.exports=o}()},{"../../core/WebGL":60}],75:[function(t,e,i){!function(){"use strict";function i(){r.apply(this,arguments)}var r=t("./Requestor");i.prototype=Object.create(r.prototype),i.prototype.getHash=function(t){return t.type+"-"+t.index+"-"+t.store},i.prototype.getURL=function(t){return"meta/"+t.type+"/"+t.endpoint+"/"+t.index+"/"+t.store},e.exports=i}()},{"./Requestor":76}],76:[function(t,e,i){!function(){"use strict";function t(){var t,e=window.location;return t="https:"===e.protocol?"wss:":"ws:",t+"//"+e.host+e.pathname}function i(e,r){e.socket=new WebSocket(t()+e.url),e.socket.onopen=function(){e.isOpen=!0,console.log("Websocket connection established"),r.apply(this,arguments)},e.socket.onmessage=function(t){var i=JSON.parse(t.data),r=e.getHash(i),n=e.requests[r];delete e.requests[r],i.success?n.resolve(e.getURL(i),i):n.reject(i)},e.socket.onclose=function(){e.isOpen&&console.warn("Websocket connection closed, attempting to re-connect in "+n),e.socket=null,e.isOpen=!1,Object.keys(e.requests).forEach(function(t){
e.requests[t].reject()}),e.requests={},setTimeout(function(){i(e,function(){e.pending.forEach(function(t){e.get(t)}),e.pending=[]})},n)}}function r(t,e){this.url=t,this.requests={},this.pending=[],this.isOpen=!1,i(this,e)}var n=5e3;r.prototype.getHash=function(){},r.prototype.getURL=function(){},r.prototype.get=function(t){if(!this.isOpen)return void this.pending.push(t);var e=this.getHash(t),i=this.requests[e];return i?i.promise():(i=this.requests[e]=$.Deferred(),this.socket.send(JSON.stringify(t)),i.promise())},r.prototype.close=function(){this.socket.onclose=null,this.socket.close(),this.socket=null},e.exports=r}()},{}],77:[function(t,e,i){!function(){"use strict";function i(t){return function e(t){return _.forOwn(t,function(i,r){(_.isUndefined(i)||_.isNull(i)||_.isNaN(i)||_.isString(i)&&_.isEmpty(i)||_.isObject(i)&&_.isEmpty(e(i)))&&delete t[r]}),_.isArray(t)&&_.pull(t,void 0),t}(_.cloneDeep(t))}function r(){o.apply(this,arguments)}var n=t("json-stable-stringify"),o=t("./Requestor");r.prototype=Object.create(o.prototype),r.prototype.getHash=function(t){var e=t.coord,r=n(i(t.params));return t.type+"-"+t.index+"-"+t.store+"-"+e.x+"-"+e.y+"-"+e.z+"-"+r},r.prototype.getURL=function(t){var e=t.coord;return"tile/"+t.type+"/"+t.index+"/"+t.store+"/"+e.z+"/"+e.x+"/"+e.y},e.exports=r}()},{"./Requestor":76,"json-stable-stringify":22}]},{},[26])(26)});