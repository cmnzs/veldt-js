!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.prism=t()}}(function(){var t;return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var l=i[a]={exports:{}};t[a][0].call(l.exports,function(e){var i=t[a][1][e];return n(i?i:e)},l,l.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,i,r){(function(){var e,i,n,o,a,s,u,f,l,h,c,d,p,m,g=[].slice;a="3.0.0",i="pending",o="resolved",n="rejected",l=function(t,e){return null!=t?t.hasOwnProperty(e):void 0},c=function(t){return l(t,"length")&&l(t,"callee")},d=function(t){return l(t,"promise")&&"function"==typeof(null!=t?t.promise:void 0)},f=function(t){return c(t)?f(Array.prototype.slice.call(t)):Array.isArray(t)?t.reduce(function(t,e){return Array.isArray(e)?t.concat(f(e)):(t.push(e),t)},[]):[t]},s=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},p=function(t,e){return function(){var i;return i=[t].concat(Array.prototype.slice.call(arguments,0)),e.apply(this,i)}},u=function(t,e,i){var r,n,o,a,s;for(a=f(t),s=[],n=0,o=a.length;o>n;n++)r=a[n],s.push(r.call.apply(r,[i].concat(g.call(e))));return s},e=function(){var t,r,a,s,l,h,c;return c=i,s=[],l=[],h=[],a={resolved:{},rejected:{},pending:{}},this.promise=function(t){var r,p;return t=t||{},t.state=function(){return c},p=function(e,r,n){return function(){return c===i&&r.push.apply(r,f(arguments)),e()&&u(arguments,a[n]),t}},t.done=p(function(){return c===o},s,o),t.fail=p(function(){return c===n},l,n),t.progress=p(function(){return c!==i},h,i),t.always=function(){var e;return(e=t.done.apply(t,arguments)).fail.apply(e,arguments)},r=function(i,r,n){var o,a;return a=new e,o=function(e,i,r){return r?t[e](function(){var t,e;return t=1<=arguments.length?g.call(arguments,0):[],e=r.apply(null,t),d(e)?e.done(a.resolve).fail(a.reject).progress(a.notify):a[i](e)}):t[e](a[i])},o("done","resolve",i),o("fail","reject",r),o("progress","notify",n),a},t.pipe=r,t.then=r,null==t.promise&&(t.promise=function(){return t}),t},this.promise(this),t=this,r=function(e,r,n){return function(){return c===i?(c=e,a[e]=arguments,u(r,a[e],n),t):this}},this.resolve=r(o,s),this.reject=r(n,l),this.notify=r(i,h),this.resolveWith=function(t,e){return r(o,s,t).apply(null,e)},this.rejectWith=function(t,e){return r(n,l,t).apply(null,e)},this.notifyWith=function(t,e){return r(i,h,t).apply(null,e)},this},m=function(){var t,i,r,n,o,a,u;if(i=f(arguments),1===i.length)return d(i[0])?i[0]:(new e).resolve(i[0]).promise();if(o=new e,!i.length)return o.resolve().promise();for(n=[],r=s(i.length,function(){return o.resolve.apply(o,n)}),i.forEach(function(t,e){return d(t)?t.done(function(){var t;return t=1<=arguments.length?g.call(arguments,0):[],n[e]=t.length>1?t:t[0],r()}):(n[e]=t,r())}),a=0,u=i.length;u>a;a++)t=i[a],d(t)&&t.fail(o.reject);return o.promise()},h=function(t){return t.Deferred=function(){return new e},t.ajax=p(t.ajax,function(t,i){var r,n,o,a;return null==i&&(i={}),n=new e,r=function(t,e){return p(t,function(){var t,i;return i=arguments[0],t=2<=arguments.length?g.call(arguments,1):[],i&&i.apply(null,t),e.apply(null,t)})},i.success=r(i.success,n.resolve),i.error=r(i.error,n.reject),a=t(i),o=n.promise(),o.abort=function(){return a.abort()},o}),t.when=m},"undefined"!=typeof r?(r.Deferred=function(){return new e},r.when=m,r.installInto=h):"function"==typeof t&&t.amd?t(function(){return"undefined"!=typeof Zepto?h(Zepto):(e.when=m,e.installInto=h,e)}):"undefined"!=typeof Zepto?h(Zepto):(this.Deferred=function(){return new e},this.Deferred.when=m,this.Deferred.installInto=h)}).call(this)},{}],2:[function(t,e,i){!function(){"use strict";function i(t,e){e=e||{},this.gl=r.get(),this.buffer=0,t&&(t instanceof WebGLBuffer?(this.buffer=t,this.type=e.type||"UNSIGNED_SHORT",this.count=void 0!==e.count?e.count:0):this.bufferData(t)),this.offset=void 0!==e.offset?e.offset:0,this.mode=void 0!==e.mode?e.mode:"TRIANGLES"}var r=t("./WebGLContext"),n=null;i.prototype.bufferData=function(t){var e=this.gl,i=r.checkExtension("OES_element_index_uint");if(i?t instanceof Array&&(t=new Uint32Array(t)):t instanceof Array?t=new Uint16Array(t):t instanceof Uint32Array&&(console.warn("Cannot create IndexBuffer of format gl.UNSIGNED_INT as OES_element_index_uint is not supported, defaulting to gl.UNSIGNED_SHORT."),t=new Uint16Array(t)),t instanceof Uint16Array)this.type="UNSIGNED_SHORT";else{if(!(t instanceof Uint32Array))return void console.error("IndexBuffer requires an Array or ArrayBuffer argument, command ignored.");this.type="UNSIGNED_INT"}return this.buffer||(this.buffer=e.createBuffer()),this.count=t.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this},i.prototype.bind=function(){if(n!==this){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),n=this,this}},i.prototype.unbind=function(){if(null!==n){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),n=null,this}},i.prototype.draw=function(t){if(t=t||{},null===n)return void console.warn("No IndexBuffer is bound, command ignored.");var e=this.gl,i=e[t.mode||this.mode||"TRIANGLES"],r=void 0!==t.offset?t.offset:this.offset,o=void 0!==t.count?t.count:this.count;return e.drawElements(i,o,e[this.type],r),this},e.exports=i}()},{"./WebGLContext":12}],3:[function(t,e,i){!function(){"use strict";function i(t){if(u!==t){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),u=t}}function r(t){if(null!==u){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),u=null}}function n(){var t=this.gl=o.get();return this.framebuffer=t.createFramebuffer(),this.textures={},this}var o=t("./WebGLContext"),a=t("../util/Stack"),s=new a,u=null;n.prototype.push=function(){return s.push(this),i(this),this},n.prototype.pop=function(){var t;return s.pop(),t=s.top(),t?i(t):r(this),this},n.prototype.setColorTarget=function(t,e,i){var r=this.gl;return"string"==typeof e&&(i=e,e=void 0),e=void 0!==e?e:0,this.textures["color"+e]=t,this.push(),r.framebufferTexture2D(r.FRAMEBUFFER,r["COLOR_ATTACHMENT"+e],r[i||"TEXTURE_2D"],t.texture,0),this.pop(),this},n.prototype.setDepthTarget=function(t){var e=this.gl;return this.textures.depth=t,this.push(),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t.texture,0),this.pop(),this},n.prototype.clearColor=function(t,e,i,r){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,r=void 0!==r?r:0,this.push(),n.clearColor(t,e,i,r),n.clear(n.COLOR_BUFFER_BIT),this.pop(),this},n.prototype.clearDepth=function(t,e,i,r){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,r=void 0!==r?r:0,this.push(),n.clearColor(t,e,i,r),n.clear(n.DEPTH_BUFFER_BIT),this.pop(),this},n.prototype.clearStencil=function(t,e,i,r){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,r=void 0!==r?r:0,this.push(),n.clearColor(t,e,i,r),n.clear(n.STENCIL_BUFFER_BIT),this.pop(),this},n.prototype.clear=function(t,e,i,r){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,i=void 0!==i?i:0,r=void 0!==r?r:0,this.push(),n.clearColor(t,e,i,r),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this.pop(),this},n.prototype.resize=function(t,e){var i;if(!t||!e)return console.warn("Width or height arguments missing, command ignored."),this;for(i in this.textures)this.textures.hasOwnProperty(i)&&this.textures[i].resize(t,e);return this},e.exports=n}()},{"../util/Stack":14,"./WebGLContext":12}],4:[function(t,e,i){!function(){"use strict";function i(t,e){if(t=t||{},e=e||{},t.vertexBuffer||t.vertexBuffers)this.vertexBuffers=t.vertexBuffers||[t.vertexBuffer];else{var i=new r(t.vertices);this.vertexBuffers=[new n(i)]}return t.indexBuffer?this.indexBuffer=t.indexBuffer:t.indices&&(this.indexBuffer=new o(t.indices)),this.options={mode:e.mode,offset:e.offset,count:e.count},this}var r=t("../core/VertexPackage"),n=t("../core/VertexBuffer"),o=t("../core/IndexBuffer");i.prototype.draw=function(t){var e=t||{};return e.mode=e.mode||this.options.mode,e.offset=void 0!==e.offset?e.offset:this.options.offset,e.count=void 0!==e.count?e.count:this.options.count,this.indexBuffer?(this.vertexBuffers.forEach(function(t){t.bind()}),this.indexBuffer.bind(),this.indexBuffer.draw(e)):this.vertexBuffers.forEach(function(t){t.bind(),t.draw(e)}),this},e.exports=i}()},{"../core/IndexBuffer":2,"../core/VertexBuffer":9,"../core/VertexPackage":10}],5:[function(t,e,i){!function(){"use strict";function i(t,e){var i,r,n=p.parseDeclarations([t,e],["uniform","attribute"]),o={},a={},s=0;for(r=0;r<n.length;r++)i=n[r],"attribute"===i.qualifier?o[i.name]={type:i.type,index:s++}:"uniform"===i.qualifier&&(a[i.name]={type:i.type,func:_[i.type+(i.count>1?"[]":"")]});return{attributes:o,uniforms:a}}function r(t,e,i){var r=t.createShader(t[i]);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(r)),null)}function n(t){var e,i=t.gl,r=t.attributes;for(e in r)r.hasOwnProperty(e)&&i.bindAttribLocation(t.program,r[e].index,e)}function o(t){var e,i,r=t.gl,n=t.uniforms;for(i in n)n.hasOwnProperty(i)&&(e=n[i],e.location=r.getUniformLocation(t.program,i))}function a(t){return function(e){g.load(t,{responseType:"text",success:e,error:function(t){console.error(t),e(null)}})}}function s(t){return function(e){e(t)}}function u(t){return function(e){var i=[];t=t||[],t=t instanceof Array?t:[t],t.forEach(function(t){p.isGLSL(t)?i.push(s(t)):i.push(a(t))}),m.async(i,function(t){e(t)})}}function f(t){x!==t&&(t.gl.useProgram(t.program),x=t)}function l(t){null!==x&&(t.gl.useProgram(null),x=null)}function h(t){return t.program=null,t.attributes=null,t.uniforms=null,t}function c(t,e){var i=this;t=t||{},this.program=0,this.gl=d.get(),this.version=t.version||"1.00",t.vert||console.error("Vertex shader argument has not been provided, shader initialization aborted."),t.frag||console.error("Fragment shader argument has not been provided, shader initialization aborted."),m.async({common:u(t.common),vert:u(t.vert),frag:u(t.frag)},function(t){i.create(t),e&&e(i)})}var d=t("./WebGLContext"),p=t("./ShaderParser"),m=t("../util/Util"),g=t("../util/XHRLoader"),v=t("../util/Stack"),_={bool:"uniform1i","bool[]":"uniform1iv","float":"uniform1f","float[]":"uniform1fv","int":"uniform1i","int[]":"uniform1iv",uint:"uniform1i","uint[]":"uniform1iv",vec2:"uniform2fv","vec2[]":"uniform2fv",ivec2:"uniform2iv","ivec2[]":"uniform2iv",vec3:"uniform3fv","vec3[]":"uniform3fv",ivec3:"uniform3iv","ivec3[]":"uniform3iv",vec4:"uniform4fv","vec4[]":"uniform4fv",ivec4:"uniform4iv","ivec4[]":"uniform4iv",mat2:"uniformMatrix2fv","mat2[]":"uniformMatrix2fv",mat3:"uniformMatrix3fv","mat3[]":"uniformMatrix3fv",mat4:"uniformMatrix4fv","mat4[]":"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"},y=new v,x=null;c.prototype.create=function(t){var e,a,s,u=this.gl,f=t.common.join(""),l=t.vert.join(""),c=t.frag.join("");return e=r(u,f+l,"VERTEX_SHADER"),a=r(u,f+c,"FRAGMENT_SHADER"),e&&a?(s=i(l,c),this.attributes=s.attributes,this.uniforms=s.uniforms,this.program=u.createProgram(),u.attachShader(this.program,e),u.attachShader(this.program,a),n(this),u.linkProgram(this.program),u.getProgramParameter(this.program,u.LINK_STATUS)?(o(this),this):(console.error("An error occured linking the shader: "+u.getProgramInfoLog(this.program)),console.error("Aborting instantiation of shader due to linking errors."),h(this))):(console.error("Aborting instantiation of shader due to compilation errors."),h(this))},c.prototype.push=function(){return y.push(this),f(this),this},c.prototype.pop=function(){var t;return y.pop(),t=y.top(),t?f(t):l(this),this},c.prototype.setUniform=function(t,e){if(!this.program)return void(this.hasLoggedError||(console.warn("Attempting to use an incomplete shader, command ignored."),this.hasLoggedError=!0));if(this!==x)return void console.warn("Attempting to set uniform `"+t+"` for an unbound shader, command ignored.");var i,r,n,o,a=this.uniforms[t];if(!a)return void console.warn("No uniform found under name `"+t+"`, command ignored.");if(void 0===e)return void console.warn("Argument passed for uniform `"+t+"` is undefined, command ignored.");switch(i=a.func,r=a.type,n=a.location,o=e.toArray?e.toArray():e,o=o instanceof Array?new Float32Array(o):o,o="boolean"==typeof o?o?1:0:o,r){case"mat2":case"mat3":case"mat4":this.gl[i](n,!1,o);break;default:this.gl[i](n,o)}return this},e.exports=c}()},{"../util/Stack":14,"../util/Util":15,"../util/XHRLoader":16,"./ShaderParser":6,"./WebGLContext":12}],6:[function(t,e,i){!function(){"use strict";function t(t){return t.replace(f,"")}function i(t){return t.replace(l," ").replace(h," ").replace(c,"$2$4$6")}function r(t,e,i,r){var n=r.match(d),o=n[1],a=void 0===n[2]?1:parseInt(n[2],10);return{qualifier:t,precision:e,type:i,name:o,count:a}}function n(t,e){var i,n=t.split(",").map(function(t){return t.trim()}),o=n.shift().split(" "),a=o.shift(),f=o.shift();s[f]?i=o.shift():(i=f,f=e[u[i]]);var l=o.concat(n),h=[];return l.forEach(function(t){h.push(r(a,f,i,t))}),h}function o(e,r){var o=t(e),a=i(o),s=a.split(";"),u=r.join("|"),f=new RegExp(".*\\b("+u+")\\b.*"),l={},h=[];return s.forEach(function(t){var e=t.match(p);if(e)return void(l[e[3]]=e[2]);var i=t.match(f);i&&(h=h.concat(n(i[0],l)))}),h}function a(t){var e={};return t.filter(function(t){return e[t.name]?!1:(e[t.name]=!0,!0)})}var s={highp:!0,mediump:!0,lowp:!0},u={"float":"float",vec2:"float",vec3:"float",vec4:"float",ivec2:"int",ivec3:"int",ivec4:"int","int":"int",uint:"int",sampler2D:"sampler2D",samplerCube:"samplerCube"},f=/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,l=/(\r\n|\n|\r)/gm,h=/\s{2,}/g,c=/(\s*)(\[)(\s*)(\d+)(\s*)(\])(\s*)/g,d=/([a-zA-Z_][a-zA-Z0-9_]*)(?:\[(\d+)\])?/,p=/\b(precision)\s+(\w+)\s+(\w+)/,m=/void\s+main\s*\(\s*\)\s*/im;e.exports={parseDeclarations:function(t,e){if(!e||0===e.length||!t||0===t.length)return[];t=t instanceof Array?t:[t],e=e instanceof Array?e:[e];var i=[];return t.forEach(function(t){i=i.concat(o(t,e))}),a(i)},isGLSL:function(t){return m.test(t)}}}()},{}],7:[function(t,e,i){!function(){"use strict";function i(t){if(!s.isPowerOfTwo(t.width)||!s.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=s.nextHighestPowerOfTwo(t.width),e.height=s.nextHighestPowerOfTwo(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function r(t,e){if(l!==t){var i=t.gl;e=i["TEXTURE"+e]||i.TEXTURE0,i.activeTexture(e),i.bindTexture(i.TEXTURE_2D,t.texture),l=t}}function n(t){if(null!==l){var e=t.gl;e.bindTexture(e.TEXTURE_2D,null),l=null}}function o(t,e){var i=this;if(t=t||{},this.gl=a.get(),this.texture=this.gl.createTexture(),this.wrap=t.wrap||"REPEAT",this.filter=t.filter||"LINEAR",this.invertY=void 0!==t.invertY?t.invertY:!0,this.mipMap=void 0!==t.mipMap?t.mipMap:!0,this.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:!0,t.image)this.bufferData(t.image),this.setParameters(this);else if(t.url){var r=new Image;r.onload=function(){i.bufferData(r),i.setParameters(i),e(i)},r.src=t.url}else{if(this.mipMap=!1,"DEPTH_COMPONENT"===t.format){var n=a.checkExtension("WEBGL_depth_texture");if(!n)return void console.warn("Cannot create Texture2D of format gl.DEPTH_COMPONENT as WEBGL_depth_texture is unsupported by this browser, command ignored");this.format=t.format,t.type?"UNSIGNED_SHORT"===t.type||"UNSIGNED_INT"===t.type?this.type=t.type:(console.warn("Depth textures do not support type`"+t.type+"`, defaulting to `UNSIGNED_INT`."),this.type="UNSIGNED_INT"):this.type="UNSIGNED_INT"}else this.format=t.format||"RGBA",this.type=t.type||"UNSIGNED_BYTE";this.internalFormat=this.format,this.bufferData(t.data||null,t.width,t.height),this.setParameters(this)}}var a=t("./WebGLContext"),s=t("../util/Util"),u=t("../util/Stack"),f={},l=null;o.prototype.push=function(t){return f[t]=f[t]||new u,f[t].push(this),r(this,t),this},o.prototype.pop=function(t){var e;return f[t]||console.warn("No texture was bound to texture unit `"+t+"`, command ignored."),f[t].pop(),e=f[t].top(),e?r(e,t):n(this),this},o.prototype.bufferData=function(t,e,r){var n=this.gl;return this.push(),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,this.invertY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.preMultiplyAlpha),t instanceof HTMLImageElement?(this.width=t.width,this.height=t.height,t=i(t),this.image=t,n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)):(this.data=t,this.width=e||this.width,this.height=r||this.height,n.texImage2D(n.TEXTURE_2D,0,n[this.internalFormat],this.width,this.height,0,n[this.format],n[this.type],this.data)),this.mipMap&&n.generateMipmap(n.TEXTURE_2D),this.pop(),this},o.prototype.setParameters=function(t){var e=this.gl;if(this.push(),t.wrap&&(this.wrap=t.wrap,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrap.s||this.wrap]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrap.t||this.wrap])),t.filter){this.filter=t.filter;var i=this.filter.min||this.filter;this.mipMap&&(i+="_MIPMAP_LINEAR"),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.filter.mag||this.filter]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[i])}return this.pop(),this},o.prototype.resize=function(t,e){return this.image?void console.error("Cannot resize image based Texture2D"):t&&e?(this.bufferData(this.data,t,e),this):void console.warn("Width or height arguments missing, command ignored.")},e.exports=o}()},{"../util/Stack":14,"../util/Util":15,"./WebGLContext":12}],8:[function(t,e,i){!function(){"use strict";function i(t){if(!u.isPowerOfTwo(t.width)||!u.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=u.nextHighestPowerOfTwo(t.width),e.height=u.nextHighestPowerOfTwo(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function r(t,e){if(d!==t){var i=t.gl;e=i["TEXTURE"+e]||i.TEXTURE0,i.activeTexture(e),i.bindTexture(i.TEXTURE_CUBE_MAP,t.texture),d=t}}function n(t){if(null!==d){var e=t.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,null),d=null}}function o(t,e,i){return function(r){var n=new Image;n.onload=function(){t.bufferFaceData(i,n),r()},n.src=e}}function a(t,e){var i,r,n=this;if(this.gl=s.get(),this.texture=this.gl.createTexture(),this.wrap=t.wrap||"CLAMP_TO_EDGE",this.filter=t.filter||"LINEAR",this.invertY=void 0!==t.invertY?t.invertY:!1,t.images){for(i in t.images)t.images.hasOwnProperty(i)&&this.bufferFaceData(i,t.images[i]);this.setParameters(this)}else if(t.urls){r={};for(i in t.urls)t.urls.hasOwnProperty(i)&&(r[i]=o(this,t.urls[i],i));u.async(r,function(){n.setParameters(n),e(n)})}else this.format=t.format||"RGBA",this.internalFormat=this.format,this.type=t.type||"UNSIGNED_BYTE",this.mipMap=void 0!==t.mipMap?t.mipMap:!1,l.forEach(function(e){var i=(t.data?t.data[e]:t.data)||null;n.bufferFaceData(e,i,t.width,t.height)}),this.setParameters(this)}var s=t("./WebGLContext"),u=t("../util/Util"),f=t("../util/Stack"),l=["-x","+x","-y","+y","-z","+z"],h={"+z":"TEXTURE_CUBE_MAP_POSITIVE_Z","-z":"TEXTURE_CUBE_MAP_NEGATIVE_Z","+x":"TEXTURE_CUBE_MAP_POSITIVE_X","-x":"TEXTURE_CUBE_MAP_NEGATIVE_X","+y":"TEXTURE_CUBE_MAP_POSITIVE_Y","-y":"TEXTURE_CUBE_MAP_NEGATIVE_Y"},c={},d=null;a.prototype.push=function(t){return c[t]=c[t]||new f,c[t].push(this),r(this,t),this},a.prototype.pop=function(t){var e;return c[t]||console.log("No texture was bound to texture unit `"+t+"`, command ignored."),c[t].pop(),e=c[t].top(),e?r(e,t):n(this),this},a.prototype.bufferFaceData=function(t,e,r,n){var o=this.gl,a=o[h[t]];return a||console.log("Invalid face enumeration `"+t+"` provided, command ignored."),this.push(),e instanceof HTMLImageElement?(this.images=this.images||{},this.images[t]=i(e),this.filter="LINEAR",this.mipMap=!0,o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this.invertY),o.texImage2D(a,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this.images[t])):(this.data=this.data||{},this.data[t]=e,this.width=r||this.width,this.height=n||this.height,o.texImage2D(a,0,o[this.internalFormat],this.width,this.height,0,o[this.format],o[this.type],e)),this.bufferedFaces=this.bufferedFaces||{},this.bufferedFaces[t]=!0,this.mipMap&&this.bufferedFaces["-x"]&&this.bufferedFaces["+x"]&&this.bufferedFaces["-y"]&&this.bufferedFaces["+y"]&&this.bufferedFaces["-z"]&&this.bufferedFaces["+z"]&&o.generateMipmap(o.TEXTURE_CUBE_MAP),this.pop(),this},a.prototype.setParameters=function(t){var e=this.gl;if(this.push(),t.wrap&&(this.wrap=t.wrap,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e[this.wrap.s||this.wrap]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e[this.wrap.t||this.wrap])),t.filter){this.filter=t.filter;var i=this.filter.min||this.filter;this.minMap&&(i+="_MIPMAP_LINEAR"),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e[this.filter.mag||this.filter]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[i])}return this.pop(),this},e.exports=a}()},{"../util/Stack":14,"../util/Util":15,"./WebGLContext":12}],9:[function(t,e,i){!function(){"use strict";function i(t){var e=4,i=0,r=0;return Object.keys(t).forEach(function(n){var o=t[n],a=o.offset;a>i&&(i=a,r=a+o.size*e)}),r}function r(t){if(!t||0===Object.keys(t).length)return console.warning("VertexBuffer requires attribute pointers to be specified upon instantiation, this buffer will not draw correctly."),{};var e={};return Object.keys(t).forEach(function(i){var r=parseInt(i,10);if(isNaN(r))return void console.warn("Attribute index `"+i+"` does not represent an integer, discarding attribute pointer.");var n=t[i],o=n.size,a=n.type,s=n.offset;(!o||1>o||o>4)&&(console.warn("Attribute pointer `size` parameter is invalid, defaulting to 4."),o=4),a&&"FLOAT"===a||(console.warn("Attribute pointer `type` parameter is invalid, defaulting to `FLOAT`."),a="FLOAT"),e[r]={size:o,type:a,offset:void 0!==s?s:0}}),e}function n(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&(i+=t[e].size);return i}function o(t,e,n){n=n||{},this.buffer=0,this.gl=a.get(),t instanceof s?(this.pointers=t.attributePointers(),n=e||{}):this.pointers=r(e),t&&(t instanceof s?this.bufferData(t.buffer()):t instanceof WebGLBuffer?(this.buffer=t,this.count=void 0!==n.count?n.count:0):this.bufferData(t)),this.stride=i(this.pointers),this.offset=void 0!==n.offset?n.offset:0,this.mode=void 0!==n.mode?n.mode:"TRIANGLES"}var a=t("./WebGLContext"),s=t("./VertexPackage"),u=t("../util/Util"),f=null,l=null;o.prototype.bufferData=function(t){var e=this.gl;if(t instanceof Array)t=new Float32Array(t);else if(!u.isTypedArray(t)&&"number"!=typeof t)return void console.error("VertexBuffer requires an Array or ArrayBuffer, or a size argument, command ignored.");this.buffer||(this.buffer=e.createBuffer());var i=n(this.pointers);"number"==typeof t?this.count=t/i:this.count=t.length/i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)},o.prototype.bufferSubData=function(t,e){var i=this.gl;if(!this.buffer)return void console.error("VertexBuffer has not been initially buffered, command ignored.");if(t instanceof Array)t=new Float32Array(t);else if(!u.isTypedArray(t))return void console.error("VertexBuffer requires an Array or ArrayBuffer argument, command ignored.");e=void 0!==e?e:0,i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferSubData(i.ARRAY_BUFFER,e,t)},o.prototype.bind=function(){if(f!==this){var t,e,i=this.gl,r=this.pointers,n=l||{};f=this,l={},i.bindBuffer(i.ARRAY_BUFFER,this.buffer);for(e in r)r.hasOwnProperty(e)&&(t=this.pointers[e],i.vertexAttribPointer(e,t.size,i[t.type],!1,this.stride,t.offset),i.enableVertexAttribArray(e),l[e]=!0,delete n[e]);for(e in n)n.hasOwnProperty(e)&&i.disableVertexAttribArray(e)}},o.prototype.draw=function(t){if(t=t||{},null===f)return void console.warn("No VertexBuffer is bound, command ignored.");var e=this.gl,i=e[t.mode||this.mode||"TRIANGLES"],r=void 0!==t.offset?t.offset:this.offset,n=void 0!==t.count?t.count:this.count;e.drawArrays(i,r,n)},o.prototype.unbind=function(){if(null!==f){var t,e=this.gl,i=this.pointers;for(t in i)i.hasOwnProperty(t)&&e.disableVertexAttribArray(t);e.bindBuffer(e.ARRAY_BUFFER,null),f=null,l={}}},e.exports=o}()},{"../util/Util":15,"./VertexPackage":10,"./WebGLContext":12}],10:[function(t,e,i){!function(){"use strict";function t(t){var e=[];return Object.keys(t).forEach(function(i){var r=parseInt(i,10);if(isNaN(r))return void console.warn("Attribute index `"+i+"` does not represent an integer, discarding attribute pointer.");var n=t[i];n&&n instanceof Array&&n.length>0?e.push({index:r,data:n}):console.warn("Error parsing attribute of index `"+i+"`, attribute discarded.")}),e.sort(function(t,e){return t.index-e.index}),e}function i(t){return void 0!==t.x?void 0!==t.y?void 0!==t.z?void 0!==t.w?4:3:2:1:t instanceof Array?t.length:1}function r(t,e){var r=Number.MAX_VALUE,n=0;t.pointers={},e.forEach(function(e){var s=i(e.data[0]);r=Math.min(r,e.data.length),t.pointers[e.index]={type:o,size:s,offset:n*a},n+=s}),t.stride=n*a,t.length=r}function n(t){return void 0!==t?this.set(t):(this.data=new Float32Array(0),void(this.pointers={}))}var o="FLOAT",a=4;n.prototype.set=function(e){var i=this,n=t(e);return r(this,n),this.data=new Float32Array(this.length*(this.stride/a)),n.forEach(function(t){var e,r,n,o=i.pointers[t.index],s=o.offset/a,u=i.stride/a;for(r=0;r<i.length;r++)switch(e=t.data[r],n=s+u*r,o.size){case 2:i.data[n]=void 0!==e.x?e.x:e[0],i.data[n+1]=void 0!==e.y?e.y:e[1];break;case 3:i.data[n]=void 0!==e.x?e.x:e[0],i.data[n+1]=void 0!==e.y?e.y:e[1],i.data[n+2]=void 0!==e.z?e.z:e[2];break;case 4:i.data[n]=void 0!==e.x?e.x:e[0],i.data[n+1]=void 0!==e.y?e.y:e[1],i.data[n+2]=void 0!==e.z?e.z:e[2],i.data[n+3]=void 0!==e.w?e.w:e[3];break;default:void 0!==e.x?i.data[n]=e.x:void 0!==e[0]?i.data[n]=e[0]:i.data[n]=e}}),this},n.prototype.buffer=function(){return this.data},n.prototype.attributePointers=function(){return this.pointers},e.exports=n}()},{}],11:[function(t,e,i){!function(){"use strict";function i(t,e,i,r,n){var o=t.gl;e=void 0!==e?e:t.x,i=void 0!==i?i:t.y,r=void 0!==r?r:t.width,n=void 0!==n?n:t.height,o.viewport(e,i,r,n)}function r(t){t=t||{},this.gl=n.get(),this.resize(t.width||this.gl.canvas.width,t.height||this.gl.canvas.height),this.offset(void 0!==t.x?t.x:0,void 0!==t.y?t.y:0)}var n=t("./WebGLContext"),o=t("../util/Stack"),a=new o;r.prototype.resize=function(t,e){return void 0!==t&&void 0!==e&&(this.width=t,this.height=e,this.gl.canvas.width=t+this.x,this.gl.canvas.height=e+this.y),this},r.prototype.offset=function(t,e){return void 0!==t&&void 0!==e&&(this.x=t,this.y=e,this.gl.canvas.width=this.width+t,this.gl.canvas.height=this.height+e),this},r.prototype.push=function(t,e,r,n){return a.push({viewport:this,x:t,y:e,width:r,height:n}),i(this,t,e,r,n),this},r.prototype.pop=function(){var t;return a.pop(),t=a.top(),t?i(t.viewport,t.x,t.y,t.width,t.height):i(this),this},e.exports=r}()},{"../util/Stack":14,"./WebGLContext":12}],12:[function(t,e,i){!function(){"use strict";function t(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?t:"string"==typeof t?document.getElementById(t):null}function i(e){if(e){var i=t(e);if(i)return a[i.id]}else if(o)return o;return null}function r(t){var e,i,r=t.gl;for(i=0;i<s.length;i++)e=s[i],t.extensions[e]=r.getExtension(e)}function n(t,e){var i,n;try{n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),i={id:t.id,gl:n,extensions:{}},r(i),a[t.id]=i,o=i}catch(s){console.error(s.message)}return n||console.error("Unable to initialize WebGL. Your browser may not support it."),i}var o=null,a={},s=["OES_texture_float","OES_texture_half_float","WEBGL_lose_context","OES_standard_derivatives","OES_vertex_array_object","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_frag_depth","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_blend_minmax","EXT_shader_texture_lod"];e.exports={bind:function(t){var e=i(t);return e?(o=e,this):(console.error("No context exists for provided argument `"+t+"`, command ignored."),this)},get:function(e,r){var o=i(e);if(o)return o.gl;var s=t(e);return s&&n(s,r)?a[s.id].gl:(console.error("Context could not be found or created for argument of type`"+typeof e+"`, returning `null`."),null)},supportedExtensions:function(t){var e=i(t);if(e){var r=e.extensions,n=[];for(var o in r)r.hasOwnProperty(o)&&r[o]&&n.push(o);return n}return console.error("No context is currently bound or was provided, returning an empty array."),[]},unsupportedExtensions:function(t){var e=i(t);if(e){var r=e.extensions,n=[];for(var o in r)r.hasOwnProperty(o)&&!r[o]&&n.push(o);return n}return console.error("No context is currently bound or was provided, returning an empty array."),[]},checkExtension:function(t,e){e||(e=t,t=null);var r=i(t);if(r){var n=r.extensions;return n[e]?n[e]:!1}return console.error("No context is currently bound or provided as argument, returning false."),!1}}}()},{}],13:[function(t,e,i){!function(){"use strict";e.exports={IndexBuffer:t("./core/IndexBuffer"),Renderable:t("./core/Renderable"),RenderTarget:t("./core/RenderTarget"),Shader:t("./core/Shader"),Texture2D:t("./core/Texture2D"),TextureCubeMap:t("./core/TextureCubeMap"),VertexBuffer:t("./core/VertexBuffer"),VertexPackage:t("./core/VertexPackage"),Viewport:t("./core/Viewport"),WebGLContext:t("./core/WebGLContext")}}()},{"./core/IndexBuffer":2,"./core/RenderTarget":3,"./core/Renderable":4,"./core/Shader":5,"./core/Texture2D":7,"./core/TextureCubeMap":8,"./core/VertexBuffer":9,"./core/VertexPackage":10,"./core/Viewport":11,"./core/WebGLContext":12}],14:[function(t,e,i){!function(){"use strict";function t(){this.data=[]}t.prototype.push=function(t){return this.data.push(t),this},t.prototype.pop=function(){return this.data.pop(),this},t.prototype.top=function(){var t=this.data.length-1;return 0>t?null:this.data[t]},e.exports=t}()},{}],15:[function(t,e,i){!function(){"use strict";function i(t){return function(e){t.resolve(e)}}function r(t,e){var r,n,o=[];for(n=0;n<t.length;n++)r=new a,o.push(r),t[n](i(r));s.apply(s,o).then(function(){var t=Array.prototype.slice.call(arguments,0);e(t)})}function n(t,e){var r,n,o=[],u=[];for(n in t)t.hasOwnProperty(n)&&(r=new a,u.push(r),o.push(n),t[n](i(r)));s.apply(s,u).done(function(){var t,i=Array.prototype.slice.call(arguments,0),r={};for(t=0;t<o.length;t++)r[o[t]]=i[t];e(r)})}var o=t("simply-deferred"),a=o.Deferred,s=o.when;e.exports={async:function(t,e){t instanceof Array?r(t,e):n(t,e)},isTypedArray:function(t){return t&&t.buffer instanceof ArrayBuffer&&void 0!==t.byteLength},isPowerOfTwo:function(t){return 0!==t?0===(t&t-1):!1},nextHighestPowerOfTwo:function(t){var e;for(0!==t&&(t-=1),e=1;32>e;e<<=1)t|=t>>e;return t+1}}}()},{"simply-deferred":1}],16:[function(t,e,i){!function(){"use strict";e.exports={load:function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType=e.responseType,i.addEventListener("load",function(){e.success&&e.success(this.response)}),e.progress&&i.addEventListener("progress",function(t){e.progress(t)}),e.error&&i.addEventListener("error",function(t){e.error(t)}),i.send()}}}()},{}],17:[function(t,e,i){var r="undefined"!=typeof JSON?JSON:t("jsonify");e.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var i=e.space||"";"number"==typeof i&&(i=Array(i+1).join(" "));var a="boolean"==typeof e.cycles?e.cycles:!1,s=e.replacer||function(t,e){return e},u=e.cmp&&function(t){
return function(e){return function(i,r){var n={key:i,value:e[i]},o={key:r,value:e[r]};return t(n,o)}}}(e.cmp),f=[];return function l(t,e,h,c){var d=i?"\n"+new Array(c+1).join(i):"",p=i?": ":":";if(h&&h.toJSON&&"function"==typeof h.toJSON&&(h=h.toJSON()),h=s.call(t,e,h),void 0!==h){if("object"!=typeof h||null===h)return r.stringify(h);if(n(h)){for(var m=[],g=0;g<h.length;g++){var v=l(h,g,h[g],c+1)||r.stringify(null);m.push(d+i+v)}return"["+m.join(",")+d+"]"}if(-1!==f.indexOf(h)){if(a)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}f.push(h);for(var _=o(h).sort(u&&u(h)),m=[],g=0;g<_.length;g++){var e=_[g],y=l(h,e,h[e],c+1);if(y){var x=r.stringify(e)+p+y;m.push(d+i+x)}}return f.splice(f.indexOf(h),1),"{"+m.join(",")+d+"}"}}({"":t},"",t,0)};var n=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},o=Object.keys||function(t){var e=Object.prototype.hasOwnProperty||function(){return!0},i=[];for(var r in t)e.call(t,r)&&i.push(r);return i}},{jsonify:18}],18:[function(t,e,i){i.parse=t("./lib/parse"),i.stringify=t("./lib/stringify")},{"./lib/parse":19,"./lib/stringify":20}],19:[function(t,e,i){var r,n,o,a,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},u=function(t){throw{name:"SyntaxError",message:t,at:r,text:o}},f=function(t){return t&&t!==n&&u("Expected '"+t+"' instead of '"+n+"'"),n=o.charAt(r),r+=1,n},l=function(){var t,e="";for("-"===n&&(e="-",f("-"));n>="0"&&"9">=n;)e+=n,f();if("."===n)for(e+=".";f()&&n>="0"&&"9">=n;)e+=n;if("e"===n||"E"===n)for(e+=n,f(),"-"!==n&&"+"!==n||(e+=n,f());n>="0"&&"9">=n;)e+=n,f();return t=+e,isFinite(t)?t:void u("Bad number")},h=function(){var t,e,i,r="";if('"'===n)for(;f();){if('"'===n)return f(),r;if("\\"===n)if(f(),"u"===n){for(i=0,e=0;4>e&&(t=parseInt(f(),16),isFinite(t));e+=1)i=16*i+t;r+=String.fromCharCode(i)}else{if("string"!=typeof s[n])break;r+=s[n]}else r+=n}u("Bad string")},c=function(){for(;n&&" ">=n;)f()},d=function(){switch(n){case"t":return f("t"),f("r"),f("u"),f("e"),!0;case"f":return f("f"),f("a"),f("l"),f("s"),f("e"),!1;case"n":return f("n"),f("u"),f("l"),f("l"),null}u("Unexpected '"+n+"'")},p=function(){var t=[];if("["===n){if(f("["),c(),"]"===n)return f("]"),t;for(;n;){if(t.push(a()),c(),"]"===n)return f("]"),t;f(","),c()}}u("Bad array")},m=function(){var t,e={};if("{"===n){if(f("{"),c(),"}"===n)return f("}"),e;for(;n;){if(t=h(),c(),f(":"),Object.hasOwnProperty.call(e,t)&&u('Duplicate key "'+t+'"'),e[t]=a(),c(),"}"===n)return f("}"),e;f(","),c()}}u("Bad object")};a=function(){switch(c(),n){case"{":return m();case"[":return p();case'"':return h();case"-":return l();default:return n>="0"&&"9">=n?l():d()}},e.exports=function(t,e){var i;return o=t,r=0,n=" ",i=a(),c(),n&&u("Syntax error"),"function"==typeof e?function s(t,i){var r,n,o=t[i];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n=s(o,r),void 0!==n?o[r]=n:delete o[r]);return e.call(t,i,o)}({"":i},""):i}},{}],20:[function(t,e,i){function r(t){return u.lastIndex=0,u.test(t)?'"'+t.replace(u,function(t){var e=f[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function n(t,e){var i,u,f,l,h,c=o,d=e[t];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(t)),"function"==typeof s&&(d=s.call(e,t,d)),typeof d){case"string":return r(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(o+=a,h=[],"[object Array]"===Object.prototype.toString.apply(d)){for(l=d.length,i=0;l>i;i+=1)h[i]=n(i,d)||"null";return f=0===h.length?"[]":o?"[\n"+o+h.join(",\n"+o)+"\n"+c+"]":"["+h.join(",")+"]",o=c,f}if(s&&"object"==typeof s)for(l=s.length,i=0;l>i;i+=1)u=s[i],"string"==typeof u&&(f=n(u,d),f&&h.push(r(u)+(o?": ":":")+f));else for(u in d)Object.prototype.hasOwnProperty.call(d,u)&&(f=n(u,d),f&&h.push(r(u)+(o?": ":":")+f));return f=0===h.length?"{}":o?"{\n"+o+h.join(",\n"+o)+"\n"+c+"}":"{"+h.join(",")+"}",o=c,f}}var o,a,s,u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};e.exports=function(t,e,i){var r;if(o="",a="","number"==typeof i)for(r=0;i>r;r+=1)a+=" ";else"string"==typeof i&&(a=i);if(s=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return n("",{"":t})}},{}],21:[function(t,e,i){!function(){"use strict";e.exports={TileLayer:t("./layer/exports"),Renderer:t("./renderer/exports"),TileRequestor:t("./request/TileRequestor"),MetaRequestor:t("./request/MetaRequestor")}}()},{"./layer/exports":26,"./renderer/exports":49,"./request/MetaRequestor":61,"./request/TileRequestor":63}],22:[function(t,e,i){!function(){"use strict";var i=t("./Image"),r=i.extend({options:{unloadInvisibleTiles:!0,zIndex:5e3},initialize:function(t){t.rendererClass?$.extend(!0,this,t.rendererClass):console.warn("No `rendererClass` option found, this layer will not render any data."),L.setOptions(this,t)},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_redrawTile:function(t){var e={x:t._tilePoint.x,y:t._tilePoint.y,z:this._map._zoom};this.renderTile(t,e),this.tileDrawn(t)},_createTile:function(){var t=L.DomUtil.create("div","leaflet-tile leaflet-debug-tile");return t.width=this.options.tileSize,t.height=this.options.tileSize,t.onselectstart=L.Util.falseFn,t.onmousemove=L.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._adjustTilePoint(e),this._redrawTile(t)},renderTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}});e.exports=r}()},{"./Image":23}],23:[function(t,e,i){!function(){"use strict";var t=L.TileLayer.extend({getOpacity:function(){return this.options.opacity},show:function(){this._hidden=!1,this._prevMap.addLayer(this)},hide:function(){this._hidden=!0,this._prevMap=this._map,this._map.removeLayer(this)},isHidden:function(){return this._hidden},setBrightness:function(t){this._brightness=t,$(this._container).css("-webkit-filter","brightness("+100*this._brightness+"%)"),$(this._container).css("filter","brightness("+100*this._brightness+"%)")},getBrightness:function(){return void 0!==this._brightness?this._brightness:1}});e.exports=t}()},{}],24:[function(t,e,i){!function(){"use strict";var t=Number.MAX_VALUE,i=0,r=L.Class.extend({initialize:function(t,e){e.rendererClass?e.rendererClass.prototype?($.extend(!0,this,e.rendererClass.prototype),e.rendererClass.prototype.initialize.apply(this,arguments)):($.extend(!0,this,e.rendererClass),e.rendererClass.initialize.apply(this,arguments)):console.warn("No `rendererClass` option found, this layer will not render any data."),L.setOptions(this,e),this._meta=t,this._params={binning:{}},this.clearExtrema()},clearExtrema:function(){this._extrema={min:t,max:i},this._cache={}},getExtrema:function(){return this._extrema},updateExtrema:function(t){var e=this.extractExtrema(t),i=!1;return e.min<this._extrema.min&&(i=!0,this._extrema.min=e.min),e.max>this._extrema.max&&(i=!0,this._extrema.max=e.max),i},extractExtrema:function(t){return{min:_.min(t),max:_.max(t)}},setMeta:function(t){return this._meta=t,this},getMeta:function(){return this._meta},setParams:function(t){this._params=t},getParams:function(){return this._params}});e.exports=r}()},{}],25:[function(t,e,i){!function(){"use strict";var i=t("./Image"),r=i.extend({options:{unloadInvisibleTiles:!0,zIndex:5e3},initialize:function(t){this._pendingTiles={},t.rendererClass?$.extend(!0,this,t.rendererClass):console.warn("No `rendererClass` option found, this layer will not render any data."),L.setOptions(this,t)},increment:function(t){var e=this._getTileHash(t);if(void 0===this._pendingTiles[e]){this._pendingTiles[e]=1;var i=this._getTilesWithHash(e);i.forEach(function(t){this._redrawTile(t)},this)}else this._pendingTiles[e]++},decrement:function(t){var e=this._getTileHash(t);if(this._pendingTiles[e]--,0===this._pendingTiles[e]){delete this._pendingTiles[e];var i=this._getTilesWithHash(e);i.forEach(function(t){this._redrawTile(t)},this)}},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_getTileClass:function(t){return"pending-"+t},_getTileHash:function(t){return t.z+"-"+t.x+"-"+t.y},_getTilesWithHash:function(t){var e=this._getTileClass(t),i=[];return $(this._container).find("."+e).each(function(){i.push(this)}),i},_redrawTile:function(t){var e={x:t._tilePoint.x,y:t._tilePoint.y,z:this._map._zoom},i=this._getTileHash(e);$(t).addClass(this._getTileClass(i)),this._pendingTiles[i]>0?this.renderTile(t,e):t.innerHTML="",this.tileDrawn(t)},_createTile:function(){var t=L.DomUtil.create("div","leaflet-tile leaflet-pending-tile");return t.width=this.options.tileSize,t.height=this.options.tileSize,t.onselectstart=L.Util.falseFn,t.onmousemove=L.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._adjustTilePoint(e),this._redrawTile(t)},renderTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}});e.exports=r}()},{"./Image":23}],26:[function(t,e,i){!function(){"use strict";var i=t("./core/Debug"),r=t("./core/Pending"),n=t("./core/Image"),o=t("./types/Heatmap"),a=t("./types/TopCount"),s=t("./types/TopFrequency"),u=t("./types/TopicCount"),f=t("./types/TopicFrequency");e.exports={Debug:i,Pending:r,Image:n,Heatmap:o,TopCount:a,TopFrequency:s,TopicCount:u,TopicFrequency:f}}()},{"./core/Debug":22,"./core/Image":23,"./core/Pending":25,"./types/Heatmap":40,"./types/TopCount":41,"./types/TopFrequency":42,"./types/TopicCount":43,"./types/TopicFrequency":44}],27:[function(t,e,i){!function(){"use strict";function t(t){var e=t[0]>.04045?Math.pow((t[0]+.055)/1.055,2.4):t[0]/12.92,i=t[1]>.04045?Math.pow((t[1]+.055)/1.055,2.4):t[1]/12.92,r=t[2]>.04045?Math.pow((t[2]+.055)/1.055,2.4):t[2]/12.92,n=.4124564*e+.3575761*i+.1804375*r,o=.2126729*e+.7151522*i+.072175*r,a=.0193339*e+.119192*i+.9503041*r;return n/=.95047,o/=1,a/=1.08883,n=n>.008856?Math.pow(n,1/3):7.787037*n+16/116,o=o>.008856?Math.pow(o,1/3):7.787037*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787037*a+16/116,[116*o-16,500*(n-o),200*(o-a),t[3]]}function i(t){var e=(t[0]+16)/116,i=e+t[1]/500,r=e-t[2]/200;i=i>.206893034?i*i*i:(i-4/29)/7.787037,e=e>.206893034?e*e*e:(e-4/29)/7.787037,r=r>.206893034?r*r*r:(r-4/29)/7.787037,i=.95047*i,e=1*e,r=1.08883*r;var n=3.2404542*i+-1.5371385*e+r*-.4985314,o=i*-.969266+1.8760108*e+.041556*r,a=.0556434*i+e*-.2040259+1.0572252*r;return n=n>.00304?1.055*Math.pow(n,1/2.4)-.055:12.92*n,o=o>.00304?1.055*Math.pow(o,1/2.4)-.055:12.92*o,a=a>.00304?1.055*Math.pow(a,1/2.4)-.055:12.92*a,[Math.max(Math.min(n,1),0),Math.max(Math.min(o,1),0),Math.max(Math.min(a,1),0),t[3]]}function r(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])+(t[3]-e[3])*(t[3]-e[3]))}var n=200,o=function(e){var o=[],a=_.map(e,function(e){return t([e[0]/255,e[1]/255,e[2]/255,e[3]/255])}),s=_.map(a,function(t,e,i){return e>0?r(t,i[e-1]):0}),u=_.reduce(s,function(t,e){return t+e},0);s=_.map(s,function(t){return t/u});for(var f,l,h,c=0,d=0,p=0;n>p;p++)f=p/(n-1),f>c+s[d+1]&&d+1<a.length-1&&(d+=1,c+=s[d]),l=(f-c)/s[d+1],h=i([a[d][0]+(a[d+1][0]-a[d][0])*l,a[d][1]+(a[d+1][1]-a[d][1])*l,a[d][2]+(a[d+1][2]-a[d][2])*l,a[d][3]+(a[d+1][3]-a[d][3])*l]),o.push([Math.round(255*h[0]),Math.round(255*h[1]),Math.round(255*h[2]),Math.round(255*h[3])]);return o},a=o([[4,32,64,80],[8,64,129,127],[8,104,172,255],[43,140,190,255],[78,179,211,255],[123,204,196,255],[168,221,181,255],[204,235,197,255],[224,243,219,255],[247,252,240,255]]),s=o([[64,0,19,80],[128,0,38,127],[189,0,38,255],[227,26,28,255],[252,78,42,255],[253,141,60,255],[254,178,76,255],[254,217,118,255],[255,237,160,255]]),u=o([[0,64,38,80],[0,90,50,127],[35,132,67,255],[65,171,93,255],[120,198,121,255],[173,221,142,255],[217,240,163,255],[247,252,185,255],[255,255,229,255]]),f=o([[38,26,64,80],[68,47,114,127],[225,43,2,255],[2,220,1,255],[255,210,2,255],[255,255,255,255]]),l=o([[0,22,64,80],[0,57,102,127],[49,61,102,255],[225,43,2,255],[255,210,2,255],[255,255,255,255]]),h=o([[0,0,0,127],[64,64,64,255],[255,255,255,255]]),c=o([[255,68,0,255],[189,189,189,176]]),d=o([[189,189,189,176],[50,165,249,255]]),p=function(t){return function(e,i){var r=t[Math.floor(e*(t.length-1))];return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i}},m={cool:p(a),hot:p(s),verdant:p(u),spectral:p(f),temperature:p(l),grey:p(h),polar:p(c.concat(d))},g=function(t){var e=m[t.toLowerCase()];return e&&(this._colorRamp=e),this},v=function(){return this._colorRamp},y=function(){this._colorRamp=m.verdant};e.exports={initialize:y,setColorRamp:g,getColorRamp:v}}()},{}],28:[function(t,e,i){!function(){"use strict";function t(t,e,i){var r=Math.log10(e||1),n=Math.log10(i||1),o=Math.log10(t||1);return(o-r)/(n-r||1)}function i(t,e,i){var r=Math.log10(e||1),n=Math.log10(i||1);return Math.pow(10,t*n-t*r+r)}function r(t,e,i){var r=Math.abs(e),n=Math.abs(i),o=Math.max(r,n),a=t/(s*o);return 1/(1+Math.exp(-a))}function n(t,e,i){var r=Math.abs(e),n=Math.abs(i),o=Math.max(r,n);return 0===t?-o:1===t?o:Math.log(1/t-1)*-(s*o)}function o(t,e,i){var r=i-e;return(t-e)/r}function a(t,e,i){var r=i-e;return e+t*r}var s=.15,u={linear:o,log10:t,sigmoid:r},f={linear:a,log10:i,sigmoid:n},l=function(){this._range={min:0,max:1},this._transformFunc=t,this._inverseFunc=i},h=function(t){var e=t.toLowerCase();this._transformFunc=u[e],this._inverseFunc=f[e]},c=function(t){this._range.min=t.min,this._range.max=t.max},d=function(){return this._range},p=function(t){var e=this._range.min,i=this._range.max,r=(t-e)/(i-e);return Math.max(0,Math.min(1,r))},m=function(t){var e=this._extrema.min,i=this._extrema.max,r=Math.max(Math.min(t,i),e);return this._transformFunc(r,e,i)},g=function(t){var e=this._extrema.min,i=this._extrema.max,r=Math.max(Math.min(t,1),0);return this._inverseFunc(r,e,i)};e.exports={initialize:l,setTransformFunc:h,setValueRange:c,getValueRange:d,transformValue:m,untransformValue:g,interpolateToRange:p}}()},{}],29:[function(t,e,i){!function(){"use strict";var i=t("./Tiling"),r=function(t){return t!==this._params.binning.resolution&&(this._params.binning.resolution=t,this.clearExtrema()),this},n=function(){return this._params.binning.resolution};e.exports={setXField:i.setXField,getXField:i.getXField,setYField:i.setYField,getYField:i.getYField,setResolution:r,getResolution:n}}()},{"./Tiling":38}],30:[function(t,e,i){!function(){"use strict";var t=function(t,e,i,r){return t?void 0===e?void console.warn("DateHistogram `from` are missing from argument. Ignoring command."):void 0===i?void console.warn("DateHistogram `to` are missing from argument. Ignoring command."):(this._params.date_histogram={field:t,from:e,to:i,interval:r},this.clearExtrema(),this):void console.warn("DateHistogram `field` is missing from argument. Ignoring command.")},i=function(){return this._params.date_histogram};e.exports={setDateHistogram:t,getDateHistogram:i}}()},{}],31:[function(t,e,i){!function(){"use strict";var t=function(t,e){return t?e?(this._params.histogram={field:t,interval:e},this.clearExtrema(),this):void console.warn("Histogram `interval` are missing from argument. Ignoring command."):void console.warn("Histogram `field` is missing from argument. Ignoring command.")},i=function(){return this._params.histogram};e.exports={setHistogram:t,getHistogram:i}}()},{}],32:[function(t,e,i){!function(){"use strict";var t={min:!0,max:!0,sum:!0,avg:!0},i=function(t,e){if(t){if(t.extrema)return!0;console.warn("Field `"+e+"` is not ordinal in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},r=function(e,r){if(!e)return void console.warn("MetricAgg `field` is missing from argument. Ignoring command.");if(!r)return void console.warn("MetricAgg `type` is missing from argument. Ignoring command.");var n=this._meta[e];if(i(n,e)){if(!t[r])return void console.warn("MetricAgg type `"+r+"` is not supported. Ignoring command.");this._params.metric_agg={field:e,type:r},this.clearExtrema()}return this},n=function(){return this._params.metric_agg};e.exports={setMetricAgg:r,getMetricAgg:n}}()},{}],33:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(t){if("string"===t.type)return!0;console.warn("Field `"+e+"` is not of type `string` in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},i=function(t){return t.sort(function(t,e){return e>t?-1:t>e?1:0}),t},r=function(e,r){if(!e)return void console.warn("PrefixFilter `field` is missing from argument. Ignoring command.");if(void 0===r)return void console.warn("PrefixFilter `prefixes` are missing from argument. Ignoring command.");var n=this._meta[e];if(t(n,e)){var o=_.find(this._params.prefix_filter,function(t){return t.field===e});if(o)return void console.warn("Range with `field` of `"+e+"` already exists, used `updateRange` instead.");this._params.prefix_filter=this._params.prefix_filter||[],this._params.prefix_filter.push({field:e,prefixes:i(r)}),this.clearExtrema()}return this},n=function(t,e){var r=_.find(this._params.prefix_filter,function(e){return e.field===t});return r?(void 0!==e&&(r.prefixes=i(e),this.clearExtrema()),this):void console.warn("Range with `field` of `"+t+"` does not exist. Ignoring command.")},o=function(t){var e=_.find(this._params.prefix_filter,function(e){return e.field===t});return e?(this._params.prefix_filter=_.filter(this._params.prefix_filter,function(e){return e.field!==t}),this.clearExtrema(),this):void console.warn("Range with `field` of `"+t+"` does not exist. Ignoring command.")},a=function(){return this._params.prefix_filter};e.exports={addPrefixFilter:r,updatePrefixFilter:n,removePrefixFilter:o,getPrefixFilter:a}}()},{}],34:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(t){if("string"===t.type)return!0;console.warn("Field `"+e+"` is not `string` in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},i=function(e,i){if(!e)return void console.warn("QueryString `field` is missing from argument. Ignoring command.");if(!i)return void console.warn("QueryString `string` is missing from argument. Ignoring command.");var r=this._meta[e];if(t(r,e)){var n=_.find(this._params.query_string,function(t){return t.field===e});if(n)return void console.warn("QueryString with `field` of `"+e+"` already exists, used `updateQueryString` instead.");this._params.query_string=this._params.query_string||[],this._params.query_string.push({field:e,string:i}),this.clearExtrema()}return this},r=function(t,e){var i=_.find(this._params.query_string,function(e){return e.field===t});if(!i)return void console.warn("QueryString with `field` of `"+t+"` does not exist. Ignoring command.");var r=!1;return void 0!==e&&(r=!0,i.string=e),r&&this.clearExtrema(),this},n=function(t){var e=_.find(this._params.query_string,function(e){return e.field===t});return e?(this._params.query_string=_.filter(this._params.query_string,function(e){return e.field!==t}),this.clearExtrema(),this):void console.warn("QueryString with `field` of `"+t+"` does not exist. Ignoring command.")},o=function(){return this._params.query_string};e.exports={addQueryString:i,updateQueryString:r,removeQueryString:n,getQueryString:o}}()},{}],35:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(t){if(t.extrema)return!0;console.warn("Field `"+e+"` is not ordinal in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},i=function(e,i,r){if(!e)return void console.warn("Range `field` is missing from argument. Ignoring command.");if(void 0===i)return void console.warn("Range `from` is missing from argument. Ignoring command.");if(void 0===r)return void console.warn("Range `to` is missing from argument. Ignoring command.");var n=this._meta[e];if(t(n,e)){var o=_.find(this._params.range,function(t){return t.field===e});if(o)return void console.warn("Range with `field` of `"+e+"` already exists, used `updateRange` instead.");this._params.range=this._params.range||[],this._params.range.push({field:e,from:i,to:r}),this.clearExtrema()}return this},r=function(t,e,i){var r=_.find(this._params.range,function(e){return e.field===t});if(!r)return void console.warn("Range with `field` of `"+t+"` does not exist. Ignoring command.");var n=!1;return void 0!==e&&(n=!0,r.from=e),void 0!==i&&(n=!0,r.to=i),n&&this.clearExtrema(),this},n=function(t){var e=_.find(this._params.range,function(e){return e.field===t});return e?(this._params.range=_.filter(this._params.range,function(e){return e.field!==t}),this.clearExtrema(),this):void console.warn("Range with `field` of `"+t+"` does not exist. Ignoring command.")},o=function(){return this._params.range};e.exports={addRange:i,updateRange:r,removeRange:n,getRange:o}}()},{}],36:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(t){if("string"===t.type)return!0;console.warn("Field `"+e+"` is not of type `string` in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},i=function(t){return t.sort(function(t,e){return e>t?-1:t>e?1:0}),t},r=function(e,r){if(!e)return void console.warn("TermsAgg `field` is missing from argument. Ignoring command.");if(void 0===r)return void console.warn("TermsAgg `terms` are missing from argument. Ignoring command.");var n=this._meta[e];return t(n,e)&&(this._params.terms_agg={field:e,terms:i(r)},this.clearExtrema()),this},n=function(){return this._params.terms_agg};e.exports={setTermsAgg:r,getTermsAgg:n}}()},{}],37:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(t){if("string"===t.type)return!0;console.warn("Field `"+e+"` is not of type `string` in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},i=function(t){return t.sort(function(t,e){return e>t?-1:t>e?1:0}),t},r=function(e,r){if(!e)return void console.warn("TermsFilter `field` is missing from argument. Ignoring command.");if(void 0===r)return void console.warn("TermsFilter `terms` are missing from argument. Ignoring command.");var n=this._meta[e];if(t(n,e)){var o=_.find(this._params.terms_filter,function(t){return t.field===e});if(o)return void console.warn("TermsFilter with `field` of `"+e+"` already exists, used `updateRange` instead.");this._params.terms_filter=this._params.terms_filter||[],this._params.terms_filter.push({field:e,terms:i(r)}),this.clearExtrema()}return this},n=function(t,e){var r=_.find(this._params.terms_filter,function(e){return e.field===t});return r?(void 0!==e&&(r.terms=i(e),this.clearExtrema()),this):void console.warn("Range with `field` of `"+t+"` does not exist. Ignoring command.")},o=function(t){var e=_.find(this._params.terms_filter,function(e){return e.field===t});return e?(this._params.terms_filter=_.filter(this._params.terms_filter,function(e){return e.field!==t}),this.clearExtrema(),this):void console.warn("Range with `field` of `"+t+"` does not exist. Ignoring command.")},a=function(t){return this._params.terms_filter[t]};e.exports={addTermsFilter:r,updateTermsFilter:n,removeTermsFilter:o,getTermsFilter:a}}()},{}],38:[function(t,e,i){!function(){"use strict";var t="pixel.x",i="pixel.y",r=function(t,e){if(t){if(t.extrema)return!0;console.warn("Field `"+e+"` is not ordinal in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},n=function(e){if(e!==this._params.binning.x)if(e===t)this._params.binning.x=void 0,this._params.binning.left=void 0,this._params.binning.right=void 0,this.clearExtrema();else{var i=this._meta[e];r(i,e)&&(this._params.binning.x=e,this._params.binning.left=i.extrema.min,this._params.binning.right=i.extrema.max,this.clearExtrema())}return this},o=function(){return this._params.binning.x},a=function(t){if(t!==this._params.binning.y)if(t===i)this._params.binning.y=void 0,this._params.binning.bottom=void 0,this._params.binning.top=void 0,this.clearExtrema();else{var e=this._meta[t];r(e,t)&&(this._params.binning.y=t,this._params.binning.bottom=e.extrema.min,this._params.binning.top=e.extrema.max,this.clearExtrema())}return this},s=function(){return this._params.binning.y};e.exports={setXField:n,getXField:o,setYField:a,getYField:s,DEFAULT_X_FIELD:t,DEFAULT_Y_FIELD:i}}()},{}],39:[function(t,e,i){!function(){"use strict";var t=function(t,e){if(t){if("string"===t.type)return!0;console.warn("Field `"+e+"` is not of type `string` in meta data. Ignoring command.")}else console.warn("Field `"+e+"` is not recognized in meta data. Ignoring command.");return!1},i=function(e,i){if(!e)return void console.warn("TopTerms `field` is missing from argument. Ignoring command.");var r=this._meta[e];return t(r,e)&&(this._params.top_terms={field:e,size:i},this.clearExtrema()),this},r=function(){return this._params.top_terms};e.exports={setTopTerms:i,getTopTerms:r}}()},{}],40:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../params/Binning"),n=t("../params/MetricAgg"),o=t("../params/TermsFilter"),a=t("../params/PrefixFilter"),s=t("../params/Range"),u=t("../params/QueryString"),f=t("../mixins/ColorRamp"),l=t("../mixins/ValueTransform"),h=i.extend({includes:[r,n,o,a,s,u,f,l],type:"heatmap",initialize:function(){f.initialize.apply(this,arguments),l.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)},extractExtrema:function(t){var e=new Float64Array(t);return{min:_.min(e),max:_.max(e)}}});e.exports=h}()},{"../core/Live":24,"../mixins/ColorRamp":27,"../mixins/ValueTransform":28,"../params/Binning":29,"../params/MetricAgg":32,"../params/PrefixFilter":33,"../params/QueryString":34,"../params/Range":35,"../params/TermsFilter":37}],41:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../params/Tiling"),n=t("../params/TermsFilter"),o=t("../params/PrefixFilter"),a=t("../params/TopTerms"),s=t("../params/Range"),u=t("../params/Histogram"),f=t("../mixins/ValueTransform"),l=i.extend({includes:[r,a,n,o,s,u,f],type:"top_count",initialize:function(){f.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=l}()},{"../core/Live":24,"../mixins/ValueTransform":28,"../params/Histogram":31,"../params/PrefixFilter":33,"../params/Range":35,"../params/TermsFilter":37,"../params/Tiling":38,"../params/TopTerms":39}],42:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../params/Tiling"),n=t("../params/TopTerms"),o=t("../params/TermsFilter"),a=t("../params/PrefixFilter"),s=t("../params/Range"),u=t("../params/DateHistogram"),f=t("../params/Histogram"),l=t("../mixins/ValueTransform"),h=i.extend({includes:[r,n,o,a,s,u,f,l],type:"top_frequency",initialize:function(){l.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=h}()},{"../core/Live":24,"../mixins/ValueTransform":28,"../params/DateHistogram":30,"../params/Histogram":31,"../params/PrefixFilter":33,"../params/Range":35,"../params/TermsFilter":37,"../params/Tiling":38,"../params/TopTerms":39}],43:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../params/Tiling"),n=t("../params/TermsAgg"),o=t("../params/Range"),a=t("../params/Histogram"),s=t("../mixins/ValueTransform"),u=i.extend({includes:[r,n,o,a,s],type:"topic_count",initialize:function(){s.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=u}()},{"../core/Live":24,"../mixins/ValueTransform":28,"../params/Histogram":31,"../params/Range":35,"../params/TermsAgg":36,"../params/Tiling":38}],44:[function(t,e,i){!function(){"use strict";var i=t("../core/Live"),r=t("../params/Tiling"),n=t("../params/TermsAgg"),o=t("../params/Range"),a=t("../params/DateHistogram"),s=t("../params/Histogram"),u=t("../mixins/ValueTransform"),f=i.extend({includes:[r,n,o,a,s,u],type:"topic_frequency",initialize:function(){u.initialize.apply(this,arguments),i.prototype.initialize.apply(this,arguments)}});e.exports=f}()},{"../core/Live":24,"../mixins/ValueTransform":28,"../params/DateHistogram":30,"../params/Histogram":31,"../params/Range":35,"../params/TermsAgg":36,"../params/Tiling":38}],45:[function(t,e,i){!function(){"use strict";var i=t("./DOM"),r=i.extend({_createTile:function(){var t=L.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=L.Util.falseFn,t}});e.exports=r}()},{"./DOM":46}],46:[function(t,e,i){!function(){"use strict";var i=t("../../layer/core/Image"),r=i.extend({onAdd:function(t){L.TileLayer.prototype.onAdd.call(this,t),t.on("zoomstart",this.clearExtrema,this)},onRemove:function(t){t.off("zoomstart",this.clearExtrema,this),L.TileLayer.prototype.onRemove.call(this,t)},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_createTile:function(){},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,t._unadjustedTilePoint={x:e.x,y:e.y},t.dataset.x=e.x,t.dataset.y=e.y,this._adjustTilePoint(e),this._redrawTile(t)},_adjustTileKey:function(t){var e=t.split(":"),i=parseInt(e[0],10),r=parseInt(e[1],10),n={x:i,y:r};return this._adjustTilePoint(n),n.x+":"+n.y+":"+n.z},_removeTile:function(t){var e=this._adjustTileKey(t),i=this._cache[e];delete i.tiles[t],0===_.keys(i.tiles).length&&delete this._cache[e],L.TileLayer.prototype._removeTile.call(this,t)},_redrawTile:function(t){var e=this,i=this._cache,r={x:t._tilePoint.x,y:t._tilePoint.y,z:this._map._zoom},n=r.x+":"+r.y+":"+r.z,o=t._unadjustedTilePoint.x+":"+t._unadjustedTilePoint.y,a=i[n];a?a.isPending?a.tiles[o]=t:(a.tiles[o]=t,e.renderTile(t,a.data),e.tileDrawn(t)):(i[n]={isPending:!0,tiles:{},data:null},i[n].tiles[o]=t,this.requestTile(r,function(t){var r=i[n];r&&(r.isPending=!1,r.data=t,t&&e.updateExtrema(t)?e.redraw():_.forIn(r.tiles,function(i){e.renderTile(i,t),e.tileDrawn(i)}))}))},tileDrawn:function(t){this._tileOnLoad.call(t)},requestTile:function(){},renderTile:function(){}});e.exports=r}()},{"../../layer/core/Image":23}],47:[function(t,e,i){!function(){"use strict";var i=t("./DOM"),r=i.extend({options:{handlers:{}},onAdd:function(t){var e=this;i.prototype.onAdd.call(this,t),t.on("click",this.onClick,this),$(this._container).on("mouseover",function(t){e.onMouseOver(t)}),$(this._container).on("mouseout",function(t){e.onMouseOut(t)})},onRemove:function(t){t.off("click",this.onClick,this),$(this._container).off("mouseover"),$(this._container).off("mouseout"),i.prototype.onRemove.call(this,t)},_createTile:function(){var t=L.DomUtil.create("div","leaflet-tile leaflet-html-tile");return t.width=this.options.tileSize,t.height=this.options.tileSize,t.onselectstart=L.Util.falseFn,t.onmousemove=L.Util.falseFn,t},onMouseOver:function(){},onMouseOut:function(){},onClick:function(){}});e.exports=r}()},{"./DOM":46}],48:[function(t,e,i){!function(){"use strict";function i(t){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1])}function r(t,e,i,r,n,o){var a=new Float32Array(16);return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(r-i),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(o-n),a[11]=0,a[12]=-((e+t)/(e-t)),a[13]=-((r+i)/(r-i)),a[14]=-((o+n)/(o-n)),a[15]=1,a}var n=t("esper"),o=L.Class.extend({includes:[L.Mixin.Events],options:{minZoom:0,maxZoom:18,zoomOffset:0,opacity:1,shaders:{vert:null,frag:null},unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(t,e){e=L.setOptions(this,e),e.bounds&&(e.bounds=L.latLngBounds(e.bounds))},getOpacity:function(){return this.options.opacity},show:function(){this._hidden=!1,this._prevMap.addLayer(this)},hide:function(){this._hidden=!0,this._prevMap=this._map,this._map.removeLayer(this)},isHidden:function(){return this._hidden},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._canvas?t._panes.tilePane.appendChild(this._canvas):(this._initCanvas(),
t._panes.tilePane.appendChild(this._canvas),this._initGL()),t.on({resize:this._resize,viewreset:this._reset,moveend:this._update,zoomstart:this.clearExtrema},this),t.options.zoomAnimation&&L.Browser.any3d&&t.on({zoomstart:this._enableZooming,zoomanim:this._animateZoom,zoomend:this._disableZooming},this),this.options.updateWhenIdle||(this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._clearBackBuffer(),t.getPanes().tilePane.removeChild(this._canvas),t.off({resize:this._resize,viewreset:this._reset,moveend:this._update,zoomstart:this.clearExtrema},this),t.options.zoomAnimation&&t.off({zoomstart:this._enableZooming,zoomanim:this._animateZoom,zoomend:this._disableZooming},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._map=null,this._animated=null,this._isZooming=!1,this._cache={}},_enableZooming:function(){this._isZooming=!0},_disableZooming:function(){this._isZooming=!1,this._clearBackBuffer()},bringToFront:function(){var t=this._map._panes.tilePane;return this._canvas&&(t.appendChild(this._canvas),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._canvas&&(t.insertBefore(this._canvas,t.firstChild),this._setAutoZIndex(t,Math.min)),this},_setAutoZIndex:function(t,e){var i,r,n,o=t.children,a=-e(1/0,-(1/0));for(r=0,n=o.length;n>r;r++)o[r]!==this._canvas&&(i=parseInt(o[r].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._canvas.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},setOpacity:function(t){return this.options.opacity=t,this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._canvas&&void 0!==this.options.zIndex&&(this._canvas.style.zIndex=this.options.zIndex)},_reset:function(t){var e=this;_.forIn(this._tiles,function(t){e.fire("tileunload",{tile:t})}),this._tiles={},this._tilesToLoad=0,this._animated&&t&&t.hard&&this._clearBackBuffer()},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),r=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var n=L.bounds(e.min.divideBy(r)._floor(),e.max.divideBy(r)._floor());this._addTilesFromCenterOut(n),this.options.unloadInvisibleTiles&&this._removeOtherTiles(n)}}},_addTilesFromCenterOut:function(t){var e,i,r,n=[],o=t.getCenter();for(e=t.min.y;e<=t.max.y;e++)for(i=t.min.x;i<=t.max.x;i++)r=new L.Point(i,e),this._tileShouldBeLoaded(r)&&n.push(r);var a=n.length;if(0!==a)for(n.sort(function(t,e){return t.distanceTo(o)-e.distanceTo(o)}),this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=a,i=0;a>i;i++)this._addTile(n[i])},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var r=this._getTileSize(),n=t.multiplyBy(r),o=n.add([r,r]),a=this._map.unproject(n),s=this._map.unproject(o);if(e.continuousWorld||e.noWrap||(a=a.wrap(),s=s.wrap()),!e.bounds.intersects([a,s]))return!1}return!0},_removeOtherTiles:function(t){var e=this;_.forIn(this._tiles,function(i,r){var n=r.split(":"),o=parseInt(n[0],10),a=parseInt(n[1],10);(o<t.min.x||o>t.max.x||a<t.min.y||a>t.max.y)&&e._removeTile(r)})},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,r=256;return i&&e>i&&(r=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*r)),r},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_createTile:function(){return{}},_addTile:function(t){var e=this._createTile();this._tiles[t.x+":"+t.y]=e,this._loadTile(e,t)},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,t._unadjustedTilePoint={x:e.x,y:e.y},this._adjustTilePoint(e),this._redrawTile(t)},_adjustTileKey:function(t){var e=t.split(":"),i=parseInt(e[0],10),r=parseInt(e[1],10),n={x:i,y:r};return this._adjustTilePoint(n),n.x+":"+n.y+":"+n.z},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_removeTile:function(t){var e=this._adjustTileKey(t),i=this._cache[e];delete i.tiles[t],0===_.keys(i.tiles).length&&delete this._cache[e];var r=this._tiles[t];this.fire("tileunload",{tile:r}),delete this._tiles[t]},_tileLoaded:function(){this._tilesToLoad--,this._animated&&L.DomUtil.addClass(this._canvas,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBufferTimer),this._clearBufferTimer=setTimeout(L.bind(this._clearBackBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;L.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this}),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this}),t._tileLoaded()},_encodeFloatAsUint8:function(t){return new Uint8Array([(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t])},_createDataTexture:function(t){for(var e=new Float64Array(t),i=Math.sqrt(e.length),r=new ArrayBuffer(i*i*4),o=new Uint8Array(r),a=0;i*i>a;a++){var s=this._encodeFloatAsUint8(e[a]);o[4*a]=s[0],o[4*a+1]=s[1],o[4*a+2]=s[2],o[4*a+3]=s[3]}return new n.Texture2D({height:i,width:i,data:o,format:"RGBA",type:"UNSIGNED_BYTE",wrap:"CLAMP_TO_EDGE",filter:"NEAREST",invertY:!0})},_redrawTile:function(t){var e=this,i=this._cache,r={x:t._tilePoint.x,y:t._tilePoint.y,z:this._map._zoom},n=r.x+":"+r.y+":"+r.z,o=t._unadjustedTilePoint.x+":"+t._unadjustedTilePoint.y,a=i[n];a?a.tiles[o]=t:(i[n]={isPending:!0,tiles:{},data:null},i[n].tiles[o]=t,this.requestTile(r,function(t){var r=i[n];r&&(r.isPending=!1,null!==t&&(e.updateExtrema(t),r.data=e._createDataTexture(t)))}))},_initGL:function(){var t=this,e=this._gl=n.WebGLContext.get(this._canvas);return e?(e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),e.disable(e.DEPTH_TEST),t._renderable=new n.Renderable({vertices:{0:[[0,-256],[256,-256],[256,0],[0,0]],1:[[0,0],[1,0],[1,1],[0,1]]},indices:[0,1,2,0,2,3]}),void(this._shader=new n.Shader({vert:this.options.shaders.vert,frag:this.options.shaders.frag},function(){var e=t._canvas.width,i=t._canvas.height;t._viewport=new n.Viewport({width:e,height:i}),t._initialized=!0,t._draw()}))):void console.error("Unable to acquire a WebGL context.")},_initCanvas:function(){this._canvas=L.DomUtil.create("canvas","leaflet-webgl-layer leaflet-layer");var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y;var e=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(e?"animated":"hide"))},_getProjection:function(){var t=this._map.getPixelBounds(),e=256*Math.pow(2,this._map.getZoom());return r(t.min.x,t.max.x,e-t.max.y,e-t.min.y,-1,1)},_clearBackBuffer:function(){if(this._gl){var t=this._gl;t.clear(t.COLOR_BUFFER_BIT)}},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(i)+" scale("+e+")"},_resize:function(t){var e=t.newSize.x,i=t.newSize.y;this._initialized&&this._viewport.resize(e,i)},_draw:function(){if(this._initialized&&this._gl){if(!this.isHidden()){if(!this._isZooming){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t)}this._beforeDraw(),this.beforeDraw(),this.draw(),this.afterDraw(),this._afterDraw()}requestAnimationFrame(this._draw.bind(this))}},beforeDraw:function(){},_beforeDraw:function(){this._viewport.push(),this._shader.push(),this._shader.setUniform("uProjectionMatrix",this._getProjection()),this._shader.setUniform("uOpacity",this.getOpacity()),this._shader.setUniform("uTextureSampler",0)},afterDraw:function(){},_afterDraw:function(){this._shader.pop(),this._viewport.pop()},draw:function(){var t=this,e=256*Math.pow(2,this._map.getZoom());_.forIn(this._cache,function(r){!r.isPending&&r.data&&(r.data.push(0),_.forIn(r.tiles,function(r,n){var o=n.split(":"),a=parseInt(o[0],10),s=parseInt(o[1],10),u=new i([256*a,e-256*s,0]);t._shader.setUniform("uModelMatrix",u),t._renderable.draw()}))})},requestTile:function(){}});e.exports=o}()},{esper:13}],49:[function(t,e,i){!function(){"use strict";var i={Heatmap:t("./types/canvas/Heatmap")},r={Heatmap:t("./types/html/Heatmap"),Ring:t("./types/html/Ring"),WordCloud:t("./types/html/WordCloud"),WordHistogram:t("./types/html/WordHistogram")},n={Heatmap:t("./types/webgl/Heatmap")},o={Blink:t("./types/pending/Blink"),Spin:t("./types/pending/Spin"),BlinkSpin:t("./types/pending/BlinkSpin")},a={Coord:t("./types/debug/Coord")};e.exports={HTML:r,Canvas:i,WebGL:n,Debug:a,Pending:o}}()},{"./types/canvas/Heatmap":51,"./types/debug/Coord":52,"./types/html/Heatmap":53,"./types/html/Ring":54,"./types/html/WordCloud":55,"./types/html/WordHistogram":56,"./types/pending/Blink":57,"./types/pending/BlinkSpin":58,"./types/pending/Spin":59,"./types/webgl/Heatmap":60}],50:[function(t,e,i){!function(){"use strict";function t(t,e){t=void 0!==t?t:-1,e=void 0!==e?e:1;var i=[.25*e,.5*e,.75*e],r=[-.25*t,-.5*t,-.75*t];return function(t){var e,n;0>t?(e="neg-",n=r):(e="pos-",n=i);var o=Math.abs(t);return o>n[2]?e+"4":o>n[1]?e+"3":o>n[0]?e+"2":e+"1"}}function i(t){if(!t)return 0;var e=t[n]?t[n]:0,i=t[o]?t[o]:0,r=t[a]?t[a]:0;return e+i+r}function r(t){if(!t)return 0;var e=t[n]?t[n]:0,i=t[o]?t[o]:0,r=t[a]?t[a]:0,s=e+i+r;return 0!==s?(e-r)/s:0}var n="1",o="0",a="-1";e.exports={getClassFunc:t,getTotal:i,getAvg:r}}()},{}],51:[function(t,e,i){!function(){"use strict";var i=t("../../core/Canvas"),r=i.extend({renderCanvas:function(t,e,i){var r=document.createElement("canvas");r.height=e,r.width=e;var n,o,a,s,u=r.getContext("2d"),f=u.getImageData(0,0,e,e),l=f.data,h=this,c=[0,0,0,0];for(s=0;s<t.length;s++)a=t[s],0===a?(c[0]=0,c[1]=0,c[2]=0,c[3]=0):(n=h.transformValue(a),o=h.interpolateToRange(n),i(o,c)),l[4*s]=c[0],l[4*s+1]=c[1],l[4*s+2]=c[2],l[4*s+3]=c[3];return u.putImageData(f,0,0),r},renderTile:function(t,e){if(e){var i=new Float64Array(e),r=Math.sqrt(i.length),n=this.getColorRamp(),o=this.renderCanvas(i,r,n),a=t.getContext("2d");a.imageSmoothingEnabled=!1,a.drawImage(o,0,0,r,r,0,0,t.width,t.height)}}});e.exports=r}()},{"../../core/Canvas":45}],52:[function(t,e,i){!function(){"use strict";e.exports={renderTile:function(t,e){$(t).empty(),$(t).append('<div style="top:0; left:0;">'+e.z+", "+e.x+", "+e.y+"</div>")}}}()},{}],53:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=256,n=i.extend({isTargetLayer:function(t){return this._container&&$.contains(this._container,t)},clearSelection:function(){$(this._container).removeClass("highlight"),this.highlight=null},onMouseOver:function(t){var e=$(t.originalEvent.target),i=e.attr("data-value");if(i&&this.options.handlers.mouseover){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseover(e,{value:parseInt(i,10),x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),bx:parseInt(e.attr("data-bx"),10),by:parseInt(e.attr("data-by"),10),type:"heatmap",layer:this})}},onMouseOut:function(t){var e=$(t.originalEvent.target),i=e.attr("data-value");if(i&&this.options.handlers.mouseout){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseout(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),bx:parseInt(e.attr("data-bx"),10),by:parseInt(e.attr("data-by"),10),type:"heatmap",layer:this})}},onClick:function(t){$(".heatmap-pixel").removeClass("highlight");var e=$(t.originalEvent.target);if(this.isTargetLayer(t.originalEvent.target)){e.hasClass("heatmap-pixel")&&e.addClass("highlight");var i=e.attr("data-value");if(i&&this.options.handlers.click){var r=e.parents(".leaflet-html-tile");this.options.handlers.click(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),bx:parseInt(e.attr("data-bx"),10),by:parseInt(e.attr("data-by"),10),type:"heatmap",layer:this})}}},renderTile:function(t,e){if(e){var i,n,o,a,s,u,f=new Float64Array(e),l=Math.sqrt(f.length),h=this.getColorRamp(),c=r/l,d=this,p=[0,0,0,0],m="";for(u=0;u<f.length;u++)if(o=f[u],0!==o){a=u%l,s=Math.floor(u/l),i=d.transformValue(o),n=d.interpolateToRange(i),h(n,p);var g="rgba("+p[0]+","+p[1]+","+p[2]+","+p[3]/255+")";m+='<div class="heatmap-pixel" data-value="'+o+'" data-bx="'+a+'" data-by="'+s+'" style="height:'+c+"px;width:"+c+"px;left:"+a*c+"px;top:"+s*c+"px;background-color:"+g+';"></div>'}t.innerHTML=m}}});e.exports=n}()},{"../../core/HTML":47}],54:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=256,n=i.extend({onClick:function(t){var e=$(t.originalEvent.target);$(".heatmap-ring").removeClass("highlight"),e.hasClass("heatmap-ring")&&e.addClass("highlight")},renderTile:function(t,e){if(e){var i=this,n=new Float64Array(e),o=Math.sqrt(n.length),a=r/o,s="";n.forEach(function(t,e){if(t){var r=i.transformValue(t),n=r*a,u=(a-n)/2,f=e%o*a,l=Math.floor(e/o)*a;s+='<div class="heatmap-ring" style="left:'+(f+u)+"px;top:"+(l+u)+"px;width:"+n+"px;height:"+n+'px;"></div>'}}),t.innerHTML=s}}});e.exports=n}()},{"../../core/HTML":47}],55:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=t("../../sentiment/Sentiment"),n=r.getClassFunc(-1,1),o=256,a=o/2,s=24,u=10,f=15,l=10,h=20,c=1,d=function(t){var e=2*Math.PI,i=e*t.radius,r=t.arcLength>i/10?i/10:t.arcLength,n=r/t.radius,o=t.t+n;return o>e&&(o%=e,t.radius=t.radius+t.radiusInc),t.t=o,t.x=t.radius*Math.cos(o),t.y=t.radius*Math.sin(o),t},p=function(t,e){return 2*Math.abs(t.x-e.x)<t.width+e.width&&2*Math.abs(t.y-e.y)<t.height+e.height},m=function(t,e){return t.x+t.width/2>e.x+e.width/2||t.x-t.width/2<e.x-e.width/2||t.y+t.height/2>e.y+e.height/2||t.y-t.height/2<e.y-e.height/2},g=function(t,e,i,r){var n,o={x:t.x,y:t.y,height:e.height,width:e.width};for(n=0;n<i.length;n++)if(p(o,i[n]))return!0;return m(o,r)?(t.collisions++,t.arcLength=t.radius,!0):!1},v=i.extend({isTargetLayer:function(t){return this._container&&$.contains(this._container,t)},clearSelection:function(){$(this._container).removeClass("highlight"),this.highlight=null},onMouseOver:function(t){var e=$(t.originalEvent.target);$(".word-cloud-label").removeClass("hover");var i=e.attr("data-word");if(i&&($(".word-cloud-label[data-word="+i+"]").addClass("hover"),this.options.handlers.mouseover)){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseover(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-cloud",layer:this})}},onMouseOut:function(t){var e=$(t.originalEvent.target);$(".word-cloud-label").removeClass("hover");var i=e.attr("data-word");if(i&&this.options.handlers.mouseout){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseout(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-cloud",layer:this})}},onClick:function(t){$(".word-cloud-label").removeClass("highlight"),$(this._container).removeClass("highlight");var e=$(t.originalEvent.target);if(this.isTargetLayer(t.originalEvent.target)){var i=e.attr("data-word");if(i){if($(this._container).addClass("highlight"),$(".word-cloud-label[data-word="+i+"]").addClass("highlight"),this.highlight=i,this.options.handlers.click){var r=e.parents(".leaflet-html-tile");this.options.handlers.click(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-cloud",layer:this})}}else this.clearSelection()}},_measureWords:function(t){t=t.sort(function(t,e){return e.count-t.count}).slice(0,f);var e='<div style="height:256px; width:256px;">',i=this;t.forEach(function(t){t.percent=i.transformValue(t.count),t.fontSize=l+t.percent*(h-l),e+='<div class="word-cloud-label" style="visibility:hidden;font-size:'+t.fontSize+'px;">'+t.text+"</div>"}),e+="</div>";var r=$(e);return $("body").append(r),r.children().each(function(e){t[e].width=this.offsetWidth,t[e].height=this.offsetHeight}),r.remove(),t},_createWordCloud:function(t){var e={width:o-2*u,height:o-2*s,x:0,y:0},i=[];return t=this._measureWords(t),t.forEach(function(t){for(var r={radius:1,radiusInc:5,arcLength:10,x:0,y:0,t:0,collisions:0};r.collisions<c;)if(r=d(r),!g(r,t,i,e)){i.push({text:t.text,fontSize:t.fontSize,percent:10*Math.round(100*t.percent/10),x:r.x,y:r.y,width:t.width,height:t.height,sentiment:t.sentiment,avg:t.avg});break}}),i},extractExtrema:function(t){var e=_.map(t,function(t){return _.isNumber(t)?t:r.getTotal(t)});return{min:_.min(e),max:_.max(e)}},renderTile:function(t,e){if(e&&!_.isEmpty(e)){var i=this.highlight,o=_.map(e,function(t,e){if(_.isNumber(t))return{count:t,text:e};var i=r.getTotal(t),o=r.getAvg(t);return{count:i,text:e,avg:o,sentiment:n(o)}});if(0!==o.length){var s=this._createWordCloud(o),u="";s.forEach(function(t){var e=["word-cloud-label","word-cloud-label-"+t.percent,t.text===i?"highlight":"",t.sentiment?t.sentiment:""].join(" "),r=["font-size:"+t.fontSize+"px","left:"+(a+t.x-t.width/2)+"px","top:"+(a+t.y-t.height/2)+"px","width:"+t.width+"px","height:"+t.height+"px"].join(";");u+='<div class="'+e+'"style="'+r+'"data-sentiment="'+t.avg+'"data-word="'+t.text+'">'+t.text+"</div>"}),t.innerHTML=u}}}});e.exports=v}()},{"../../core/HTML":47,"../../sentiment/Sentiment":50}],56:[function(t,e,i){!function(){"use strict";var i=t("../../core/HTML"),r=t("../../sentiment/Sentiment"),n=r.getClassFunc(-1,1),o=256,a=o/2,s=8,u=16,f=22,l=function(t){return null!==t&&_.isNumber(t)},h=function(t){return l(t)?t:r.getTotal(t)},c=function(t){return void 0!==t?n(t):""},d=function(t){return l(t)?{count:t}:{count:r.getTotal(t),avg:r.getAvg(t)}},p=function(t){if(void 0!==t[0].avg){var e=_.sumBy(t,function(t){return t.avg});return e/t.length}},m=function(t,e){var i=_.map(t,d),r=p(i),n=_.maxBy(i,function(t){return t.count}).count,o=_.sumBy(i,function(t){return t.count});return{topic:e,frequencies:i,max:n,total:o,avg:r}},g=i.extend({isTargetLayer:function(t){return this._container&&$.contains(this._container,t)},clearSelection:function(){$(this._container).removeClass("highlight"),this.highlight=null},onMouseOver:function(t){var e=$(t.originalEvent.target);$(".word-histogram-entry").removeClass("hover");var i=e.attr("data-word");if(i&&($(".word-histogram-entry[data-word="+i+"]").addClass("hover"),this.options.handlers.mouseover)){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseover(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-histogram",layer:this})}},onMouseOut:function(t){var e=$(t.originalEvent.target);$(".word-histogram-entry").removeClass("hover");var i=e.attr("data-word");if(i&&this.options.handlers.mouseout){var r=e.parents(".leaflet-html-tile");this.options.handlers.mouseout(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-histogram",layer:this})}},onClick:function(t){$(".word-histogram-entry").removeClass("highlight"),$(this._container).removeClass("highlight");var e=$(t.originalEvent.target);if(this.isTargetLayer(t.originalEvent.target)){var i=e.attr("data-word");if(i){if($(this._container).addClass("highlight"),$(".word-histogram-entry[data-word="+i+"]").addClass("highlight"),this.highlight=i,this.options.handlers.click){var r=e.parents(".leaflet-html-tile");this.options.handlers.click(e,{value:i,x:parseInt(r.attr("data-x"),10),y:parseInt(r.attr("data-y"),10),z:this._map.getZoom(),type:"word-histogram",layer:this})}}else this.clearSelection()}},extractExtrema:function(t){var e=_.map(t,function(t){return _.sumBy(t,h)});return{min:_.min(e),max:_.max(e)}},renderTile:function(t,e){if(e&&!_.isEmpty(e)){var i=this.highlight,r=_.map(e,m).sort(function(t,e){return e.total-t.total}),n=Math.min(r.length,s),o=$('<div class="word-histograms" style="display:inline-block;"></div>'),l=0,h=this;r.slice(0,n).forEach(function(t){var e=t.topic,r=t.frequencies,n=t.max,a=t.total,s=t.avg,d=c(s),p=e===i?"highlight":"",m=h.transformValue(a),g=10*Math.round(100*m/10),v=u+m*(f-u);l+=v;var _=$('<div class="word-histogram-entry '+p+'" data-sentiment="'+s+'"data-word="'+e+'"style="height:'+v+'px;"></div>'),y=$('<div class="word-histogram-left"data-sentiment="'+s+'"data-word="'+e+'"></div>'),x="calc("+100/r.length+"%)";r.forEach(function(t){var i,r,o=t.count,a=t.avg,s=c(a),u=0!==n?o/n*100:0,f=0===u?"hidden":"",l=10*Math.round(u/10),h=["word-histogram-bar","word-histogram-bar-"+l,s+"-fill"].join(" ");3>u/100*v?(i="3px",r="calc(100% - 3px)"):(i=u+"%",r=100-u+"%"),y.append('<div class="'+h+'"data-word="'+e+'"style="visibility:'+f+";width:"+x+";height:"+i+";top:"+r+';"></div>')}),_.append(y);var T=["word-histogram-label","word-histogram-label-"+g,d].join(" "),w=$('<div class="word-histogram-right"><div class="'+T+'"data-sentiment="'+s+'"data-word="'+e+'"style="font-size:'+v+"px;line-height:"+v+"px;height:"+v+'px">'+e+"</div></div>");_.append(w),o.append(_)}),o.css("top",a-l/2),t.innerHTML=o[0].outerHTML}}});e.exports=g}()},{"../../core/HTML":47,"../../sentiment/Sentiment":50}],57:[function(t,e,i){!function(){"use strict";e.exports={renderTile:function(t){t.innerHtml='<div class="blinking blinking-tile" style="animation-delay:'+-(1200*Math.random())+'ms;"></div>'}}}()},{}],58:[function(t,e,i){!function(){"use strict";var t=1200;e.exports={renderTile:function(e){var i=-(Math.random()*t)+"ms";e.innerHTML='<div class="vertical-centered-box blinking" style="animation-delay:'+i+'"><div class="content"><div class="loader-circle"></div><div class="loader-line-mask" style="animation-delay:'+i+'"><div class="loader-line"></div></div></div></div>'}}}()},{}],59:[function(t,e,i){!function(){"use strict";var t=1200;e.exports={renderTile:function(e){var i=-(Math.random()*t)+"ms";e.innerHTML='<div class="vertical-centered-box" style="animation-delay:'+i+'"><div class="content"><div class="loader-circle"></div><div class="loader-line-mask" style="animation-delay:'+i+'"><div class="loader-line"></div></div></div></div>'}}}()},{}],60:[function(t,e,i){!function(){"use strict";var i=t("../../core/WebGL"),r=i.extend({options:{shaders:{vert:"../../shaders/heatmap.vert",frag:"../../shaders/heatmap.frag"}},beforeDraw:function(){var t=this.getColorRamp(),e=[0,0,0,0];this._shader.setUniform("uMin",this.getExtrema().min),this._shader.setUniform("uMax",this.getExtrema().max),this._shader.setUniform("uColorRampFrom",t(0,e)),this._shader.setUniform("uColorRampTo",t(1,e))}});e.exports=r}()},{"../../core/WebGL":48}],61:[function(t,e,i){!function(){"use strict";function i(){r.apply(this,arguments)}var r=t("./Requestor");i.prototype=Object.create(r.prototype),i.prototype.getHash=function(t){return t.type+"-"+t.index+"-"+t.store},i.prototype.getURL=function(t){return"meta/"+t.type+"/"+t.endpoint+"/"+t.index+"/"+t.store},e.exports=i}()},{"./Requestor":62}],62:[function(t,e,i){!function(){"use strict";function t(){var t,e=window.location;return t="https:"===e.protocol?"wss:":"ws:",t+"//"+e.host+e.pathname}function i(e,r){e.socket=new WebSocket(t()+e.url),e.socket.onopen=function(){e.isOpen=!0,console.log("Websocket connection established"),r.apply(this,arguments)},e.socket.onmessage=function(t){var i=JSON.parse(t.data),r=e.getHash(i),n=e.requests[r];delete e.requests[r],i.success?n.resolve(e.getURL(i),i):n.reject(i)},e.socket.onclose=function(){e.isOpen&&console.warn("Websocket connection closed"),e.socket=null,e.isOpen=!1,Object.keys(e.requests).forEach(function(t){e.requests[t].reject()}),e.requests={},setTimeout(function(){i(e,function(){e.pending.forEach(function(t){e.get(t)}),e.pending=[]})},n)}}function r(t,e){this.url=t,this.requests={},this.pending=[],this.isOpen=!1,i(this,e)}var n=5e3;r.prototype.getHash=function(){},r.prototype.getURL=function(){},r.prototype.get=function(t){if(!this.isOpen)return void this.pending.push(t);var e=this.getHash(t),i=this.requests[e];return i?i.promise():(i=this.requests[e]=$.Deferred(),this.socket.send(JSON.stringify(t)),i.promise())},r.prototype.close=function(){this.socket.onclose=null,this.socket.close(),this.socket=null},e.exports=r}()},{}],63:[function(t,e,i){!function(){"use strict";function i(t){return function e(t){return _.forOwn(t,function(i,r){(_.isUndefined(i)||_.isNull(i)||_.isNaN(i)||_.isString(i)&&_.isEmpty(i)||_.isObject(i)&&_.isEmpty(e(i)))&&delete t[r]}),_.isArray(t)&&_.pull(t,void 0),t}(_.cloneDeep(t))}function r(){o.apply(this,arguments)}var n=t("json-stable-stringify"),o=t("./Requestor");r.prototype=Object.create(o.prototype),r.prototype.getHash=function(t){var e=t.coord,r=n(i(t.params));return t.type+"-"+t.index+"-"+t.store+"-"+e.x+"-"+e.y+"-"+e.z+"-"+r},r.prototype.getURL=function(t){var e=t.coord;return"tile/"+t.type+"/"+t.index+"/"+t.store+"/"+e.z+"/"+e.x+"/"+e.y},e.exports=r}()},{"./Requestor":62,"json-stable-stringify":17}]},{},[21])(21)});